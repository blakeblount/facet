{"id":"facet-01b","title":"Set up SvelteKit routing and base layout","description":"Configure routes and create base layout structure.\n\nSteps:\n1. Create route structure: / (workboard), /search, /admin\n2. Create +layout.svelte with header slot and main content area\n3. Create +page.svelte for home (workboard)\n4. Add TypeScript types for page data\n5. Set up load functions for data fetching pattern\n\nFiles to create:\n- apps/web/src/routes/+layout.svelte\n- apps/web/src/routes/+page.svelte\n- apps/web/src/routes/search/+page.svelte\n- apps/web/src/routes/admin/+page.svelte\n\nSuccess criteria: Routes work, layout renders correctly","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:43.929741-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T07:19:25.889818-05:00","closed_at":"2026-01-20T07:19:25.889818-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-01b","depends_on_id":"facet-6p6","type":"blocks","created_at":"2026-01-19T22:20:27.56991-05:00","created_by":"Blake Blount"}]}
{"id":"facet-052","title":"Implement password hashing utilities","description":"Set up argon2 password hashing for PINs.\n\n## Steps\n1. Add argon2 crate to Cargo.toml\n2. Create hash_pin() function\n3. Create verify_pin() function\n4. Add tests for hashing/verification\n\n## Files to create\n- apps/api/src/auth.rs\n\n## Success criteria\nCan hash and verify PINs, tests pass","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.897405-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:06:42.003051-05:00","closed_at":"2026-01-20T08:06:42.003051-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-052","depends_on_id":"facet-7ag","type":"blocks","created_at":"2026-01-19T22:20:24.152758-05:00","created_by":"Blake Blount"}]}
{"id":"facet-0l2","title":"UI Test: Customer autocomplete search works","description":"## Test: Customer Autocomplete\n\n### Preconditions\n- Dev server running\n- Database has existing customers\n- Intake form modal is open\n\n### Steps\n1. Open intake form modal\n2. Click in the Customer Name field\n3. Type a partial customer name that exists in the database\n4. Wait for autocomplete dropdown to appear (300ms debounce)\n5. Observe the dropdown results\n\n### Success Criteria\n- [ ] Typing triggers autocomplete search after brief delay\n- [ ] Dropdown appears below the input field\n- [ ] Matching customers are listed with name and contact info\n- [ ] Results are clickable\n- [ ] If no matches, shows \"No matching customers\" message\n- [ ] Dropdown closes when clicking outside\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:12.743108-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T14:39:23.563515-05:00","closed_at":"2026-01-20T14:39:23.563515-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-0l5q","title":"Allow unauthenticated viewing of workboard","description":"After recent security updates, the workboard required authentication to view. This was unintended - the workboard should be publicly viewable, with only operations (create ticket, change status) requiring PIN signatures. Fixed by removing the hasEmployeeSession() check from fetchQueue() and removing the 'Please log in' conditional block in the template.","status":"closed","priority":1,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-21T08:22:21.319748-05:00","created_by":"Blake Blount","updated_at":"2026-01-21T08:24:06.221304-05:00","closed_at":"2026-01-21T08:24:06.221304-05:00","close_reason":"Closed"}
{"id":"facet-0lm","title":"Create photos gallery section in TicketDetailModal","description":"Build photo gallery with add functionality.\n\nSteps:\n1. Display photo thumbnails in grid\n2. Click thumbnail to view full size (lightbox or new tab)\n3. \"+ Add Photo\" button\n4. PhotoUpload component integration for adding\n5. Call POST /tickets/:id/photos on upload\n6. Show upload progress\n\nFiles to modify:\n- apps/web/src/lib/components/TicketDetailModal.svelte\n\nSuccess criteria: Photos display, can add new photos","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.208781-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:16:40.460786-05:00","closed_at":"2026-01-20T10:16:40.460786-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-0lm","depends_on_id":"facet-j6h","type":"blocks","created_at":"2026-01-19T22:21:11.094128-05:00","created_by":"Blake Blount"},{"issue_id":"facet-0lm","depends_on_id":"facet-ekd","type":"blocks","created_at":"2026-01-19T22:21:11.456332-05:00","created_by":"Blake Blount"}]}
{"id":"facet-0ob","title":"Implement GET /settings endpoint","description":"Get store settings (public read).\n\nSteps:\n1. Add handler for settings retrieval\n2. Fetch single store_settings row\n3. Exclude admin_pin_hash from response\n4. Return settings\n\nAPI: GET /api/v1/settings\n\nSuccess criteria: Returns store settings","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:23.999876-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:38:12.420138-05:00","closed_at":"2026-01-20T10:38:12.420138-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-0ob","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:18.524725-05:00","created_by":"Blake Blount"},{"issue_id":"facet-0ob","depends_on_id":"facet-4m6","type":"blocks","created_at":"2026-01-19T22:20:18.743064-05:00","created_by":"Blake Blount"}]}
{"id":"facet-19y","title":"UI Test: Ticket detail modal opens from workboard","description":"## Test: Open Detail Modal from Workboard\n\n### Preconditions\n- Dev server running\n- At least one ticket exists on the workboard\n\n### Steps\n1. Navigate to workboard (/)\n2. Locate a ticket card in any lane\n3. Click on the ticket card\n4. Observe what opens\n\n### Success Criteria\n- [ ] Clicking ticket card opens detail modal\n- [ ] Modal has overlay backdrop\n- [ ] Modal contains ticket information\n- [ ] Close button (X) is visible\n- [ ] Clicking backdrop or X closes the modal\n- [ ] ESC key closes the modal\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:55.235931-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T14:42:13.860113-05:00","closed_at":"2026-01-20T14:42:13.860113-05:00","close_reason":"Test completed: BLOCKED. Current implementation uses page navigation instead of modal. See UI-TESTS.md for full details and recommendations.","labels":["ui-test"]}
{"id":"facet-1dj","title":"Implement API response wrapper and error handling","description":"Create consistent JSON response format per API.md spec.\n\n## Steps\n1. Create ApiResponse\u003cT\u003e struct with data/error fields\n2. Create AppError enum with all error codes from API.md\n3. Implement IntoResponse for AppError\n4. Create error code constants (VALIDATION_ERROR, INVALID_PIN, etc.)\n5. Add helper functions for success/error responses\n\n## Files to create\n- apps/api/src/response.rs\n- apps/api/src/error.rs\n\n## Success criteria\nAll endpoints can use ApiResponse wrapper, errors return correct HTTP status and JSON format","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.280123-05:00","created_by":"Blake Blount","updated_at":"2026-01-19T22:44:28.490517-05:00","closed_at":"2026-01-19T22:44:28.490517-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-1dj","depends_on_id":"facet-h67","type":"blocks","created_at":"2026-01-19T22:20:18.574493-05:00","created_by":"Blake Blount"}]}
{"id":"facet-1fs","title":"UI Test: Filter by status","description":"## Test: Status Filter\n\n### Preconditions\n- Dev server running\n- Tickets exist in various statuses\n\n### Steps\n1. Navigate to /search\n2. Click the Status filter dropdown\n3. Select \"In Progress\"\n4. Click Search\n5. Observe results\n6. Change filter to \"Closed\"\n7. Search again\n\n### Success Criteria\n- [ ] Status dropdown shows all options (All, Intake, In Progress, Waiting, Ready, Closed, Archived)\n- [ ] Selecting a status filters results\n- [ ] \"In Progress\" filter shows only in-progress tickets\n- [ ] \"Closed\" filter shows only closed tickets\n- [ ] All results have matching status badges\n- [ ] \"All Statuses\" shows tickets of any status\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:26.821948-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T15:52:15.127295-05:00","closed_at":"2026-01-20T15:52:15.127295-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-1hq","title":"Add offline PIN verification support for ticket creation","description":"## Problem\nThe offline ticket creation feature (PWA) is currently blocked because PIN verification always requires network connectivity.\n\n## Root Cause\n- `EmployeeIdModal.svelte` line 55 calls `verifyEmployeePin(pin)` which makes an API call\n- No offline fallback exists\n- The `IntakeFormModal.svelte` has working offline queueing logic (lines 320-345) but it's never reached\n\n## Evidence\n- UI test facet-20c documented this as BLOCKED\n- Screenshots: offline-intake-form.png, offline-pin-verification-failure.png\n\n## Suggested Fix Options\n1. **Cache employee credentials**: After successful online PIN verification, cache employee data (id, name, role) and PIN hash in IndexedDB. When offline, verify against cached hash.\n2. **Defer verification**: Trust the employee PIN input while offline, store it with the queued ticket, and verify during sync. Reject if verification fails.\n3. **Require pre-authentication**: Require employees to verify their PIN once while online, then allow offline operations for a limited time window.\n\n## Security Considerations\n- Storing PIN hashes client-side has security implications\n- Option 2 (deferred verification) is simpler but could allow unauthorized ticket creation\n- Consider time-limited offline sessions\n\n## Related Files\n- apps/web/src/lib/components/EmployeeIdModal.svelte\n- apps/web/src/lib/components/IntakeFormModal.svelte\n- apps/web/src/lib/services/syncQueue.svelte.ts","status":"closed","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T18:02:28.491401-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:29:11.605638-05:00","closed_at":"2026-01-20T18:29:11.605638-05:00","close_reason":"Implemented offline PIN verification with cached credentials in IndexedDB"}
{"id":"facet-1ty","title":"UI Test: Print receipt button","description":"## Test: Print Receipt\n\n### Preconditions\n- Dev server running\n- Ticket exists\n- Ticket detail modal is open\n\n### Steps\n1. Open detail modal for any ticket\n2. Locate the \"Print Receipt\" button\n3. Click the button\n4. Observe what happens\n\n### Success Criteria\n- [ ] \"Print Receipt\" button is visible\n- [ ] Clicking opens a new browser tab\n- [ ] New tab contains a PDF or printable receipt\n- [ ] Receipt shows ticket code, customer info, item details\n- [ ] Receipt shows pricing (quote and/or actual)\n- [ ] Receipt includes store information\n- [ ] Receipt is formatted for printing\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:25.954267-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:14:59.174782-05:00","closed_at":"2026-01-20T16:14:59.174782-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-20c","title":"UI Test: Offline ticket creation queues for sync","description":"## Test: Offline Ticket Creation\n\n### Preconditions\n- Dev server running\n- App loaded and functional\n- Know a valid employee PIN\n\n### Steps\n1. Navigate to workboard\n2. Go offline (DevTools → Network → Offline)\n3. Click \"+New\" to open intake form\n4. Fill out all required fields\n5. Submit the form\n6. Enter PIN and verify\n7. Observe what happens\n8. Go back online\n9. Observe sync behavior\n\n### Success Criteria\n- [ ] Offline banner appears in intake form when offline\n- [ ] Form can still be filled out while offline\n- [ ] Submission succeeds (queued locally)\n- [ ] Success message indicates offline mode\n- [ ] Ticket is queued for sync\n- [ ] Sync notification appears indicating pending items\n- [ ] When back online, ticket syncs to server\n- [ ] Ticket appears on workboard after sync\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:56:00.02444-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:02:24.517559-05:00","closed_at":"2026-01-20T18:02:24.517559-05:00","close_reason":"Test completed with BLOCKED status - PIN verification requires network connectivity, blocking offline ticket creation. Results documented in UI-TESTS.md.","labels":["ui-test"]}
{"id":"facet-26g","title":"Create Header component","description":"Build header with store name, search, and settings.\n\nSteps:\n1. Create Header.svelte component\n2. Display store name (left)\n3. Search input with icon (center/right)\n4. Settings gear icon (right)\n5. Style with theme colors\n6. Make search functional (navigates to /search with query)\n\nFiles to create:\n- apps/web/src/lib/components/Header.svelte\n\nSuccess criteria: Header displays, search navigates, settings opens","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:44.50795-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:18:50.0512-05:00","closed_at":"2026-01-20T09:18:50.0512-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-26g","depends_on_id":"facet-01b","type":"blocks","created_at":"2026-01-19T22:20:27.808846-05:00","created_by":"Blake Blount"},{"issue_id":"facet-26g","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:20:27.846393-05:00","created_by":"Blake Blount"}]}
{"id":"facet-2f5","title":"UI Test: Photo lightbox navigation","description":"## Test: Lightbox Navigation\n\n### Preconditions\n- Dev server running\n- Ticket exists with multiple photos (3+)\n- Lightbox is open\n\n### Steps\n1. Open lightbox on a ticket with multiple photos\n2. Click the Next arrow button\n3. Observe photo changes\n4. Click the Previous arrow button\n5. Observe photo changes\n6. Press Right Arrow key\n7. Press Left Arrow key\n8. Press Escape key\n\n### Success Criteria\n- [ ] Next arrow button advances to next photo\n- [ ] Previous arrow button goes to previous photo\n- [ ] Photo counter updates (e.g., \"2 of 5\")\n- [ ] Right Arrow key advances to next photo\n- [ ] Left Arrow key goes to previous photo\n- [ ] Escape key closes the lightbox\n- [ ] Navigation wraps around (last → first, first → last) OR buttons hide at ends\n- [ ] Clicking outside image/on backdrop closes lightbox\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:55.656738-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T14:50:33.388179-05:00","closed_at":"2026-01-20T14:50:33.388179-05:00","close_reason":"BLOCKED: TicketDetailModal with lightbox is not integrated into the UI. Workboard navigates to placeholder /tickets/[id] page instead of opening the modal. Also no tickets have 3+ photos needed for navigation testing.","labels":["ui-test"]}
{"id":"facet-2gu","title":"Fix photo lightbox z-index issue with native dialog","description":"## Bug Description\n\nWhen opening the photo lightbox from within the TicketDetailModal, the lightbox is visually rendered but is not clickable because the native `\u003cdialog\u003e` element's 'top layer' blocks pointer events.\n\n## Root Cause\n- The lightbox uses `position: fixed; z-index: 1000` for overlay\n- The parent Modal uses native `\u003cdialog\u003e` with `showModal()` which creates a 'top layer' rendering context\n- Native dialog top layer always renders above regular positioned elements regardless of z-index\n\n## Symptoms\n- Cannot click close button on lightbox while parent modal is open\n- Cannot click outside image to close lightbox (backdrop click)\n- ESC key closes parent modal instead of lightbox\n- Workaround: Press ESC to close modal first, then lightbox becomes clickable\n\n## Recommended Fix Options\n1. Render lightbox outside the modal using a Svelte portal to body root\n2. Use native dialog for lightbox as well (both would be in top layer)\n3. Move lightbox DOM element to document.body when opened\n\n## Files\n- apps/web/src/lib/components/TicketDetailModal.svelte (lines 870-936)\n\n## Related\n- Found during UI test facet-x5z (Photo Lightbox Opens on Thumbnail Click)","status":"closed","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T15:56:58.565527-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:18:04.877978-05:00","closed_at":"2026-01-20T18:18:04.877978-05:00","close_reason":"Closed"}
{"id":"facet-2lj","title":"UI Test: Search page loads correctly","description":"## Test: Search Page Load\n\n### Preconditions\n- Dev server running\n\n### Steps\n1. Navigate to /search\n2. Observe the page layout\n\n### Success Criteria\n- [ ] Page loads without errors\n- [ ] Search input field is present and prominent\n- [ ] Status filter dropdown is present\n- [ ] From Date picker is present\n- [ ] To Date picker is present\n- [ ] Search button is present\n- [ ] Page has appropriate header/navigation\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:26.392321-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:49:56.442778-05:00","closed_at":"2026-01-20T18:49:56.442778-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-2od","title":"UI Test: Intake form validation - required fields","description":"## Test: Required Field Validation\n\n### Preconditions\n- Dev server running\n- Intake form modal is open\n\n### Steps\n1. Open intake form modal\n2. Without filling any fields, click Submit\n3. Observe validation errors\n4. Fill only Customer Name, try to submit\n5. Continue filling required fields one by one, testing submit each time\n6. Note which fields show validation errors\n\n### Success Criteria\n- [ ] Empty form submission is prevented\n- [ ] Customer Name required error shown when empty\n- [ ] Item Description required error shown when empty\n- [ ] Condition Notes required error shown when empty\n- [ ] Requested Work required error shown when empty\n- [ ] Storage Location required error shown when not selected\n- [ ] Photo required error shown when no photos uploaded\n- [ ] Error messages are clear and specific to each field\n- [ ] Errors clear when field is properly filled\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:13.523442-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T14:26:08.702135-05:00","closed_at":"2026-01-20T14:26:08.702135-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-2tr","title":"Implement offline-capable ticket creation","description":"Allow creating tickets when offline.\n\nSteps:\n1. Detect offline status (navigator.onLine + event listeners)\n2. Store offline tickets in IndexedDB\n3. Generate client-side UUID for ticket_id\n4. Store photos as blobs\n5. Show \"offline\" indicator in UI\n6. Sync queue when back online\n7. Call POST /tickets for each queued ticket\n8. Upload photos after ticket created\n9. Handle sync conflicts (server wins)\n10. Show sync status notifications\n\nFiles to create:\n- apps/web/src/lib/stores/offline.ts\n- apps/web/src/lib/services/syncQueue.ts\n\nSuccess criteria: Can create tickets offline, syncs when online","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:38.91702-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T12:13:01.787105-05:00","closed_at":"2026-01-20T12:13:01.787105-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-2tr","depends_on_id":"facet-85u","type":"blocks","created_at":"2026-01-19T22:21:11.774404-05:00","created_by":"Blake Blount"},{"issue_id":"facet-2tr","depends_on_id":"facet-yzr","type":"blocks","created_at":"2026-01-19T22:21:11.909515-05:00","created_by":"Blake Blount"}]}
{"id":"facet-2ul","title":"Implement PUT /settings endpoint (admin)","description":"Admin endpoint to update store settings.\n\nSteps:\n1. Add handler for settings update\n2. Require X-Admin-PIN header\n3. Update allowed fields (store_name, store_phone, store_address, ticket_prefix, currency, max_photos_per_ticket)\n4. Return updated settings\n\nAPI: PUT /api/v1/settings\n\nSuccess criteria: Updates settings (admin only)","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.270887-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:41:22.72315-05:00","closed_at":"2026-01-20T10:41:22.72315-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-2ul","depends_on_id":"facet-4m6","type":"blocks","created_at":"2026-01-19T22:20:19.061559-05:00","created_by":"Blake Blount"},{"issue_id":"facet-2ul","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:22.964273-05:00","created_by":"Blake Blount"}]}
{"id":"facet-32y","title":"UI Test: Storage locations list displays correctly","description":"## Test: Storage Locations List Display\n\n### Preconditions\n- Dev server running\n- Storage locations exist in database\n\n### Steps\n1. Navigate to /admin\n2. Locate the Storage Locations section\n3. Examine the list content\n\n### Success Criteria\n- [ ] Storage Locations section is present with header\n- [ ] All locations from database are listed\n- [ ] Each entry shows location name\n- [ ] Inactive locations show \"Inactive\" badge (if any)\n- [ ] List is readable and properly formatted\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:58.757097-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:59:57.393804-05:00","closed_at":"2026-01-20T18:59:57.393804-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-37a","title":"Implement POST /tickets/:id/status endpoint","description":"Create endpoint to change ticket status.\n\nSteps:\n1. Add handler for status change\n2. Validate X-Employee-ID header\n3. Validate status transition (e.g., cannot reopen closed)\n4. Update ticket status\n5. Create status_history entry\n6. Update last_modified_by and updated_at\n\nAPI: POST /api/v1/tickets/:ticket_id/status\nBody: { \"status\": \"in_progress\" }\n\nSuccess criteria: Updates status, creates history entry","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.878169-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:57:36.43514-05:00","closed_at":"2026-01-20T06:57:36.43514-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-37a","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:18.730504-05:00","created_by":"Blake Blount"},{"issue_id":"facet-37a","depends_on_id":"facet-k4b","type":"blocks","created_at":"2026-01-19T22:20:19.184022-05:00","created_by":"Blake Blount"}]}
{"id":"facet-3gu","title":"Implement POST /tickets/:id/notes endpoint","description":"Add internal note to ticket.\n\nSteps:\n1. Add handler for note creation\n2. Validate X-Employee-ID header\n3. Create ticket_notes record (append-only)\n4. Return created note\n\nAPI: POST /api/v1/tickets/:ticket_id/notes\nBody: { \"content\": \"...\" }\n\nSuccess criteria: Creates note, no edit/delete available","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.924034-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:04:11.213944-05:00","closed_at":"2026-01-20T09:04:11.213944-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-3gu","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:19.100949-05:00","created_by":"Blake Blount"},{"issue_id":"facet-3gu","depends_on_id":"facet-43j","type":"blocks","created_at":"2026-01-19T22:20:19.144509-05:00","created_by":"Blake Blount"}]}
{"id":"facet-3qr","title":"Offline ticket creation blocked by PIN verification","description":"## Problem\nOffline ticket creation cannot be completed because PIN verification requires network connectivity. The offline infrastructure is ready but unusable.\n\n## Context from UI Testing\n- Test facet-20c: \"BLOCKED - PIN verification blocks offline ticket creation\"\n- Offline banner correctly appears: \"You're offline - Ticket will be saved locally and synced when back online\"\n- Form can be filled, storage location dropdown works (cached)\n- Photo upload works (client-side)\n- But clicking \"Create \u0026 Print\" triggers PIN modal which fails with network error\n\n## Root Cause\n- EmployeeIdModal.svelte line 55: always calls verifyEmployeePin() API endpoint\n- This endpoint requires network connectivity\n- No offline PIN cache or fallback mechanism exists\n- IntakeFormModal has offline queueing logic (lines 320-345) but never reached\n\n## Steps to Fix\nOption A (Recommended): Offline PIN cache\n1. Cache employee data in IndexedDB after successful online PIN verification\n2. In EmployeeIdModal, check offlineStore.isOffline before API call\n3. If offline, verify PIN against cached hash\n4. Security: Store hash, not plaintext PIN\n\nOption B: Defer verification\n1. Trust user while offline\n2. Store pending employee PIN with ticket\n3. Verify PIN at sync time\n4. Reject ticket if PIN invalid on sync\n\n## Success Criteria\n- [ ] Form submission succeeds while offline (queued locally)\n- [ ] Success message indicates offline mode\n- [ ] Ticket is queued for sync\n- [ ] Sync notification shows pending items count\n- [ ] When back online, ticket syncs to server\n- [ ] Ticket appears on workboard after sync","status":"closed","priority":1,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:40:29.341776-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T21:12:46.000048-05:00","closed_at":"2026-01-20T21:12:46.000048-05:00","close_reason":"Issue already resolved - offline PIN verification infrastructure was implemented in commit 44f4f3d. Verified working via UI test: 1) PIN cached after online verification, 2) Offline indicator shown correctly, 3) PIN verified against IndexedDB cache while offline, 4) Ticket queued in IndexedDB, 5) Ticket synced when back online with success notification showing JR-0009 created."}
{"id":"facet-3zf","title":"Implement status history repository","description":"Create data access layer for ticket_status_history table.\n\n## Steps\n1. Create TicketStatusHistory model struct\n2. Implement create_history_entry()\n3. Implement find_by_ticket_id() ordered by changed_at desc\n\n## Files to create\n- apps/api/src/models/status_history.rs\n- apps/api/src/repositories/status_history.rs\n\n## Success criteria\nStatus changes are recorded","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.413172-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:40:18.23004-05:00","closed_at":"2026-01-20T08:40:18.23004-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-3zf","depends_on_id":"facet-md6","type":"blocks","created_at":"2026-01-19T22:20:19.507704-05:00","created_by":"Blake Blount"}]}
{"id":"facet-43j","title":"Implement ticket notes repository","description":"Create data access layer for ticket_notes table.\n\n## Steps\n1. Create TicketNote model struct\n2. Implement create_note() (append-only)\n3. Implement find_by_ticket_id() ordered by created_at desc\n\n## Files to create\n- apps/api/src/models/ticket_note.rs\n- apps/api/src/repositories/ticket_note.rs\n\n## Success criteria\nNotes append correctly, no edit/delete","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.267817-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:53:15.509666-05:00","closed_at":"2026-01-20T08:53:15.509666-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-43j","depends_on_id":"facet-md6","type":"blocks","created_at":"2026-01-19T22:20:19.363667-05:00","created_by":"Blake Blount"}]}
{"id":"facet-463","title":"Implement GET /locations endpoint","description":"List storage locations.\n\n## Steps\n1. Add handler for locations list\n2. Parse include_inactive query param\n3. Return location list\n\n## API\nGET /api/v1/locations\n\n## Success Criteria\nReturns active locations (optionally inactive)","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.405077-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:50:42.200813-05:00","closed_at":"2026-01-20T10:50:42.200813-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-463","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:24.429581-05:00","created_by":"Blake Blount"},{"issue_id":"facet-463","depends_on_id":"facet-dwy","type":"blocks","created_at":"2026-01-19T22:20:24.560174-05:00","created_by":"Blake Blount"}]}
{"id":"facet-491","title":"Integrate photo upload in intake form","description":"Add photo upload to intake form.\n\nSteps:\n1. PhotoUpload component in form\n2. Minimum 1 photo validation\n3. Maximum 10 photos\n4. Preview uploaded photos\n5. Remove photo option\n6. Photos stored temporarily until form submission\n\nFiles to modify:\n- apps/web/src/lib/components/IntakeFormModal.svelte\n\nSuccess criteria: Can upload photos, validation enforced","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:42.718863-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:59:35.735233-05:00","closed_at":"2026-01-20T11:59:35.735233-05:00","close_reason":"Already implemented - PhotoUpload component is integrated in IntakeFormModal with all requirements: 1+ photo validation, max 10 photos, preview, remove option, and temporary storage before submission","dependencies":[{"issue_id":"facet-491","depends_on_id":"facet-pit","type":"blocks","created_at":"2026-01-19T22:21:08.846337-05:00","created_by":"Blake Blount"},{"issue_id":"facet-491","depends_on_id":"facet-ekd","type":"blocks","created_at":"2026-01-19T22:21:08.885656-05:00","created_by":"Blake Blount"}]}
{"id":"facet-4gw","title":"UI Test: Ticket detail modal displays all sections","description":"## Test: Detail Modal Sections\n\n### Preconditions\n- Dev server running\n- Ticket exists with photos, notes, and status history\n\n### Steps\n1. Open a ticket detail modal (click ticket on workboard)\n2. Scroll through the entire modal\n3. Identify all sections present\n\n### Success Criteria\n- [ ] Header shows ticket code and status badge\n- [ ] Customer section shows name, phone (if available), email (if available)\n- [ ] Item Details section shows type, description, condition, requested work\n- [ ] Photos section shows photo thumbnails in a grid\n- [ ] Pricing section shows quote amount and actual charged\n- [ ] Status \u0026 Location section shows current status, rush toggle, promise date, storage location\n- [ ] Status History section is present (may be collapsed)\n- [ ] Notes section shows existing notes and \"Add Note\" form\n- [ ] Activity section shows taken in by, worked by, timestamps\n- [ ] Action buttons are visible (Edit, Print Receipt, Print Tag, Close if applicable)\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:55.373621-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T15:11:49.4417-05:00","closed_at":"2026-01-20T15:11:49.4417-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-4m6","title":"Implement store settings repository","description":"Create data access layer for store_settings table.\n\n## Steps\n1. Create StoreSettings model struct (exclude admin_pin_hash from serialization)\n2. Implement get_settings() (single row)\n3. Implement update_settings()\n4. Implement verify_admin_pin()\n5. Implement change_admin_pin()\n6. Implement get_and_increment_ticket_number()\n\n## Files to create\n- apps/api/src/models/store_settings.rs\n- apps/api/src/repositories/store_settings.rs\n\n## Success criteria\nSettings can be read/updated, admin PIN verification works","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.54841-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:43:05.631411-05:00","closed_at":"2026-01-20T08:43:05.631411-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-4m6","depends_on_id":"facet-md6","type":"blocks","created_at":"2026-01-19T22:20:19.638684-05:00","created_by":"Blake Blount"}]}
{"id":"facet-4p6","title":"Create Button component","description":"Build reusable button with variants.\n\nSteps:\n1. Create Button.svelte component\n2. Props: variant (primary, secondary, danger), size (sm, md, lg), disabled, loading\n3. Style with theme colors\n4. Loading spinner state\n5. Full accessibility (focus, disabled state)\n\nFiles to create:\n- apps/web/src/lib/components/Button.svelte\n\nSuccess criteria: Button renders all variants correctly","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:45.722761-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:49:02.338516-05:00","closed_at":"2026-01-20T09:49:02.338516-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-4p6","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:21:11.552693-05:00","created_by":"Blake Blount"}]}
{"id":"facet-4zy","title":"CRIT-1: Add rate limiting to PIN verification endpoints","description":"## Problem\nThe `POST /api/v1/employees/verify` and `POST /api/v1/admin/verify` endpoints accept unlimited requests with no throttling. 4-digit PINs can be enumerated in ~10,000 attempts. At 100 req/sec, complete enumeration takes under 2 minutes.\n\n## Files to Modify\n- `apps/api/src/main.rs` - Add rate limiting middleware to the app\n- `apps/api/Cargo.toml` - Add dependencies if needed (tower-governor or similar)\n- `apps/api/src/routes/mod.rs` - Apply rate limiting selectively to auth endpoints\n\n## Implementation Steps\n\n### Step 1: Add Dependencies\nAdd `tower-governor` crate to Cargo.toml for rate limiting:\n```toml\ntower-governor = \"0.3\"\n```\n\n### Step 2: Create Rate Limiter Configuration\nIn `main.rs` or a new `middleware/rate_limit.rs`:\n- Configure per-IP throttling: 5 attempts per minute for PIN verification\n- Use a sliding window algorithm\n- Store rate limit state in memory (consider Redis for multi-instance deployments)\n\n### Step 3: Apply to Auth Endpoints\nApply rate limiting specifically to:\n- `POST /api/v1/employees/verify`\n- `POST /api/v1/admin/verify`\n- `POST /api/v1/admin/setup`\n\n### Step 4: Add Exponential Backoff\nAfter 3 failed attempts from an IP:\n- 1st failure: immediate retry allowed\n- 2nd failure: 5 second delay\n- 3rd failure: 30 second delay\n- 4th+ failure: 5 minute lockout\n\n### Step 5: Return Proper Error Responses\nWhen rate limited, return HTTP 429 Too Many Requests with:\n- `Retry-After` header indicating when to retry\n- JSON error body with code `RATE_LIMITED`\n\n## Success Criteria\n- [ ] Rate limiting middleware is applied to PIN verification endpoints\n- [ ] Per-IP throttling limits requests to 5 per minute\n- [ ] Exponential backoff is implemented after failures\n- [ ] HTTP 429 responses include `Retry-After` header\n- [ ] Rate limiting does NOT affect other endpoints\n- [ ] Existing tests pass\n- [ ] New integration tests verify rate limiting behavior\n\n## Testing Requirements\n\n### Unit Tests\n- Test rate limiter correctly tracks requests per IP\n- Test exponential backoff calculation\n\n### Integration Tests\nCreate `apps/api/tests/rate_limiting.rs`:\n- Test that 6th request within 1 minute returns 429\n- Test that Retry-After header is present\n- Test that different IPs have separate rate limits\n- Test that successful auth doesn't consume rate limit quota after success\n\n### Manual Testing\n1. Use curl/httpie to send 6 rapid PIN verification requests\n2. Verify 6th request returns 429\n3. Wait for Retry-After duration and verify requests work again\n\n## Security Validation\n- Verify with load testing tool (e.g., `hey`, `wrk`) that brute force is not feasible\n- Confirm rate limit state is not bypassable via header manipulation (X-Forwarded-For spoofing)\n- Test from multiple IPs to ensure isolation","status":"closed","priority":0,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:30:34.586133-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T22:54:06.212669-05:00","closed_at":"2026-01-20T22:54:06.212669-05:00","close_reason":"Closed"}
{"id":"facet-5f4","title":"UI Test: Employee list displays correctly","description":"## Test: Employee List Display\n\n### Preconditions\n- Dev server running\n- Employees exist in database\n\n### Steps\n1. Navigate to /admin\n2. Locate the Employees section\n3. Examine the list content\n\n### Success Criteria\n- [ ] Employee list section is present with header\n- [ ] All employees from database are listed\n- [ ] Each entry shows employee name\n- [ ] Each entry shows role badge (admin/staff)\n- [ ] Role badges are color-coded appropriately\n- [ ] Inactive employees show \"Inactive\" badge (if any)\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:58.609616-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:56:39.259869-05:00","closed_at":"2026-01-20T18:56:39.259869-05:00","close_reason":"UI test completed. Employee list section is present but data display blocked due to missing admin authentication in frontend.","labels":["ui-test"]}
{"id":"facet-5i8","title":"Implement POST /employees endpoint (admin)","description":"Admin endpoint to create employee.\n\n## Steps\n1. Add handler for employee creation\n2. Require X-Admin-PIN header\n3. Hash PIN with argon2\n4. Create employee record\n5. Return created employee\n\n## API\nPOST /api/v1/employees\nBody: { \"name\": \"...\", \"pin\": \"...\", \"role\": \"staff\" }\n\n## Success Criteria\nCreates employee with hashed PIN","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.926134-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:46:41.460868-05:00","closed_at":"2026-01-20T08:46:41.460868-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-5i8","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:23.686105-05:00","created_by":"Blake Blount"},{"issue_id":"facet-5i8","depends_on_id":"facet-cul","type":"blocks","created_at":"2026-01-19T22:20:23.800418-05:00","created_by":"Blake Blount"}]}
{"id":"facet-5w6","title":"Create ticket action buttons in TicketDetailModal","description":"Build action buttons for ticket operations.\n\nSteps:\n1. \"Edit Ticket\" button - opens edit mode or sub-modal\n2. \"Print Receipt\" button - opens receipt PDF in new tab\n3. \"Print Tag\" button - opens label PDF in new tab\n4. \"Close Ticket\" button (only visible in Ready for Pickup status)\n5. Close ticket flow: prompt for actual_amount, then employee ID\n6. Call appropriate APIs for each action\n\nFiles to modify:\n- apps/web/src/lib/components/TicketDetailModal.svelte\n\nSuccess criteria: All action buttons work correctly","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.476367-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:52:59.305755-05:00","closed_at":"2026-01-20T09:52:59.305755-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-5w6","depends_on_id":"facet-j6h","type":"blocks","created_at":"2026-01-19T22:21:11.342882-05:00","created_by":"Blake Blount"},{"issue_id":"facet-5w6","depends_on_id":"facet-4p6","type":"blocks","created_at":"2026-01-19T22:21:11.878919-05:00","created_by":"Blake Blount"}]}
{"id":"facet-613","title":"UI Test: Photo upload - multiple photos","description":"## Test: Multiple Photo Upload\n\n### Preconditions\n- Dev server running\n- Intake form modal is open\n- Have 3-5 test image files ready\n\n### Steps\n1. Open intake form modal\n2. Locate the photo upload area\n3. Select multiple photos at once (or drag multiple)\n4. Observe the upload behavior\n5. Try adding more photos after initial upload\n\n### Success Criteria\n- [ ] Can select multiple files at once\n- [ ] All selected photos show previews/thumbnails\n- [ ] Photo count updates correctly (e.g., \"3 photos\")\n- [ ] Can add more photos after initial selection\n- [ ] Maximum of 10 photos enforced\n- [ ] Can remove individual photos if supported\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:13.392251-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T14:47:46.688455-05:00","closed_at":"2026-01-20T14:47:46.688455-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-67e","title":"UI Test: Ticket cards display correct information","description":"## Test: Ticket Card Display\n\n### Preconditions\n- Dev server running\n- Database has tickets with varied data (some rush, some with promise dates, some overdue)\n\n### Steps\n1. Navigate to workboard (/)\n2. Locate a ticket card in any lane\n3. Examine the card contents\n4. Find a Rush ticket (if available) and examine its card\n5. Find an Overdue ticket (if available) and examine its card\n\n### Success Criteria\n- [ ] Each ticket card shows the ticket code (e.g., \"T001\")\n- [ ] Customer name is displayed\n- [ ] Item description is shown (may be truncated)\n- [ ] Promise date displays with calendar icon (if set)\n- [ ] Rush tickets have amber left border and \"Rush\" badge\n- [ ] Overdue tickets have red left border and \"Overdue\" badge\n- [ ] Cards are clickable (cursor changes on hover)\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:52:39.248323-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:03:00.081315-05:00","closed_at":"2026-01-20T16:03:00.081315-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-6f7","title":"UI Test: Invalid PIN shows error message","description":"## Test: Invalid PIN Error\n\n### Preconditions\n- Dev server running\n- Any action that requires PIN verification\n\n### Steps\n1. Trigger any PIN verification (drag ticket, submit form, etc.)\n2. Enter an invalid PIN (e.g., \"0000\" or \"wrongpin\")\n3. Click Verify\n4. Observe the result\n\n### Success Criteria\n- [ ] Invalid PIN does NOT complete the action\n- [ ] Error message appears (e.g., \"Invalid PIN. Please try again.\")\n- [ ] PIN input field remains visible for retry\n- [ ] Can try again with correct PIN\n- [ ] Error message is clear and user-friendly\n- [ ] No employee information is leaked in error message\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:55:33.174258-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T17:52:58.295957-05:00","closed_at":"2026-01-20T17:52:58.295957-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-6p6","title":"Scaffold SvelteKit frontend project","description":"Set up the SvelteKit project in apps/web with TypeScript.\n\nSteps:\n1. Create apps/web directory\n2. Run `npm create svelte@latest` with TypeScript, ESLint, Prettier\n3. Configure svelte.config.js for adapter-auto\n4. Set up TypeScript strict mode in tsconfig.json\n5. Add initial .gitignore entries\n6. Verify `npm run dev` works\n\nSuccess criteria: `npm run dev` starts dev server without errors","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:23.903825-05:00","created_by":"Blake Blount","updated_at":"2026-01-19T22:51:22.311331-05:00","closed_at":"2026-01-19T22:51:22.311331-05:00","close_reason":"Closed"}
{"id":"facet-6sv","title":"Create Docker Compose development environment","description":"Set up Docker Compose for local development with PostgreSQL.\n\nSteps:\n1. Create docker-compose.yml in project root\n2. Add postgres service (port 5432, facet_dev database)\n3. Add persistent volume for postgres data\n4. Create infra/docker directory for configs\n5. Create .env.example with database connection string\n6. Document how to start services in README or AGENTS.md\n\nFiles to create:\n- docker-compose.yml\n- infra/docker/.gitkeep\n- .env.example\n\nSuccess criteria: `docker compose up -d db` starts Postgres, can connect with psql","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.407502-05:00","created_by":"Blake Blount","updated_at":"2026-01-19T23:59:00.050583-05:00","closed_at":"2026-01-19T23:59:00.050583-05:00","close_reason":"Closed"}
{"id":"facet-6tg","title":"UI Test: Close ticket flow - full process","description":"## Test: Close Ticket Complete Flow\n\n### Preconditions\n- Dev server running\n- Ticket exists in \"Ready for Pickup\" status\n- Know a valid employee PIN\n- Ticket detail modal is open\n\n### Steps\n1. Open detail modal for a \"Ready for Pickup\" ticket\n2. Locate and click the \"Close Ticket\" button\n3. Enter the actual amount charged\n4. Click Next\n5. Enter employee PIN\n6. Click \"Close Ticket\"\n7. Observe the result\n\n### Success Criteria\n- [ ] \"Close Ticket\" button only visible for \"Ready for Pickup\" status\n- [ ] Clicking opens close modal with Step 1 (Actual Amount)\n- [ ] Must enter valid amount to proceed\n- [ ] \"Next\" advances to Step 2 (PIN)\n- [ ] \"Back\" returns to Step 1\n- [ ] After PIN verification, ticket status changes to \"Closed\"\n- [ ] Actual amount is recorded\n- [ ] Detail modal updates to show closed state\n- [ ] Action buttons become disabled (no further edits)\n- [ ] Ticket moves out of workboard queues\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:26.242645-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T15:31:36.2798-05:00","closed_at":"2026-01-20T15:31:36.2798-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-6tl","title":"Add photo count indicator to intake form upload area","description":"## Problem\nNo explicit photo count indicator in the upload area. Users must count thumbnails visually to know how many photos are uploaded.\n\n## Context from UI Testing\n- Test facet-d3x: \"LOW - No photo count indicator (e.g., '1 of 10 photos')\"\n- Test facet-613: Same issue noted for multiple photo upload\n- Max 10 photos enforced but count not shown\n\n## Steps to Fix\n1. Open apps/web/src/lib/components/PhotoUpload.svelte\n2. Add counter display showing \"X of 10 photos\"\n3. Position near upload area header\n4. Update count when photos added/removed\n\n## Success Criteria\n- [ ] Photo count displays (e.g., \"3 of 10 photos\")\n- [ ] Count updates when photos added\n- [ ] Count updates when photos removed\n- [ ] Visible before max reached","status":"closed","priority":3,"issue_type":"feature","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:41:01.707922-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T21:52:39.797904-05:00","closed_at":"2026-01-20T21:52:39.797904-05:00","close_reason":"Closed"}
{"id":"facet-6xh","title":"UI Test: Offline indicator appears when disconnected","description":"## Test: Offline Status Indicator\n\n### Preconditions\n- Dev server running\n- App loaded in browser\n\n### Steps\n1. Navigate to workboard\n2. Open DevTools → Network tab\n3. Check \"Offline\" to simulate disconnection\n4. Observe the UI\n5. Uncheck \"Offline\" to reconnect\n6. Observe the UI\n\n### Success Criteria\n- [ ] Offline indicator appears in header when disconnected\n- [ ] Indicator is clearly visible (icon and/or text)\n- [ ] Indicator disappears when connection restored\n- [ ] App remains functional while offline (read operations)\n- [ ] Appropriate messaging about limited functionality\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:55:59.85784-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T17:56:17.375664-05:00","closed_at":"2026-01-20T17:56:17.375664-05:00","close_reason":"Tested offline indicator functionality with Playwright. All success criteria passed: indicator appears when disconnected (wifi-off icon + 'Offline' text with red styling), disappears when reconnected, workboard remains visible with cached data while offline.","labels":["ui-test"]}
{"id":"facet-6zz","title":"UI Test: Admin page loads all sections","description":"## Test: Admin Page Load\n\n### Preconditions\n- Dev server running\n\n### Steps\n1. Navigate to /admin\n2. Observe the page layout and sections\n\n### Success Criteria\n- [ ] Page loads without errors\n- [ ] Appearance/Theme section is visible\n- [ ] Store Information section is visible\n- [ ] Employees section is visible\n- [ ] Storage Locations section is visible\n- [ ] Page has appropriate header/navigation\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:58.163035-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:17:29.765621-05:00","closed_at":"2026-01-20T16:17:29.765621-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-7ag","title":"Scaffold Rust Axum API project","description":"Set up the Rust API project in apps/api with Axum.\n\nSteps:\n1. Create apps/api directory\n2. Run `cargo init` in apps/api\n3. Add dependencies to Cargo.toml: axum, tokio, serde, serde_json, uuid, chrono, sqlx (postgres), tower-http\n4. Create src/main.rs with basic Axum server (hello world endpoint)\n5. Create src/lib.rs for module organization\n6. Add .env.example for configuration\n7. Verify `cargo run` starts server on port 3001\n\nSuccess criteria: `cargo run` starts server, GET /health returns 200","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.187144-05:00","created_by":"Blake Blount","updated_at":"2026-01-19T22:35:55.410596-05:00","closed_at":"2026-01-19T22:35:55.410596-05:00","close_reason":"Closed"}
{"id":"facet-7ce","title":"UI Test: Ticket creation success - receipt opens","description":"## Test: Successful Ticket Creation\n\n### Preconditions\n- Dev server running\n- Know a valid employee PIN\n- Intake form filled with all required data\n\n### Steps\n1. Fill out the intake form completely\n2. Click Submit\n3. Enter a valid employee PIN\n4. Click Verify\n5. Observe the outcome\n\n### Success Criteria\n- [ ] PIN verification succeeds with valid PIN\n- [ ] Success message/toast is shown\n- [ ] Receipt PDF opens in a new browser tab\n- [ ] Intake form modal closes\n- [ ] New ticket appears in the Intake lane on workboard\n- [ ] Ticket has correct data (customer name, description visible)\n- [ ] Lane count badge increments by 1\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:55.099349-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T14:35:20.57103-05:00","closed_at":"2026-01-20T14:35:20.57103-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-7dl","title":"UI Test: New ticket button opens intake form","description":"## Test: New Ticket Button\n\n### Preconditions\n- Dev server running\n- On workboard page\n\n### Steps\n1. Navigate to workboard (/)\n2. Locate the \"+New\" button in the Intake lane\n3. Click the \"+New\" button\n4. Observe what happens\n\n### Success Criteria\n- [ ] \"+New\" button is visible and clickable\n- [ ] Clicking opens the Intake Form modal\n- [ ] Modal has overlay/backdrop\n- [ ] Modal is centered on screen\n- [ ] Form fields are visible and empty (ready for input)\n- [ ] Close button (X) is visible in modal\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:52:39.488837-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:24:00.849311-05:00","closed_at":"2026-01-20T16:24:00.849311-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-7sh","title":"Create status and notes sections in TicketDetailModal","description":"Build status history and notes timeline.\n\nSteps:\n1. Status section: current status, rush toggle button\n2. Promise date display\n3. Status history list (who/when for each change)\n4. Notes section: add note input field + button\n5. Notes timeline (content, author, timestamp)\n6. Call POST /tickets/:id/notes to add note\n7. Prompt for employee ID when adding note\n\nFiles to modify:\n- apps/web/src/lib/components/TicketDetailModal.svelte\n\nSuccess criteria: Status/notes display, can add notes with attribution","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.350388-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:25:59.593397-05:00","closed_at":"2026-01-20T10:25:59.593397-05:00","close_reason":"Implemented status and notes sections in TicketDetailModal with rush toggle, status history timeline, and notes input with employee attribution","dependencies":[{"issue_id":"facet-7sh","depends_on_id":"facet-j6h","type":"blocks","created_at":"2026-01-19T22:21:11.230161-05:00","created_by":"Blake Blount"},{"issue_id":"facet-7sh","depends_on_id":"facet-nex","type":"blocks","created_at":"2026-01-19T22:21:11.581987-05:00","created_by":"Blake Blount"},{"issue_id":"facet-7sh","depends_on_id":"facet-alo","type":"blocks","created_at":"2026-01-19T22:21:11.729618-05:00","created_by":"Blake Blount"}]}
{"id":"facet-7tq","title":"Implement POST /admin/setup endpoint","description":"First-time admin setup (force password change).\n\nSteps:\n1. Add handler for initial setup\n2. Accept current_pin (default: changeme) and new_pin\n3. Verify current PIN\n4. Check setup_complete is false\n5. Hash and save new PIN\n6. Set setup_complete to true\n7. Error if already set up\n\nAPI: POST /api/v1/admin/setup\nBody: { \"current_pin\": \"changeme\", \"new_pin\": \"...\" }\n\nSuccess criteria: Changes default PIN on first use, blocks subsequent calls","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.913217-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:50:19.5824-05:00","closed_at":"2026-01-20T08:50:19.5824-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-7tq","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:19.745272-05:00","created_by":"Blake Blount"},{"issue_id":"facet-7tq","depends_on_id":"facet-4m6","type":"blocks","created_at":"2026-01-19T22:20:19.85936-05:00","created_by":"Blake Blount"}]}
{"id":"facet-7vm","title":"UI Test: Submit intake form triggers PIN verification","description":"## Test: PIN Modal on Form Submit\n\n### Preconditions\n- Dev server running\n- Intake form modal is open\n- All required fields are filled with valid data\n- At least 1 photo is uploaded\n\n### Steps\n1. Fill out all required fields in the intake form\n2. Click the Submit button\n3. Observe what modal appears\n\n### Success Criteria\n- [ ] After clicking Submit, PIN verification modal appears\n- [ ] PIN modal has title \"Verify Employee PIN\" or similar\n- [ ] PIN input field is present (password type, obscured)\n- [ ] Cancel button is available\n- [ ] Verify button is available\n- [ ] PIN input is auto-focused\n- [ ] Form data is preserved while PIN modal is open\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:54.956743-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T14:30:02.766269-05:00","closed_at":"2026-01-20T14:30:02.766269-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-7yc","title":"Implement GET /tickets/:id/label.pdf endpoint","description":"Generate and serve label PDF for physical tag.\n\nSteps:\n1. Add handler for label PDF\n2. Use PDF generation for small label size (2x1 inch)\n3. Include: friendly_code (large), short item descriptor, optional QR code\n4. Return PDF binary\n\nAPI: GET /api/v1/tickets/:ticket_id/label.pdf\n\nSuccess criteria: Returns printable label PDF","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.290674-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:50:07.138377-05:00","closed_at":"2026-01-20T06:50:07.138377-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-7yc","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:22.789693-05:00","created_by":"Blake Blount"},{"issue_id":"facet-7yc","depends_on_id":"facet-k4b","type":"blocks","created_at":"2026-01-19T22:20:22.853852-05:00","created_by":"Blake Blount"}]}
{"id":"facet-81i","title":"UI Test: Select customer from autocomplete populates fields","description":"## Test: Customer Selection Auto-Population\n\n### Preconditions\n- Dev server running\n- Database has customers with phone and email\n- Intake form modal is open\n\n### Steps\n1. Open intake form modal\n2. Type a customer name that has phone/email in database\n3. Wait for autocomplete dropdown\n4. Click on a customer in the dropdown\n5. Observe the phone and email fields\n\n### Success Criteria\n- [ ] Clicking customer fills the Customer Name field\n- [ ] Phone field auto-populates with customer's phone\n- [ ] Email field auto-populates with customer's email\n- [ ] Phone field becomes disabled/read-only after selection\n- [ ] Email field becomes disabled/read-only after selection\n- [ ] Autocomplete dropdown closes after selection\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:12.870584-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T15:40:01.126986-05:00","closed_at":"2026-01-20T15:40:01.126986-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-844","title":"Implement tickets repository - search and queue","description":"Add search and workboard queue queries to tickets repository.\n\n## Steps\n1. Implement search_tickets() with full-text search across ticket/customer/notes\n2. Implement get_queue() returning tickets grouped by status lane\n3. Implement is_overdue calculation\n4. Add sorting: rush first, then FIFO by created_at\n\n## Files to modify\n- apps/api/src/repositories/ticket.rs\n\n## Success criteria\nSearch returns relevant results, queue groups correctly","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.924139-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:32:18.729495-05:00","closed_at":"2026-01-20T06:32:18.729495-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-844","depends_on_id":"facet-k4b","type":"blocks","created_at":"2026-01-19T22:20:19.903963-05:00","created_by":"Blake Blount"}]}
{"id":"facet-85u","title":"Set up PWA manifest and service worker","description":"Configure PWA basics for offline capability.\n\nSteps:\n1. Create manifest.json with app name, icons, display mode\n2. Add manifest link to app.html\n3. Set up service worker using Vite PWA plugin or custom\n4. Cache static assets\n5. Cache API responses for offline reading\n6. Add install prompt handling\n\nFiles to create:\n- apps/web/static/manifest.json\n- apps/web/src/service-worker.ts (or configure vite-plugin-pwa)\n\nSuccess criteria: App installable, assets cached","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:38.799002-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T07:06:58.228741-05:00","closed_at":"2026-01-20T07:06:58.228741-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-85u","depends_on_id":"facet-6p6","type":"blocks","created_at":"2026-01-19T22:21:11.644011-05:00","created_by":"Blake Blount"}]}
{"id":"facet-8e7","title":"UI Test: Add note to ticket","description":"## Test: Add Note Flow\n\n### Preconditions\n- Dev server running\n- Ticket exists and is NOT closed\n- Know a valid employee PIN\n- Ticket detail modal is open\n\n### Steps\n1. Open detail modal for an open ticket\n2. Scroll to the Notes section\n3. Enter text in the note textarea\n4. Click \"Add Note\" button\n5. Enter PIN in the verification modal\n6. Click Verify\n7. Observe the result\n\n### Success Criteria\n- [ ] Notes section has textarea for new note\n- [ ] \"Add Note\" button is present (disabled until text entered)\n- [ ] Clicking \"Add Note\" triggers PIN modal\n- [ ] After PIN verification, note is added to the list\n- [ ] New note shows text, timestamp, and author name\n- [ ] Notes are listed in reverse chronological order (newest first)\n- [ ] Textarea clears after successful submission\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:55.935586-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T15:03:53.780622-05:00","closed_at":"2026-01-20T15:03:53.780622-05:00","close_reason":"Test completed successfully. Add note flow works correctly with PIN verification. One minor issue: notes display in chronological order (oldest first) instead of reverse chronological (newest first).","labels":["ui-test"]}
{"id":"facet-8hk","title":"Implement theme switcher store and logic","description":"Create Svelte store for theme switching.\n\nSteps:\n1. Create theme store with writable store\n2. Persist theme preference to localStorage\n3. Apply theme by setting data-theme attribute on html element\n4. Load correct theme CSS\n5. Create useTheme hook for components\n\nFiles to create:\n- apps/web/src/lib/stores/theme.ts\n\nSuccess criteria: Theme can be switched, persists across page loads","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:44.392723-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:35:55.941855-05:00","closed_at":"2026-01-20T09:35:55.941855-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-8hk","depends_on_id":"facet-cfs","type":"blocks","created_at":"2026-01-19T22:20:27.73296-05:00","created_by":"Blake Blount"},{"issue_id":"facet-8hk","depends_on_id":"facet-dz3","type":"blocks","created_at":"2026-01-19T22:20:27.771067-05:00","created_by":"Blake Blount"}]}
{"id":"facet-8lp","title":"Create SearchInput component","description":"Build search input with icon and clear button.\n\nSteps:\n1. Create SearchInput.svelte component\n2. Search icon prefix\n3. Clear button when has value\n4. Debounced input event\n5. Enter key to submit\n6. Theme styling\n\nFiles to create:\n- apps/web/src/lib/components/SearchInput.svelte\n\nSuccess criteria: Search input works with debounce","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:46.711852-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:27:41.327913-05:00","closed_at":"2026-01-20T11:27:41.327913-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-8lp","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:21:12.566237-05:00","created_by":"Blake Blount"}]}
{"id":"facet-8mk","title":"Create TicketCard component","description":"Build ticket card for workboard.\n\nSteps:\n1. Create TicketCard.svelte component\n2. Display: friendly_code (prominent), customer name, item description (truncated)\n3. Thumbnail image (first photo)\n4. Rush badge if is_rush\n5. Overdue indicator (red border) if past promise_date\n6. Promise date display\n7. Click opens ticket detail modal\n8. Draggable attribute for drag-and-drop\n\nFiles to create:\n- apps/web/src/lib/components/TicketCard.svelte\n\nSuccess criteria: Card displays all info, clickable","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.435148-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:33:33.979856-05:00","closed_at":"2026-01-20T11:33:33.979856-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-8mk","depends_on_id":"facet-iyl","type":"blocks","created_at":"2026-01-19T22:21:12.228136-05:00","created_by":"Blake Blount"},{"issue_id":"facet-8mk","depends_on_id":"facet-y53","type":"blocks","created_at":"2026-01-19T22:21:12.345004-05:00","created_by":"Blake Blount"}]}
{"id":"facet-8pz","title":"Fix page content alignment - pages are shifted left instead of centered","description":"## Problem Description\n\nAll pages in the application (main page, admin page, and other views) have their content shifted/aligned to the left side of the viewport instead of being properly centered. This affects:\n- The Kanban board on the main page\n- Admin page content\n- All other page layouts observed\n\n## Root Cause Investigation Steps\n\n1. Inspect the main layout container in `src/app/layout.tsx` or equivalent\n2. Check the page-level containers in individual route components\n3. Look for missing `mx-auto`, `flex justify-center`, or equivalent centering classes\n4. Verify max-width constraints are applied with proper auto margins\n5. Check if there's a sidebar or navigation affecting the layout\n\n## Likely Fix Approach\n\n- Add proper centering to the main content wrapper (e.g., `mx-auto` with a `max-w-*` constraint)\n- Or use flexbox centering: `flex justify-center` on parent container\n- Ensure consistent container width across all pages\n\n## Success Criteria\n\n- [ ] Main page content (including Kanban board) is horizontally centered in the viewport\n- [ ] Admin page content is horizontally centered\n- [ ] All other pages follow the same centered layout pattern\n- [ ] Content maintains proper max-width on large screens\n- [ ] Layout remains responsive on smaller screens\n- [ ] No horizontal scrollbar appears unexpectedly\n","status":"closed","priority":0,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T19:37:53.037418-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T20:17:09.026199-05:00","closed_at":"2026-01-20T20:17:09.026199-05:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"facet-8pz","author":"Blake Blount","text":"## Problem Description\n\nAll pages in the application (main page, admin page, and other views) have their content shifted/aligned to the left side of the viewport instead of being properly centered. This affects:\n- The Kanban board on the main page\n- Admin page content\n- All other page layouts observed\n\n## Root Cause Investigation Steps\n\n1. Inspect the main layout container in src/app/layout.tsx or equivalent\n2. Check the page-level containers in individual route components\n3. Look for missing mx-auto, flex justify-center, or equivalent centering classes\n4. Verify max-width constraints are applied with proper auto margins\n5. Check if there's a sidebar or navigation affecting the layout\n\n## Likely Fix Approach\n\n- Add proper centering to the main content wrapper (e.g., mx-auto with a max-w-* constraint)\n- Or use flexbox centering: flex justify-center on parent container\n- Ensure consistent container width across all pages\n\n## Success Criteria\n\n- [ ] Main page content (including Kanban board) is horizontally centered in the viewport\n- [ ] Admin page content is horizontally centered\n- [ ] All other pages follow the same centered layout pattern\n- [ ] Content maintains proper max-width on large screens\n- [ ] Layout remains responsive on smaller screens\n- [ ] No horizontal scrollbar appears unexpectedly","created_at":"2026-01-21T00:38:44Z"}]}
{"id":"facet-8qz","title":"Implement DELETE /employees/:id endpoint (admin)","description":"Admin endpoint to delete employee (with warning).\n\n## Steps\n1. Add handler for employee deletion\n2. Require X-Admin-PIN header\n3. Check for attribution history (warn if exists)\n4. Hard delete employee\n5. Return success/warning\n\n## API\nDELETE /api/v1/employees/:employee_id\n\n## Success Criteria\nDeletes employee, warns about history loss","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.257523-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:00:54.360228-05:00","closed_at":"2026-01-20T09:00:54.360228-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-8qz","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:24.167049-05:00","created_by":"Blake Blount"},{"issue_id":"facet-8qz","depends_on_id":"facet-cul","type":"blocks","created_at":"2026-01-19T22:20:24.310877-05:00","created_by":"Blake Blount"}]}
{"id":"facet-8r7","title":"UI Test: Search by ticket code","description":"## Test: Search by Ticket Code\n\n### Preconditions\n- Dev server running\n- Know an existing ticket code (e.g., \"T001\")\n\n### Steps\n1. Navigate to /search\n2. Enter a known ticket code in the search field\n3. Click Search\n4. Observe the results\n\n### Success Criteria\n- [ ] Entering ticket code and searching returns results\n- [ ] Matching ticket appears in results list\n- [ ] Result shows ticket code, status badge, customer name\n- [ ] Results count is accurate\n- [ ] Result card is clickable\n- [ ] Clicking opens ticket detail modal\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:26.534833-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T15:47:33.597188-05:00","closed_at":"2026-01-20T15:47:33.597188-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-97h","title":"Implement POST /locations endpoint (admin)","description":"Admin endpoint to create storage location.\n\n## Steps\n1. Add handler for location creation\n2. Require X-Admin-PIN header\n3. Validate unique name\n4. Create location record\n\n## API\nPOST /api/v1/locations\n\n## Success Criteria\nCreates location","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.537172-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:53:47.254458-05:00","closed_at":"2026-01-20T10:53:47.254458-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-97h","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:24.684388-05:00","created_by":"Blake Blount"},{"issue_id":"facet-97h","depends_on_id":"facet-dwy","type":"blocks","created_at":"2026-01-19T22:20:24.809368-05:00","created_by":"Blake Blount"}]}
{"id":"facet-9bi","title":"Form validation errors don't clear in real-time","description":"## Problem\nValidation errors in the intake form persist until form is resubmitted, even after filling the field correctly. This confuses users expecting immediate feedback.\n\n## Context from UI Testing\n- Test facet-i61: \"MEDIUM - Validation errors do not clear in real-time\"\n- Errors only clear after clicking \"Create \u0026 Print\" again\n- Validation only runs on submit, not on blur (leaving a field)\n- All 6 required fields affected\n\n## Root Cause\n- IntakeFormModal.svelte: validateForm() only runs on form submit\n- No blur event handlers attached to input fields\n- errors state object set once in validateForm(), only cleared on successful submit\n\n## Steps to Fix\n1. Add onblur handlers to required form fields\n2. Clear individual field error when field becomes valid\n3. Options:\n   a. Validate single field on blur\n   b. Run full validation on any field change\n   c. Clear error immediately when field has value\n\n## Success Criteria\n- [ ] Error clears when user fills required field correctly\n- [ ] Validation runs on blur (leaving a field)\n- [ ] Submit-time validation still works as fallback\n- [ ] UX feels responsive and helpful","status":"closed","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:40:31.427266-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T21:34:40.475685-05:00","closed_at":"2026-01-20T21:34:40.475685-05:00","close_reason":"Closed"}
{"id":"facet-9f9","title":"CRIT-4: Add setup deadline for default admin PIN","description":"## Problem\nDefault admin PIN is \"changeme\" with no forced expiration. The `setup_complete` flag prevents re-running setup, but if initial setup is skipped, the default PIN remains valid indefinitely. Forgotten deployments or test instances remain accessible with default credentials.\n\n## Location\n- `apps/api/src/handlers/admin.rs:admin_setup`\n- `apps/api/migrations/001_initial_schema.sql` - store_settings table\n\n## Files to Modify\n- `apps/api/migrations/` - New migration for setup_deadline column\n- `apps/api/src/models/store_settings.rs` - Add setup_deadline field\n- `apps/api/src/repositories/store_settings.rs` - Add deadline checking\n- `apps/api/src/handlers/admin.rs` - Enforce deadline\n- `apps/api/src/handlers/employees.rs` - Check setup before employee operations\n- `apps/api/src/handlers/settings.rs` - Check setup before settings operations\n\n## Implementation Steps\n\n### Step 1: Create Migration\nCreate `apps/api/migrations/002_add_setup_deadline.sql`:\n\n```sql\n-- Add setup deadline to enforce PIN change within 24 hours of deployment\nALTER TABLE store_settings \nADD COLUMN setup_deadline TIMESTAMPTZ NOT NULL DEFAULT (NOW() + INTERVAL '24 hours');\n\n-- Add minimum PIN length requirement tracking\nALTER TABLE store_settings\nADD COLUMN min_pin_length INTEGER NOT NULL DEFAULT 6;\n```\n\n### Step 2: Update Models\nIn `models/store_settings.rs`:\n- Add `setup_deadline: DateTime\u003cUtc\u003e` field\n- Add `min_pin_length: i32` field\n- Update `StoreSettingsPublic` to include `setup_required: bool` computed field\n\n### Step 3: Create Setup Check Helper\nIn `repositories/store_settings.rs`:\n\n```rust\npub async fn is_setup_required(pool: \u0026PgPool) -\u003e Result\u003cbool, AppError\u003e {\n    let result = sqlx::query_scalar::\u003c_, bool\u003e(\n        \"SELECT NOT setup_complete AND setup_deadline \u003e NOW() FROM store_settings LIMIT 1\"\n    )\n    .fetch_one(pool)\n    .await?;\n    \n    Ok(result)\n}\n\npub async fn is_setup_expired(pool: \u0026PgPool) -\u003e Result\u003cbool, AppError\u003e {\n    let result = sqlx::query_scalar::\u003c_, bool\u003e(\n        \"SELECT NOT setup_complete AND setup_deadline \u003c= NOW() FROM store_settings LIMIT 1\"\n    )\n    .fetch_one(pool)\n    .await?;\n    \n    Ok(result)\n}\n```\n\n### Step 4: Enforce Deadline in Admin Endpoints\nBefore any admin operation, check:\n1. If setup_complete = false AND setup_deadline expired -\u003e return error requiring manual intervention\n2. If setup_complete = false AND within deadline -\u003e redirect to setup\n\nError response for expired deadline:\n```json\n{\n  \"code\": \"SETUP_EXPIRED\",\n  \"message\": \"Initial setup deadline has passed. Please contact system administrator.\"\n}\n```\n\n### Step 5: Add PIN Complexity Validation\nIn `admin_setup` and `change_pin`:\n- Minimum length: 6 characters (configurable via min_pin_length)\n- Reject common patterns: \"000000\", \"123456\", \"111111\"\n- Consider digit + letter requirement for higher security\n\n### Step 6: Log Default PIN Usage\nAdd tracing when default PIN is used:\n```rust\ntracing::warn!(\"Admin operation attempted with default PIN - setup incomplete\");\n```\n\n## Success Criteria\n- [ ] Setup deadline is set to 24 hours from deployment\n- [ ] Admin operations fail after deadline if setup incomplete\n- [ ] Clear error message indicates setup has expired\n- [ ] PIN minimum length is enforced (6 characters)\n- [ ] Common PIN patterns are rejected\n- [ ] Default PIN usage is logged as warning\n- [ ] Existing functionality works when setup is complete\n\n## Testing Requirements\n\n### Unit Tests\n- PIN complexity validation rejects short PINs\n- PIN complexity validation rejects common patterns\n- PIN complexity validation accepts valid PINs\n\n### Integration Tests\nCreate `apps/api/tests/admin_setup.rs`:\n1. Fresh install has 24-hour deadline\n2. Admin verify works within deadline with default PIN\n3. Admin setup works within deadline\n4. After setup complete, deadline doesn't matter\n5. (Time-based) After deadline expires, admin operations fail\n6. Setup with weak PIN (123456) is rejected\n7. Setup with valid PIN (abc123) succeeds\n\n### Manual Testing\n1. Deploy fresh instance\n2. Verify deadline in database is ~24 hours out\n3. Complete setup before deadline\n4. Verify normal operation\n5. Deploy another instance, wait for deadline, verify lockout\n\n## Security Validation\n- Verify deadline cannot be extended via API\n- Confirm expired state requires database-level intervention to reset\n- Test that admin endpoints properly check setup status before all operations","status":"closed","priority":0,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:30:34.985507-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T23:12:14.852113-05:00","closed_at":"2026-01-20T23:12:14.852113-05:00","close_reason":"Closed"}
{"id":"facet-9j0","title":"Fix modal window positioning - modals appear on left side instead of centered","description":"## Problem Description\n\nModal windows/dialogs throughout the application appear positioned on the left side of the screen instead of being centered. This creates a poor user experience and looks unprofessional.\n\n## Root Cause Investigation Steps\n\n1. Locate the modal/dialog component(s) in use - check `src/components/ui/` for dialog, modal, or sheet components\n2. If using shadcn/ui, check `dialog.tsx` or similar\n3. Inspect the overlay and content positioning CSS\n4. Look for missing centering classes like `fixed inset-0 flex items-center justify-center`\n5. Check if custom positioning overrides are interfering\n\n## Likely Fix Approach\n\nFor a typical modal implementation, ensure:\n- Overlay uses `fixed inset-0` to cover full viewport\n- Content wrapper uses `flex items-center justify-center` for centering\n- Or use CSS: `position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%)`\n\nIf using shadcn/ui Dialog:\n- Check DialogContent component styling\n- Should have: `fixed left-[50%] top-[50%] translate-x-[-50%] translate-y-[-50%]`\n\n## Files to Check\n\n- `src/components/ui/dialog.tsx` (if exists)\n- Any custom modal components\n- Global CSS that might override modal positioning\n\n## Success Criteria\n\n- [ ] All modal windows appear centered horizontally and vertically in the viewport\n- [ ] Modals remain centered on different screen sizes\n- [ ] Modal backdrop/overlay covers the entire screen\n- [ ] Scrolling behavior works correctly for modals with long content\n- [ ] Modals work correctly on mobile viewports\n","status":"closed","priority":0,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T19:37:53.14604-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T20:21:02.813288-05:00","closed_at":"2026-01-20T20:21:02.813288-05:00","close_reason":"Closed","comments":[{"id":2,"issue_id":"facet-9j0","author":"Blake Blount","text":"## Problem Description\n\nModal windows/dialogs throughout the application appear positioned on the left side of the screen instead of being centered. This creates a poor user experience and looks unprofessional.\n\n## Root Cause Investigation Steps\n\n1. Locate the modal/dialog component(s) in use - check src/components/ui/ for dialog, modal, or sheet components\n2. If using shadcn/ui, check dialog.tsx or similar\n3. Inspect the overlay and content positioning CSS\n4. Look for missing centering classes like fixed inset-0 flex items-center justify-center\n5. Check if custom positioning overrides are interfering\n\n## Likely Fix Approach\n\nFor a typical modal implementation, ensure:\n- Overlay uses fixed inset-0 to cover full viewport\n- Content wrapper uses flex items-center justify-center for centering\n- Or use CSS: position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%)\n\nIf using shadcn/ui Dialog:\n- Check DialogContent component styling\n- Should have: fixed left-[50%] top-[50%] translate-x-[-50%] translate-y-[-50%]\n\n## Files to Check\n\n- src/components/ui/dialog.tsx (if exists)\n- Any custom modal components\n- Global CSS that might override modal positioning\n\n## Success Criteria\n\n- [ ] All modal windows appear centered horizontally and vertically in the viewport\n- [ ] Modals remain centered on different screen sizes\n- [ ] Modal backdrop/overlay covers the entire screen\n- [ ] Scrolling behavior works correctly for modals with long content\n- [ ] Modals work correctly on mobile viewports","created_at":"2026-01-21T00:38:44Z"}]}
{"id":"facet-9k3","title":"Implement GET /tickets/:id endpoint","description":"Create endpoint to get full ticket details.\n\nSteps:\n1. Add handler for ticket detail\n2. Fetch ticket with customer, photos, notes, status_history\n3. Generate signed URLs for photos\n4. Include employee names for attribution\n5. Return full ticket response per API.md\n\nAPI: GET /api/v1/tickets/:ticket_id\n\nSuccess criteria: Returns complete ticket with all related data","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.280729-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:46:08.726052-05:00","closed_at":"2026-01-20T06:46:08.726052-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-9k3","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:18.571139-05:00","created_by":"Blake Blount"},{"issue_id":"facet-9k3","depends_on_id":"facet-k4b","type":"blocks","created_at":"2026-01-19T22:20:19.044004-05:00","created_by":"Blake Blount"}]}
{"id":"facet-9k9","title":"UI Test: Add photo to existing ticket","description":"## Test: Add Photo to Ticket\n\n### Preconditions\n- Dev server running\n- Ticket exists with less than 10 photos\n- Ticket is NOT in Closed status\n- Know a valid employee PIN\n- Have a test image file ready\n\n### Steps\n1. Open detail modal for an open ticket\n2. Locate the \"Add Photo\" button in photos section\n3. Click \"Add Photo\"\n4. Select a photo file\n5. Complete upload (may require PIN)\n6. Observe the result\n\n### Success Criteria\n- [ ] \"Add Photo\" button is visible (when \u003c 10 photos and not closed)\n- [ ] Clicking opens file upload dialog or modal\n- [ ] Can select one or more photos\n- [ ] Upload progress is shown\n- [ ] After upload, new photo appears in the grid\n- [ ] Photo count updates\n- [ ] If 10 photos reached, \"Add Photo\" button hides\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:55.796215-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T14:56:24.108544-05:00","closed_at":"2026-01-20T14:56:24.108544-05:00","close_reason":"Test completed with FAIL status - discovered bug: Add Photo feature missing employee PIN verification flow","labels":["ui-test"]}
{"id":"facet-9ud","title":"Create admin settings modal structure","description":"Build settings modal with tabs.\n\nSteps:\n1. Create AdminSettingsModal.svelte component\n2. Prompt for admin PIN on open\n3. Tab navigation: Store Info, Employees, Locations, Appearance\n4. Tab content areas\n5. Close button\n\nFiles to create:\n- apps/web/src/lib/components/AdminSettingsModal.svelte\n\nSuccess criteria: Modal opens after PIN, tabs work","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.529338-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:29:14.390569-05:00","closed_at":"2026-01-20T10:29:14.390569-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-9ud","depends_on_id":"facet-eyr","type":"blocks","created_at":"2026-01-19T22:21:23.209771-05:00","created_by":"Blake Blount"},{"issue_id":"facet-9ud","depends_on_id":"facet-ubq","type":"blocks","created_at":"2026-01-19T22:21:23.255366-05:00","created_by":"Blake Blount"},{"issue_id":"facet-9ud","depends_on_id":"facet-alo","type":"blocks","created_at":"2026-01-19T22:21:23.29623-05:00","created_by":"Blake Blount"}]}
{"id":"facet-9ui6","title":"LOW-2: Consider authentication for settings read endpoint","description":"## Problem\nThe `GET /api/v1/settings` endpoint returns store settings without authentication. This exposes store name, address, phone, ticket prefix, and configuration to unauthenticated users.\n\n## Location\n- `apps/api/src/handlers/settings.rs:get_settings`\n\n## Current Behavior\nReturns `StoreSettingsPublic`:\n```rust\npub struct StoreSettingsPublic {\n    pub setting_id: Uuid,\n    pub store_name: String,\n    pub store_phone: Option\u003cString\u003e,\n    pub store_address: Option\u003cString\u003e,\n    pub ticket_prefix: String,\n    pub next_ticket_number: i32,\n    pub currency: String,\n    pub max_photos_per_ticket: i32,\n    pub setup_complete: bool,\n    pub created_at: DateTime\u003cUtc\u003e,\n    pub updated_at: DateTime\u003cUtc\u003e,\n}\n```\n\n## Risk Assessment\n**Low Risk** - The exposed information is:\n- Store name/phone/address: Typically public anyway (storefront)\n- Ticket prefix/currency: Not sensitive\n- Max photos: Configuration info\n- Setup complete: Could indicate target for attack if false\n\n## Files to Modify\n- `apps/api/src/handlers/settings.rs` - Optional auth or split endpoints\n- `apps/api/src/models/store_settings.rs` - Maybe create public vs private views\n\n## Implementation Options\n\n### Option A: Accept as Public (Minimal Change)\nDocument that GET /settings is intentionally public and review what's exposed:\n\n```rust\n/// GET /api/v1/settings - Get store settings (PUBLIC endpoint).\n/// \n/// Returns non-sensitive store configuration.\n/// This endpoint is intentionally unauthenticated for PWA initial load.\npub async fn get_settings(...) {\n```\n\nConsider removing `setup_complete` from public response:\n```rust\npub struct StoreSettingsPublic {\n    pub store_name: String,\n    pub store_phone: Option\u003cString\u003e,\n    pub store_address: Option\u003cString\u003e,\n    pub ticket_prefix: String,\n    pub currency: String,\n    // Removed: setup_complete, next_ticket_number, max_photos_per_ticket\n}\n```\n\n### Option B: Split Public/Private Settings\nCreate two endpoints:\n\n```rust\n// Public (no auth): Basic branding info\n// GET /api/v1/settings/public\npub async fn get_public_settings(...) -\u003e StoreSettingsPublic {\n    // Only store_name, store_phone, store_address, currency\n}\n\n// Private (auth required): All configuration\n// GET /api/v1/settings\npub async fn get_settings(...) -\u003e StoreSettingsFull {\n    extract_employee_from_session(\u0026state, \u0026headers).await?;\n    // All fields including setup_complete, next_ticket_number, etc.\n}\n```\n\n### Option C: Require Authentication\nMake the entire endpoint require authentication:\n\n```rust\npub async fn get_settings(\n    State(state): State\u003cAppState\u003e,\n    headers: HeaderMap,\n) -\u003e Result\u003cimpl IntoResponse, AppError\u003e {\n    extract_employee_from_session(\u0026state, \u0026headers).await?;\n    \n    let settings = StoreSettingsRepository::get_settings_public(\u0026state.db).await?;\n    Ok(Json(ApiResponse::success(settings)))\n}\n```\n\n## Recommendation\n**Option A** with field review is likely sufficient:\n1. Keep endpoint public for easy frontend access\n2. Remove `setup_complete` from public response (security indicator)\n3. Remove `next_ticket_number` (potential enumeration)\n4. Keep store info (name, phone, address, currency, prefix)\n5. Document as intentionally public\n\n## Success Criteria\n- [ ] Decision made on auth requirement (document if keeping public)\n- [ ] Sensitive fields reviewed and removed if necessary\n- [ ] `setup_complete` not exposed to unauthenticated users\n- [ ] `next_ticket_number` not exposed (prevents ticket enumeration)\n- [ ] Frontend continues to work (pre-login branding)\n- [ ] API documentation updated to reflect decision\n\n## Testing Requirements\n\n### If Auth Added\n1. GET /settings without auth -\u003e 401\n2. GET /settings with valid session -\u003e 200\n\n### If Kept Public (with field review)\n1. GET /settings returns expected public fields\n2. GET /settings does NOT include setup_complete\n3. GET /settings does NOT include next_ticket_number\n4. Frontend loads settings on initial page load\n\n### Security Review\n- Verify setup_complete cannot be inferred from other responses\n- Confirm next_ticket_number not exposed anywhere else\n\n## Alternatives Considered\n- **Require auth for all endpoints**: Too restrictive for PWA initial load\n- **Use JWT for public reads**: Over-engineering for MVP\n- **Per-field access control**: Too complex\n\n## Notes\nThis is a LOW priority issue because:\n1. Most exposed data is not sensitive\n2. The store info would be public anyway (physical store)\n3. Main concern (setup_complete) can be addressed by field removal\n\nHowever, it should be addressed before production to follow principle of least exposure.","status":"closed","priority":3,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:38:47.013091-05:00","created_by":"Blake Blount","updated_at":"2026-01-21T01:02:04.29043-05:00","closed_at":"2026-01-21T01:02:04.29043-05:00","close_reason":"Closed"}
{"id":"facet-a68","title":"Create employees management tab","description":"Build employee list and management.\n\nSteps:\n1. List employees from GET /employees\n2. Show name, role, active status\n3. \"Add Employee\" button opens inline form\n4. Edit button for each employee\n5. Deactivate/Activate toggle\n6. Delete button (with confirmation)\n7. Call appropriate employee APIs\n\nFiles to modify:\n- apps/web/src/lib/components/AdminSettingsModal.svelte\n\nSuccess criteria: Can list, add, edit, deactivate employees","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.766018-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:34:57.979028-05:00","closed_at":"2026-01-20T10:34:57.979028-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-a68","depends_on_id":"facet-9ud","type":"blocks","created_at":"2026-01-19T22:21:25.494915-05:00","created_by":"Blake Blount"},{"issue_id":"facet-a68","depends_on_id":"facet-nex","type":"blocks","created_at":"2026-01-19T22:21:29.913685-05:00","created_by":"Blake Blount"},{"issue_id":"facet-a68","depends_on_id":"facet-4p6","type":"blocks","created_at":"2026-01-19T22:21:29.978164-05:00","created_by":"Blake Blount"}]}
{"id":"facet-a81","title":"UI Test: Toggle rush status on ticket","description":"## Test: Rush Status Toggle\n\n### Preconditions\n- Dev server running\n- Ticket exists and is NOT closed\n- Know a valid employee PIN\n- Ticket detail modal is open\n\n### Steps\n1. Open detail modal for a non-rush ticket\n2. Locate the Rush toggle button (e.g., \"Mark Rush\")\n3. Click the toggle button\n4. Enter PIN when prompted\n5. Observe the result\n6. Toggle it back off (if possible)\n\n### Success Criteria\n- [ ] Rush toggle button is visible for open tickets\n- [ ] Shows \"Mark Rush\" when not rush, \"Remove Rush\" when rush\n- [ ] Clicking triggers PIN verification\n- [ ] After PIN verify, rush status changes\n- [ ] Visual indicators update (badge appears/disappears)\n- [ ] Ticket card on workboard shows rush styling after close\n- [ ] Can toggle back to remove rush status\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:25.807722-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T15:17:39.090105-05:00","closed_at":"2026-01-20T15:17:39.090105-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-a9d","title":"UI Test: Status badges have correct colors","description":"## Test: Status Badge Color Coding\n\n### Preconditions\n- Dev server running\n- Tickets exist in various statuses\n\n### Steps\n1. Navigate to workboard\n2. Observe ticket cards in each lane\n3. Navigate to search, search for tickets\n4. Observe status badges in results\n5. Open detail modals, observe status badge\n\n### Success Criteria\n- [ ] Intake status badge is purple/violet\n- [ ] In Progress status badge is blue\n- [ ] Waiting on Parts status badge is amber/gold\n- [ ] Ready for Pickup status badge is green\n- [ ] Closed/Archived status badge is gray\n- [ ] Colors are consistent across workboard, search, and detail modal\n- [ ] Colors provide clear visual differentiation\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:56:00.545132-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:13:38.061675-05:00","closed_at":"2026-01-20T18:13:38.061675-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-aco","title":"Add PIN verification to photo upload flow in TicketDetailModal","description":"## Problem\nAdding photos to existing tickets fails with \"X-Employee-ID header is required\" error. The Add Photo flow is missing employee PIN verification.\n\n## Context from UI Testing\n- Test facet-9k9: \"FAIL - Photo upload fails with X-Employee-ID header required\"\n- Other actions (toggle rush, add note) correctly show EmployeeIdModal first\n- Photo upload skips this pattern - directly calls API without PIN verification\n\n## Root Cause\n- TicketDetailModal.svelte line 206: handleUploadPhotos() directly calls API\n- Other actions use pattern: set pending action -\u003e show modal -\u003e on success set employee -\u003e perform action\n- uploadTicketPhoto() API requires currentEmployeeId to be set via setCurrentEmployee()\n\n## Steps to Fix\n1. Open apps/web/src/lib/components/TicketDetailModal.svelte\n2. Add state variables: showUploadEmployeeModal, pendingUploadFiles\n3. When user clicks \"Upload\" button, store files and show EmployeeIdModal\n4. On PIN success callback, call setCurrentEmployee(employee.employee_id)\n5. Then call handleUploadPhotos() with the stored files\n6. Clear employee after upload completes\n7. Follow same pattern used by rush toggle (lines 334-357)\n\n## Success Criteria\n- [ ] Clicking Upload triggers PIN verification modal\n- [ ] After valid PIN, photos upload successfully\n- [ ] Photo count updates in modal header\n- [ ] New photos appear in the grid\n- [ ] Invalid PIN shows error, allows retry","status":"closed","priority":1,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:39:34.36006-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T21:07:34.561444-05:00","closed_at":"2026-01-20T21:07:34.561444-05:00","close_reason":"Closed"}
{"id":"facet-alo","title":"Create EmployeeIdModal component","description":"Build modal for employee PIN entry.\n\nSteps:\n1. Create EmployeeIdModal.svelte component\n2. Simple PIN input field (password type or visible)\n3. Enter key submits\n4. Call /employees/verify API\n5. Show error if invalid\n6. Return employee_id on success\n7. Auto-focus input when opened\n\nFiles to create:\n- apps/web/src/lib/components/EmployeeIdModal.svelte\n\nSuccess criteria: PIN entry works, validates, returns employee","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:46.60567-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:20:47.181335-05:00","closed_at":"2026-01-20T10:20:47.181335-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-alo","depends_on_id":"facet-eyr","type":"blocks","created_at":"2026-01-19T22:21:12.683995-05:00","created_by":"Blake Blount"},{"issue_id":"facet-alo","depends_on_id":"facet-nex","type":"blocks","created_at":"2026-01-19T22:21:12.802524-05:00","created_by":"Blake Blount"}]}
{"id":"facet-ao3","title":"Implement PUT /locations/:id endpoint (admin)","description":"Admin endpoint to update location.\n\n## Steps\n1. Add handler for location update\n2. Require X-Admin-PIN header\n3. Update name or is_active\n\n## API\nPUT /api/v1/locations/:location_id\n\n## Success Criteria\nUpdates location, can deactivate","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.666527-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:57:35.88968-05:00","closed_at":"2026-01-20T10:57:35.88968-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-ao3","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:24.925782-05:00","created_by":"Blake Blount"},{"issue_id":"facet-ao3","depends_on_id":"facet-dwy","type":"blocks","created_at":"2026-01-19T22:20:25.042827-05:00","created_by":"Blake Blount"}]}
{"id":"facet-b24","title":"Implement POST /tickets/:id/photos endpoint","description":"Handle photo upload to S3 and record in database.\n\nSteps:\n1. Add multipart form handler\n2. Validate X-Employee-ID header\n3. Check photo limit (max 10 per ticket)\n4. Validate file type (jpeg, png, webp) and size (max 10MB)\n5. Upload to S3 with unique key\n6. Create ticket_photos record\n7. Return photo with signed URL\n\nAPI: POST /api/v1/tickets/:ticket_id/photos\nContent-Type: multipart/form-data\n\nSuccess criteria: Uploads photo, returns URL","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.514124-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:18:12.018103-05:00","closed_at":"2026-01-20T08:18:12.018103-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-b24","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:18.7669-05:00","created_by":"Blake Blount"},{"issue_id":"facet-b24","depends_on_id":"facet-eji","type":"blocks","created_at":"2026-01-19T22:20:18.811806-05:00","created_by":"Blake Blount"}]}
{"id":"facet-b7m","title":"UI Test: Clear filters button","description":"## Test: Clear Filters\n\n### Preconditions\n- Dev server running\n- On search page with active filters\n\n### Steps\n1. Navigate to /search\n2. Apply filters (status, date range, search text)\n3. Click Search\n4. Observe the Clear Filters button\n5. Click Clear Filters\n6. Observe the form and results\n\n### Success Criteria\n- [ ] Clear Filters button appears only when filters are active\n- [ ] Clicking clears all filter fields\n- [ ] Search text is cleared\n- [ ] Status returns to \"All Statuses\"\n- [ ] Date fields are cleared\n- [ ] Results update (show all or prompt to search again)\n- [ ] Button hides after clearing\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:57.863144-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:44:36.394845-05:00","closed_at":"2026-01-20T18:44:36.394845-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-bau","title":"Implement admin page authentication for employee list","description":"## Problem\nAdmin page cannot display employee list because API authentication is not implemented in frontend. API correctly requires X-Admin-PIN header, but frontend doesn't send it.\n\n## Context from UI Testing\n- Test facet-5f4: \"BLOCKED (Authentication Required)\"\n- User sees \"No employees configured yet.\" even when 2 employees exist in database\n- API /api/v1/employees returns 401 \"Missing X-Admin-PIN header\"\n- API works correctly when X-Admin-PIN header is provided\n\n## Root Cause\n- API endpoint `list_employees()` requires `X-Admin-PIN` header for authorization\n- Page loader (apps/web/src/routes/admin/+page.server.ts) fetches without auth header\n- No admin authentication flow exists in frontend\n\n## Steps to Fix\n1. Design admin authentication UX (options):\n   a. Add PIN prompt on admin page load\n   b. Store admin session after PIN verification\n   c. Use existing EmployeeIdModal component for PIN entry\n2. Implement authentication state management\n3. Update +page.server.ts loader to include X-Admin-PIN header\n4. Consider session persistence (localStorage/cookie)\n5. Handle authentication failures gracefully\n6. Test employee list displays after authentication\n\n## Success Criteria\n- [ ] Admin page prompts for PIN when needed\n- [ ] After valid PIN entry, employee list loads and displays\n- [ ] Each employee shows name and role badge (admin/staff)\n- [ ] Invalid PIN shows error message\n- [ ] Authentication persists appropriately (session or per-request)\n- [ ] Logout/re-auth mechanism available","status":"closed","priority":0,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:39:34.207792-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T20:53:38.573557-05:00","closed_at":"2026-01-20T20:53:38.573557-05:00","close_reason":"Closed"}
{"id":"facet-bp2","title":"UI Test: Search by customer name","description":"## Test: Search by Customer Name\n\n### Preconditions\n- Dev server running\n- Know a customer name with tickets\n\n### Steps\n1. Navigate to /search\n2. Enter a known customer name (or partial name)\n3. Click Search\n4. Observe the results\n\n### Success Criteria\n- [ ] Search by customer name returns matching tickets\n- [ ] All tickets for that customer are shown\n- [ ] Partial name matches work (e.g., \"John\" matches \"John Smith\")\n- [ ] Results display customer name, ticket info\n- [ ] Case insensitive search works\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:26.674921-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:40:42.256913-05:00","closed_at":"2026-01-20T16:40:42.256913-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-bvb","title":"Fix receipt PDF 404 via Vite dev server proxy","description":"## Problem\nReceipt PDF endpoint returns 404 when accessed via Vite dev server proxy. The PDF is correctly generated by the API (verified with direct curl).\n\n## Context from UI Testing\n- Test facet-7ce: \"MEDIUM - Receipt PDF endpoint returns 404 via Vite proxy\"\n- URL: localhost:5173/api/v1/tickets/{id}/receipt.pdf returns 404\n- Direct API access works: curl localhost:3001/api/v1/tickets/{id}/receipt.pdf returns valid PDF\n- May be related to .pdf file extension handling or service worker interception\n\n## Root Cause Investigation\n1. Vite proxy config in apps/web/vite.config.ts\n2. Service worker may be intercepting requests\n3. .pdf extension may not be proxied correctly\n\n## Steps to Fix\n1. Check vite.config.ts proxy configuration\n2. Ensure /api/* routes proxy correctly including .pdf\n3. Check service worker registration/scope\n4. Test with service worker disabled\n5. Add explicit proxy rule for PDF endpoints if needed\n\n## Success Criteria\n- [ ] Receipt PDF opens in new tab when clicking \"Print Receipt\"\n- [ ] PDF displays correctly in browser viewer\n- [ ] Works for all ticket types (rush, non-rush, closed)","status":"closed","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:40:29.479292-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T21:17:19.116444-05:00","closed_at":"2026-01-20T21:17:19.116444-05:00","close_reason":"Issue no longer reproducible. Extensive testing confirms receipt PDF works correctly via Vite proxy in all scenarios: direct URL navigation, Print Receipt button click, and curl tests. The issue was likely an intermittent service worker caching state that has since cleared."}
{"id":"facet-bx2","title":"Create customer and item info sections in TicketDetailModal","description":"Build info display sections for ticket detail.\n\nSteps:\n1. Customer section: name, phone, email\n2. Item section: type, description, condition_notes, requested_work\n3. Storage location display\n4. Editable indicator (pencil icon) for when editing is enabled\n5. Clean, readable layout\n\nFiles to modify:\n- apps/web/src/lib/components/TicketDetailModal.svelte\n\nSuccess criteria: Customer and item info display correctly","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.037692-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:40:06.417743-05:00","closed_at":"2026-01-20T09:40:06.417743-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-bx2","depends_on_id":"facet-j6h","type":"blocks","created_at":"2026-01-19T22:21:10.962786-05:00","created_by":"Blake Blount"}]}
{"id":"facet-c09","title":"Clear image preview when intake flow is cancelled or fails PIN validation","description":"## Problem Description\n\nWhen creating a new intake, the first step is uploading a photo. If the user:\n- Clicks \"Print\" but enters an incorrect PIN, or\n- Doesn't enter a PIN and closes the modal\n\n...all form fields are correctly zeroed out. However, the **image preview from the previous incomplete attempt still appears** in the modal window when starting a new intake.\n\nThe image data itself is not persisted (the system correctly knows there's no photo), but the preview thumbnail/display is not being cleared from the UI state.\n\n## Expected Behavior\n\nWhen the intake flow is cancelled or fails PIN validation:\n1. All form fields should reset (currently works ✓)\n2. The image preview should be cleared (currently broken ✗)\n3. The next new intake should show a clean upload state with no preview\n\n## Root Cause Investigation Steps\n\n1. Find the intake modal component and its state management\n2. Locate where the image preview state is stored (likely a React state variable or ref)\n3. Check the cancel/close handler and PIN validation failure handler\n4. Verify if these handlers are resetting the image preview state\n5. Look for any `useState` for image/preview that isn't being reset\n\n## Likely Fix Approach\n\nIn the modal close/cancel handler and PIN validation failure handler:\n- Reset the image preview state to null/undefined\n- Clear any object URLs created for the preview (to prevent memory leaks)\n- Example: `setImagePreview(null)` or `previewRef.current = null`\n\nIf using object URLs:\n```javascript\nif (previewUrl) {\n  URL.revokeObjectURL(previewUrl);\n}\nsetPreviewUrl(null);\n```\n\n## Success Criteria\n\n- [ ] Cancelling an intake (closing modal without completing) clears the image preview\n- [ ] Failing PIN validation clears the image preview\n- [ ] Starting a new intake after a cancelled one shows clean upload state\n- [ ] No image preview persists between intake attempts\n- [ ] No memory leaks from unreleased object URLs\n","status":"closed","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T19:50:02.755429-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T20:29:51.384833-05:00","closed_at":"2026-01-20T20:29:51.384833-05:00","close_reason":"Closed"}
{"id":"facet-c84","title":"UI Test: Print tag/label button","description":"## Test: Print Tag/Label\n\n### Preconditions\n- Dev server running\n- Ticket exists\n- Ticket detail modal is open\n\n### Steps\n1. Open detail modal for any ticket\n2. Locate the \"Print Tag\" or \"Print Label\" button\n3. Click the button\n4. Observe what happens\n\n### Success Criteria\n- [ ] \"Print Tag\" button is visible\n- [ ] Clicking opens a new browser tab\n- [ ] New tab contains a PDF or printable tag\n- [ ] Tag shows ticket code prominently\n- [ ] Tag shows essential info (customer name, item type)\n- [ ] Tag is sized for physical tag printing (small format)\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:26.099969-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:21:50.380866-05:00","closed_at":"2026-01-20T16:21:50.380866-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-c9i","title":"Implement PUT /employees/:id endpoint (admin)","description":"Admin endpoint to update employee.\n\n## Steps\n1. Add handler for employee update\n2. Require X-Admin-PIN header\n3. Update name, role, is_active\n4. If PIN provided, re-hash and update\n\n## API\nPUT /api/v1/employees/:employee_id\n\n## Success Criteria\nUpdates employee fields","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.111111-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:56:35.706075-05:00","closed_at":"2026-01-20T08:56:35.706075-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-c9i","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:23.913491-05:00","created_by":"Blake Blount"},{"issue_id":"facet-c9i","depends_on_id":"facet-cul","type":"blocks","created_at":"2026-01-19T22:20:24.036398-05:00","created_by":"Blake Blount"}]}
{"id":"facet-cb4","title":"Create Select/dropdown component","description":"Build styled select dropdown.\n\nSteps:\n1. Create Select.svelte component\n2. Props: label, options, value, placeholder, disabled\n3. Options as array of {value, label}\n4. Custom styling (not native select)\n5. Keyboard navigation\n6. Theme styling\n\nFiles to create:\n- apps/web/src/lib/components/Select.svelte\n\nSuccess criteria: Select works with keyboard and mouse","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:46.072781-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:56:35.285537-05:00","closed_at":"2026-01-20T09:56:35.285537-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-cb4","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:21:11.980951-05:00","created_by":"Blake Blount"}]}
{"id":"facet-ce0","title":"Create search results page","description":"Build search results display.\n\nSteps:\n1. Create or update routes/search/+page.svelte\n2. Get search query from URL params\n3. Call GET /tickets with search param\n4. Display results as list cards\n5. Show: ticket code, customer name, item description, status badge\n6. Include closed/archived tickets (with badge)\n7. Click result opens ticket detail modal\n8. Empty state if no results\n\nFiles to create/modify:\n- apps/web/src/routes/search/+page.svelte\n- apps/web/src/routes/search/+page.ts\n\nSuccess criteria: Search results display, can open tickets","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.239755-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:13:59.776835-05:00","closed_at":"2026-01-20T11:13:59.776835-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-ce0","depends_on_id":"facet-01b","type":"blocks","created_at":"2026-01-19T22:21:16.814718-05:00","created_by":"Blake Blount"},{"issue_id":"facet-ce0","depends_on_id":"facet-iyl","type":"blocks","created_at":"2026-01-19T22:21:16.861152-05:00","created_by":"Blake Blount"},{"issue_id":"facet-ce0","depends_on_id":"facet-ubq","type":"blocks","created_at":"2026-01-19T22:21:16.90181-05:00","created_by":"Blake Blount"}]}
{"id":"facet-cfs","title":"Implement Imperial theme CSS","description":"Create Imperial theme (primary luxury aesthetic) per UI-UX.md.\n\nSteps:\n1. Create imperial.css with CSS variables\n2. Colors: Warm white #FAFAF8, Navy #1E3A5F, Gold #C9A227, Charcoal #2D2D2D\n3. Typography: Serif headings (Playfair Display), Sans body (Inter), Mono (JetBrains)\n4. Import fonts from Google Fonts or local\n5. Define shadow, border-radius, and spacing tokens\n\nFiles to create:\n- apps/web/src/lib/themes/imperial.css\n\nSuccess criteria: Imperial theme renders correctly when applied","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:44.164824-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:15:06.39414-05:00","closed_at":"2026-01-20T09:15:06.39414-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-cfs","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:20:27.657684-05:00","created_by":"Blake Blount"}]}
{"id":"facet-ci7","title":"Create StatusLane component","description":"Build lane column for ticket cards.\n\nSteps:\n1. Create StatusLane.svelte component\n2. Props: status, tickets, count\n3. Lane header with status name and count\n4. Scrollable card container\n5. Drop zone styling for drag-and-drop\n6. Theme styling\n\nFiles to create:\n- apps/web/src/lib/components/StatusLane.svelte\n\nSuccess criteria: Lane displays cards, styled per theme","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.302563-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:21:25.496781-05:00","closed_at":"2026-01-20T11:21:25.496781-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-ci7","depends_on_id":"facet-iyl","type":"blocks","created_at":"2026-01-19T22:21:12.111193-05:00","created_by":"Blake Blount"}]}
{"id":"facet-cr2c","title":"LOW-1: Add authentication to queue endpoint","description":"## Problem\nThe `GET /api/v1/queue` endpoint returns all active tickets without authentication. This is an information disclosure issue - unauthenticated users can see all ticket summaries in the workboard.\n\n## Location\n- `apps/api/src/handlers/tickets.rs:get_queue`\n- `apps/api/src/routes/mod.rs` - queue route definition\n\n## Files to Modify\n- `apps/api/src/handlers/tickets.rs` - Add authentication check to get_queue\n- Consider if queue should be accessible without full session (read-only mode)\n\n## Implementation Steps\n\n### Step 1: Determine Access Model\nChoose one of these approaches:\n\n**Option A: Require Employee Session (Recommended)**\nQueue is only visible to logged-in employees:\n```rust\npub async fn get_queue(\n    State(state): State\u003cAppState\u003e,\n    headers: HeaderMap,\n) -\u003e Result\u003cimpl IntoResponse, AppError\u003e {\n    // Require valid employee session\n    let _employee = extract_employee_from_session(\u0026state, \u0026headers).await?;\n    \n    // ... existing queue logic\n}\n```\n\n**Option B: Read-Only Token**\nCreate a lightweight read-only token for display boards:\n```rust\n// Check for either employee session OR read-only token\nlet auth = headers.get(\"X-Employee-Session\")\n    .or_else(|| headers.get(\"X-Queue-Token\"));\n\nif auth.is_none() {\n    return Err(AppError::unauthorized(\"Authentication required\"));\n}\n```\n\n**Option C: Accept as Public**\nIf the queue should be publicly visible (e.g., for customer display boards):\n- Document this as intentional\n- Consider limiting what data is exposed (no customer names, just counts)\n\n### Step 2: Implement Chosen Approach\nFor Option A (recommended):\n\n```rust\npub async fn get_queue(\n    State(state): State\u003cAppState\u003e,\n    headers: HeaderMap,\n) -\u003e Result\u003cimpl IntoResponse, AppError\u003e {\n    // Require authentication\n    extract_employee_from_session(\u0026state, \u0026headers).await?;\n    \n    // Get active tickets grouped by status for workboard\n    let queue = TicketRepository::get_queue(\u0026state.db).await?;\n    \n    Ok(Json(ApiResponse::success(queue)))\n}\n```\n\n### Step 3: Update Route (if needed)\nNo route changes needed if using existing session middleware.\n\n### Step 4: Handle Offline Mode\nConsider how offline PWA accesses queue data:\n- Cache queue data in IndexedDB when online\n- Offline mode uses cached data\n- Sync when connection restored\n\n### Step 5: Document Decision\nAdd to API documentation explaining the auth requirement.\n\n## Success Criteria\n- [ ] Queue endpoint requires authentication\n- [ ] Unauthenticated requests return 401\n- [ ] Authenticated employees can access queue\n- [ ] Error message is clear (not exposing internals)\n- [ ] PWA/offline mode still functions (uses cached data)\n- [ ] If read-only token approach chosen, tokens are properly secured\n\n## Testing Requirements\n\n### Integration Tests\nCreate `apps/api/tests/queue_auth.rs`:\n1. GET /queue without auth -\u003e 401\n2. GET /queue with valid employee session -\u003e 200\n3. GET /queue with expired session -\u003e 401\n4. GET /queue with invalid session -\u003e 401\n5. (If Option B) GET /queue with read-only token -\u003e 200\n\n### Frontend Testing\n1. Verify queue loads when logged in\n2. Verify redirect to login when not authenticated\n3. Verify offline mode works with cached data\n\n## Alternatives Considered\n- **Public queue**: Rejected due to customer name exposure\n- **IP whitelist**: Too complex for MVP\n- **API key per device**: Considered for future kiosk mode\n\n## Security Validation\n- Verify no queue data in error responses\n- Confirm authentication check happens before any data access\n- Test that timing doesn't reveal queue existence to unauthenticated users","status":"closed","priority":3,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:38:45.587485-05:00","created_by":"Blake Blount","updated_at":"2026-01-21T00:56:11.256893-05:00","closed_at":"2026-01-21T00:56:11.256893-05:00","close_reason":"Added authentication check to queue endpoint. Frontend now fetches queue client-side after employee PIN verification."}
{"id":"facet-cul","title":"Implement employees repository","description":"Create data access layer for employees table.\n\n## Steps\n1. Create Employee model struct (exclude pin_hash from default serialization)\n2. Implement create_employee()\n3. Implement find_by_id()\n4. Implement find_by_pin() for verification\n5. Implement list_employees() with include_inactive filter\n6. Implement update_employee()\n7. Implement delete_employee()\n\n## Files to create\n- apps/api/src/models/employee.rs\n- apps/api/src/repositories/employee.rs\n\n## Success criteria\nAll operations work, PIN lookup secure","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.290635-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:10:38.20941-05:00","closed_at":"2026-01-20T08:10:38.20941-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-cul","depends_on_id":"facet-md6","type":"blocks","created_at":"2026-01-19T22:20:18.741334-05:00","created_by":"Blake Blount"},{"issue_id":"facet-cul","depends_on_id":"facet-052","type":"blocks","created_at":"2026-01-19T22:20:19.771287-05:00","created_by":"Blake Blount"}]}
{"id":"facet-cvp","title":"Implement PUT /tickets/:id endpoint","description":"Create endpoint to update ticket fields.\n\nSteps:\n1. Add handler for ticket update\n2. Validate X-Employee-ID header\n3. Check ticket is not closed/archived (unless admin override)\n4. Update allowed fields\n5. Record field changes in ticket_field_history\n6. Update last_modified_by\n\nAPI: PUT /api/v1/tickets/:ticket_id\nHeaders: X-Employee-ID, optional X-Admin-PIN\n\nSuccess criteria: Updates ticket, blocks closed ticket edits without admin","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.683281-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:37:22.642135-05:00","closed_at":"2026-01-20T06:37:22.642135-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-cvp","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:18.67663-05:00","created_by":"Blake Blount"},{"issue_id":"facet-cvp","depends_on_id":"facet-k4b","type":"blocks","created_at":"2026-01-19T22:20:19.134711-05:00","created_by":"Blake Blount"}]}
{"id":"facet-cy6","title":"UI Test: Modal closes on ESC key","description":"## Test: Modal Keyboard Dismiss\n\n### Preconditions\n- Dev server running\n- Any modal is open (intake form, detail, PIN, etc.)\n\n### Steps\n1. Open the intake form modal\n2. Press the ESC key\n3. Open a ticket detail modal\n4. Press the ESC key\n5. Open the PIN modal (trigger any PIN action)\n6. Press the ESC key (when not loading)\n\n### Success Criteria\n- [ ] ESC key closes intake form modal\n- [ ] ESC key closes ticket detail modal\n- [ ] ESC key closes PIN modal (when not in loading state)\n- [ ] Closing via ESC returns focus appropriately\n- [ ] No data is lost if form has unsaved changes (or warn user)\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:56:00.193166-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:05:25.958019-05:00","closed_at":"2026-01-20T18:05:25.958019-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-d3x","title":"UI Test: Photo upload - single photo","description":"## Test: Single Photo Upload\n\n### Preconditions\n- Dev server running\n- Intake form modal is open\n- Have a test image file ready (JPG, PNG, or WebP)\n\n### Steps\n1. Open intake form modal\n2. Locate the photo upload area\n3. Click to select file OR drag and drop a single image\n4. Observe the upload behavior\n\n### Success Criteria\n- [ ] Photo upload area is clearly marked\n- [ ] Shows accepted file types (JPG, PNG, WebP)\n- [ ] Shows min/max requirements (1-10 photos)\n- [ ] File picker opens when clicking upload area\n- [ ] Selected photo shows preview/thumbnail\n- [ ] Photo count updates to show \"1 photo\"\n- [ ] Upload progress indicator shows (if uploading)\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:13.267225-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T14:14:53.309084-05:00","closed_at":"2026-01-20T14:14:53.309084-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-d7gu","title":"Rush flag styling doesn't update reactively","description":"## Problem\nWhen updating the rush flag on a ticket, the card styling does not change to reflect the updated state. The UI shows stale styling until some combination of:\n- Page refresh (inconsistent)\n- Theme toggle\n- Navigation to a different page and back\n\nThe exact trigger for the style update is unclear, but it's not happening reactively when the rush state changes.\n\n## Steps to Reproduce\n1. Open queue view with a non-rush ticket\n2. Toggle the rush flag on the ticket\n3. Observe that the card styling doesn't update to show rush styling\n4. Try refreshing - may or may not work\n5. Toggle theme or navigate away and back - styling finally updates\n\n## Root Cause Investigation\n- [ ] Check if rush state is updating in the Svelte store/state\n- [ ] Check if the component is receiving the updated prop\n- [ ] Look for missing reactive declarations ($: or $derived)\n- [ ] Check if CSS classes are bound reactively to the rush state\n- [ ] Investigate if there's a caching issue with the card component\n\n## Steps to Fix\n1. Trace the rush flag update from the toggle action through to the card component\n2. Identify where reactivity breaks down\n3. Ensure the card component's rush styling is bound to a reactive state\n4. If using Svelte 5, verify $derived/$state runes are used correctly\n5. Test that optimistic UI updates work without requiring refresh\n\n## Success Criteria\n- [ ] Toggling rush flag immediately updates card styling (border, badge, etc.)\n- [ ] No page refresh, theme toggle, or navigation required\n- [ ] Works consistently on queue view and ticket detail view\n- [ ] Optimistic update shows immediately, confirmed state persists after API response","status":"closed","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:34:30.072516-05:00","created_by":"Blake Blount","updated_at":"2026-01-21T00:43:23.149292-05:00","closed_at":"2026-01-21T00:43:23.149292-05:00","close_reason":"Closed"}
{"id":"facet-dhf","title":"Add customer name to print tag/label","description":"## Problem\nPrinted jewelry tags only show ticket code and item description, not customer name. Customer name could aid quick identification.\n\n## Context from UI Testing\n- Test facet-c84: \"LOW - Customer name not displayed on tag\"\n- Tag shows: ticket code, item type, RUSH indicator\n- Missing: customer name\n- Ticket code is primary identifier so this is minor\n\n## Steps to Fix\n1. Open label generation code in apps/api/src/services/pdf.rs\n2. Add customer name field to label layout\n3. Consider space constraints on small tag format\n4. May need to truncate long names\n\n## Success Criteria\n- [ ] Customer name appears on printed tag\n- [ ] Name is readable but doesn't overflow\n- [ ] Existing tag elements still visible","status":"closed","priority":4,"issue_type":"feature","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:41:02.001023-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T21:49:25.106696-05:00","closed_at":"2026-01-20T21:49:25.106696-05:00","close_reason":"Closed"}
{"id":"facet-djk","title":"UI Test: Drag-drop error handling - network failure","description":"## Test: Network Error on Drag-Drop\n\n### Preconditions\n- Dev server running\n- Ticket exists\n- Ability to simulate network error (DevTools)\n\n### Steps\n1. Navigate to workboard\n2. Open DevTools Network tab\n3. Drag a ticket to a different lane\n4. Before entering PIN, set network to \"Offline\" in DevTools\n5. Enter valid PIN and verify\n6. Observe the result\n\n### Success Criteria\n- [ ] Network error is caught gracefully\n- [ ] Error toast/message appears (e.g., \"Failed to update status\")\n- [ ] Ticket REVERTS to original lane\n- [ ] Lane counts revert to original values\n- [ ] User can try again when network is restored\n- [ ] App does not crash or hang\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:55:33.337356-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:44:51.544446-05:00","closed_at":"2026-01-20T16:44:51.544446-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-dpt","title":"UI Test: Storage location dropdown loads options","description":"## Test: Storage Location Dropdown\n\n### Preconditions\n- Dev server running\n- Database has storage locations configured\n- Intake form modal is open\n\n### Steps\n1. Open intake form modal\n2. Locate the Storage Location dropdown\n3. Click to open the dropdown\n4. Observe the available options\n\n### Success Criteria\n- [ ] Dropdown field is present and clickable\n- [ ] Clicking opens dropdown with options\n- [ ] Options are loaded from database (not empty)\n- [ ] Each option shows location name\n- [ ] Inactive locations are either hidden or marked\n- [ ] Selecting an option populates the field\n- [ ] Dropdown closes after selection\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:13.13956-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:41:22.796749-05:00","closed_at":"2026-01-20T18:41:22.796749-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-dqo","title":"UI Test: Theme toggle - Imperial","description":"## Test: Imperial Theme Selection\n\n### Preconditions\n- Dev server running\n- On admin page\n\n### Steps\n1. Navigate to /admin\n2. Locate the Appearance/Theme section\n3. Find the \"Imperial\" theme button\n4. Click Imperial button\n5. Observe the UI changes\n\n### Success Criteria\n- [ ] Imperial theme button is clickable\n- [ ] Clicking applies Imperial theme immediately\n- [ ] Button shows active/selected state (blue border, background tint)\n- [ ] Theme persists after page refresh (check localStorage)\n- [ ] Theme applies to all pages (navigate away and back)\n- [ ] Color scheme matches Imperial theme definition\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:58.314291-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:37:46.249063-05:00","closed_at":"2026-01-20T18:37:46.249063-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-dwy","title":"Implement storage locations repository","description":"Create data access layer for storage_locations table.\n\n## Steps\n1. Create StorageLocation model struct\n2. Implement create_location()\n3. Implement find_by_id()\n4. Implement list_locations() with include_inactive filter\n5. Implement update_location()\n\n## Files to create\n- apps/api/src/models/storage_location.rs\n- apps/api/src/repositories/storage_location.rs\n\n## Success criteria\nAll operations work","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.511952-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:27:26.967177-05:00","closed_at":"2026-01-20T08:27:26.967177-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-dwy","depends_on_id":"facet-md6","type":"blocks","created_at":"2026-01-19T22:20:18.906755-05:00","created_by":"Blake Blount"}]}
{"id":"facet-dz3","title":"Implement Arcane theme CSS","description":"Create Arcane theme (fantasy/steampunk pixel art aesthetic) per UI-UX.md.\n\nSteps:\n1. Create arcane.css with CSS variables\n2. Colors: Aged parchment #2D2A24, Dark leather #3D3830, Polished brass #B8860B, Arcane teal #4A9B9B, Parchment white #E8DCC4\n3. Typography: Pixel fonts (Press Start 2P or VT323 for headings, Silkscreen/Pixelify Sans for body)\n4. Import pixel fonts from Google Fonts\n5. Define tokens: pixel-perfect borders (1-2px solid), sharp corners (0-2px), inner shadows for depth\n\nFiles to create:\n- apps/web/src/lib/themes/arcane.css\n\nSuccess criteria: Arcane theme renders correctly with fantasy/steampunk pixel art aesthetic when applied","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:44.279464-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:30:39.347044-05:00","closed_at":"2026-01-20T09:30:39.347044-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-dz3","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:20:27.696002-05:00","created_by":"Blake Blount"}]}
{"id":"facet-e2k","title":"Implement POST /tickets/:id/close endpoint","description":"Create endpoint to close tickets.\n\nSteps:\n1. Add handler for ticket close\n2. Validate X-Employee-ID header\n3. Require actual_amount in request body\n4. Set status to closed\n5. Set closed_at and closed_by\n6. Create status_history entry\n\nAPI: POST /api/v1/tickets/:ticket_id/close\nBody: { \"actual_amount\": 145.00 }\n\nSuccess criteria: Closes ticket with required amount","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.177846-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T07:01:09.738118-05:00","closed_at":"2026-01-20T07:01:09.738118-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-e2k","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:18.819723-05:00","created_by":"Blake Blount"},{"issue_id":"facet-e2k","depends_on_id":"facet-k4b","type":"blocks","created_at":"2026-01-19T22:20:19.26986-05:00","created_by":"Blake Blount"}]}
{"id":"facet-e4u","title":"UI Test: Lane count badges update correctly","description":"## Test: Lane Count Badge Accuracy\n\n### Preconditions\n- Dev server running\n- Database has known number of tickets per status\n\n### Steps\n1. Navigate to workboard (/)\n2. Count tickets visually in each lane\n3. Compare to the count badge in each lane header\n4. Note the counts for later comparison after status changes\n\n### Success Criteria\n- [ ] Intake lane count matches visible ticket count\n- [ ] In Progress lane count matches visible ticket count\n- [ ] Waiting on Parts lane count matches visible ticket count\n- [ ] Ready for Pickup lane count matches visible ticket count\n- [ ] Count badges are styled consistently (same color, size)\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:52:39.36811-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T15:07:45.571203-05:00","closed_at":"2026-01-20T15:07:45.571203-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-e6q","title":"Create DatePicker component","description":"Build date picker for promise dates.\n\nSteps:\n1. Create DatePicker.svelte component\n2. Props: label, value, minDate, maxDate\n3. Calendar popup or use browser native date input styled\n4. Theme styling\n5. Return ISO date string\n\nFiles to create:\n- apps/web/src/lib/components/DatePicker.svelte\n\nSuccess criteria: DatePicker selects date, returns value","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:46.390903-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:07:49.029483-05:00","closed_at":"2026-01-20T11:07:49.029483-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-e6q","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:21:12.335595-05:00","created_by":"Blake Blount"}]}
{"id":"facet-eji","title":"Implement ticket photos repository","description":"Create data access layer for ticket_photos table.\n\n## Steps\n1. Create TicketPhoto model struct\n2. Implement create_photo()\n3. Implement find_by_ticket_id()\n4. Implement delete_photo()\n5. Implement count_by_ticket_id() for limit check\n\n## Files to create\n- apps/api/src/models/ticket_photo.rs\n- apps/api/src/repositories/ticket_photo.rs\n\n## Success criteria\nPhoto records can be created and retrieved","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.111145-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:14:00.969196-05:00","closed_at":"2026-01-20T08:14:00.969196-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-eji","depends_on_id":"facet-md6","type":"blocks","created_at":"2026-01-19T22:20:19.223405-05:00","created_by":"Blake Blount"},{"issue_id":"facet-eji","depends_on_id":"facet-zsx","type":"blocks","created_at":"2026-01-19T22:20:20.008825-05:00","created_by":"Blake Blount"}]}
{"id":"facet-ekd","title":"Create PhotoUpload/dropzone component","description":"Build file upload with drag-and-drop.\n\nSteps:\n1. Create PhotoUpload.svelte component\n2. Drag-and-drop zone with visual feedback\n3. Click to browse\n4. Multiple file support\n5. Preview thumbnails\n6. Remove uploaded photos\n7. Validate file type and size\n8. Emit files to parent\n\nFiles to create:\n- apps/web/src/lib/components/PhotoUpload.svelte\n\nSuccess criteria: Can drop/select photos, see previews","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:46.499452-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:11:00.099672-05:00","closed_at":"2026-01-20T10:11:00.099672-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-ekd","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:21:12.455354-05:00","created_by":"Blake Blount"}]}
{"id":"facet-eyr","title":"Create Modal component system","description":"Build reusable modal overlay component.\n\nSteps:\n1. Create Modal.svelte with slot for content\n2. Props: open, title, onClose\n3. Backdrop with click-to-close\n4. ESC key to close\n5. Focus trap for accessibility\n6. Animate in/out\n7. Create modal store for global modal management\n\nFiles to create:\n- apps/web/src/lib/components/Modal.svelte\n- apps/web/src/lib/stores/modal.ts\n\nSuccess criteria: Modal opens/closes, accessible, animated","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:44.616192-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:23:31.092752-05:00","closed_at":"2026-01-20T09:23:31.092752-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-eyr","depends_on_id":"facet-01b","type":"blocks","created_at":"2026-01-19T22:20:27.883474-05:00","created_by":"Blake Blount"},{"issue_id":"facet-eyr","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:20:27.920142-05:00","created_by":"Blake Blount"}]}
{"id":"facet-f0o","title":"Implement POST /admin/verify endpoint","description":"Verify admin PIN for UI unlock.\n\nSteps:\n1. Add handler for admin verification\n2. Accept PIN in body\n3. Verify against store_settings.admin_pin_hash\n4. Return success or INVALID_PIN error\n\nAPI: POST /api/v1/admin/verify\n\nSuccess criteria: Returns success for valid admin PIN","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.497889-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:59:45.022679-05:00","closed_at":"2026-01-20T09:59:45.022679-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-f0o","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:19.217717-05:00","created_by":"Blake Blount"},{"issue_id":"facet-f0o","depends_on_id":"facet-4m6","type":"blocks","created_at":"2026-01-19T22:20:19.357988-05:00","created_by":"Blake Blount"}]}
{"id":"facet-fie","title":"List accepted file types in photo upload area","description":"## Problem\nPhoto upload area shows \"Up to 10 images, max 10.0 MB each\" but doesn't list specific accepted file types (JPG, PNG, WebP).\n\n## Context from UI Testing\n- Test facet-d3x: \"LOW - Accepted file types not explicitly listed in UI\"\n- Component accepts image/* but doesn't specify which formats\n- Users may not know which file types are allowed\n\n## Steps to Fix\n1. Open apps/web/src/lib/components/PhotoUpload.svelte\n2. Update help text to include: \"JPG, PNG, WebP\"\n3. Example: \"Up to 10 images (JPG, PNG, WebP), max 10.0 MB each\"\n\n## Success Criteria\n- [ ] Accepted file types listed in upload area\n- [ ] Text is clear and readable","status":"closed","priority":3,"issue_type":"feature","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:41:03.484954-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T22:09:36.718152-05:00","closed_at":"2026-01-20T22:09:36.718152-05:00","close_reason":"Closed"}
{"id":"facet-fo1","title":"UI Test: SETUP - Start dev servers (run first)","description":"## SETUP TASK - Run This First\n\nThis task starts the development servers and leaves them running for all subsequent UI tests.\n\n### Steps\n1. Start the API server in background:\n   ```bash\n   cd /Users/leahblount/projects/facet/apps/api \u0026\u0026 npm run dev \u0026\n   ```\n\n2. Start the web server in background:\n   ```bash\n   cd /Users/leahblount/projects/facet/apps/web \u0026\u0026 npm run dev \u0026\n   ```\n\n3. Wait for servers to be ready:\n   - API typically runs on port 3000\n   - Web typically runs on port 5173\n   - Verify by navigating to http://localhost:5173 in Playwright\n\n4. Confirm database has seed data (if not, run migrations)\n\n### Success Criteria\n- [ ] API server is running and responding\n- [ ] Web server is running and accessible\n- [ ] Can load the workboard page in browser\n- [ ] Servers are running in background (not blocking)\n\n### CRITICAL INSTRUCTIONS\n- **DO NOT CLOSE THE SERVERS** when this task is complete\n- Leave them running for all subsequent UI tests\n- Close this issue once servers are confirmed running\n- Other agents will reuse these running servers\n\n### Recording Results\nAppend to UI-TESTS.md:\n```\n---\n## TEST: SETUP - Servers Started\n**Date:** YYYY-MM-DD\n**Status:** PASS\n**API URL:** http://localhost:3000\n**Web URL:** http://localhost:5173\n**Notes:** Servers running in background for subsequent tests\n```","status":"closed","priority":0,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T14:02:55.925418-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T14:10:48.787213-05:00","closed_at":"2026-01-20T14:10:48.787213-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-fu9","title":"Move New button out of intake column to page header area","description":"## Problem Description\n\nThe \"New\" button for creating intakes is currently positioned inside the Intake column of the Kanban board. This looks out of place and cluttered.\n\n## Solution\n\nMove the \"New\" button to the **top-right area above the Kanban board**. This is a common UI pattern for primary actions and keeps the Kanban columns clean for displaying only intake cards.\n\n## Root Cause Investigation Steps\n\n1. Locate the Kanban board component and find where the New button is rendered\n2. Identify the page layout structure (header area, main content area)\n3. Check if there's an existing header/toolbar area above the Kanban board\n4. If no header exists, create a toolbar/header row above the Kanban board\n\n## Implementation Approach\n\n- Remove the New button from inside the Intake column\n- Add a header/toolbar area above the Kanban board (if not already present)\n- Place the New button in the top-right of this header area\n- Style it as a primary action button (prominent, easily visible)\n\n## Success Criteria\n\n- [ ] New button is positioned in the top-right area above the Kanban board\n- [ ] New button is no longer inside the Intake column\n- [ ] Button remains easily discoverable and accessible\n- [ ] Kanban columns contain only intake cards\n- [ ] Button styling is consistent with other primary actions in the app\n","status":"closed","priority":0,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T19:51:58.816772-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T20:25:42.881489-05:00","closed_at":"2026-01-20T20:25:42.881489-05:00","close_reason":"Closed"}
{"id":"facet-g7i","title":"Implement GET /queue endpoint","description":"Create endpoint for workboard data.\n\nSteps:\n1. Add handler for queue retrieval\n2. Fetch tickets grouped by status lane\n3. Exclude closed/archived\n4. Sort each lane: rush first, then FIFO\n5. Include is_overdue flag based on promise_date\n6. Return lanes structure per API.md\n\nAPI: GET /api/v1/queue\n\nSuccess criteria: Returns lanes with sorted tickets","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.30639-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:53:12.104307-05:00","closed_at":"2026-01-20T06:53:12.104307-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-g7i","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:18.867937-05:00","created_by":"Blake Blount"},{"issue_id":"facet-g7i","depends_on_id":"facet-844","type":"blocks","created_at":"2026-01-19T22:20:19.399493-05:00","created_by":"Blake Blount"}]}
{"id":"facet-gcb","title":"UI Test: Drag-drop optimistic UI update","description":"## Test: Optimistic UI on Drag-Drop\n\n### Preconditions\n- Dev server running\n- Ticket exists\n- Know a valid employee PIN\n\n### Steps\n1. Navigate to workboard\n2. Note the position of a ticket\n3. Drag ticket to a different lane\n4. Enter PIN and verify\n5. Observe timing of visual update\n\n### Success Criteria\n- [ ] After PIN verification, ticket moves IMMEDIATELY (before server response)\n- [ ] No loading spinner blocks the UI\n- [ ] Lane counts update immediately\n- [ ] UI feels responsive and snappy\n- [ ] Ticket stays in new position after server confirms\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:55:32.8525-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:33:22.447681-05:00","closed_at":"2026-01-20T16:33:22.447681-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-gf6","title":"Implement POST /tickets/:id/rush endpoint","description":"Create endpoint to toggle rush flag.\n\nSteps:\n1. Add handler for rush toggle\n2. Validate X-Employee-ID header\n3. Update is_rush field\n4. Record change in field_history\n5. Update last_modified_by\n\nAPI: POST /api/v1/tickets/:ticket_id/rush\nBody: { \"is_rush\": true }\n\nSuccess criteria: Toggles rush flag, records attribution","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:25.048559-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:34:26.918346-05:00","closed_at":"2026-01-20T08:34:26.918346-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-gf6","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:18.777205-05:00","created_by":"Blake Blount"},{"issue_id":"facet-gf6","depends_on_id":"facet-k4b","type":"blocks","created_at":"2026-01-19T22:20:19.228828-05:00","created_by":"Blake Blount"}]}
{"id":"facet-h67","title":"Set up Axum app structure and routing","description":"Organize Axum app with modular routing and middleware.\n\n## Steps\n1. Create module structure: src/routes/, src/handlers/, src/models/, src/services/, src/config/\n2. Set up Router with nested route modules\n3. Add CORS middleware (tower-http)\n4. Add request logging middleware (tower-http::trace)\n5. Create config module for environment variables\n6. Set up graceful shutdown\n\n## Files to modify/create\n- apps/api/src/main.rs\n- apps/api/src/lib.rs\n- apps/api/src/config.rs\n- apps/api/src/routes/mod.rs\n\n## Success criteria\nApp starts with organized module structure, CORS and logging work","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.002332-05:00","created_by":"Blake Blount","updated_at":"2026-01-19T22:40:34.839006-05:00","closed_at":"2026-01-19T22:40:34.839006-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-h67","depends_on_id":"facet-7ag","type":"blocks","created_at":"2026-01-19T22:20:18.523015-05:00","created_by":"Blake Blount"}]}
{"id":"facet-i61","title":"UI Test: Form validation error display","description":"## Test: Field-Level Validation Errors\n\n### Preconditions\n- Dev server running\n- Intake form open\n\n### Steps\n1. Open intake form modal\n2. Try to submit with all fields empty\n3. Observe error messages\n4. Fill one field at a time\n5. Note how errors clear\n\n### Success Criteria\n- [ ] Each required field shows specific error message\n- [ ] Errors appear near/under the relevant field\n- [ ] Error styling is clear (red text, red border)\n- [ ] Errors clear when field is properly filled\n- [ ] Submit is blocked until all required fields valid\n- [ ] Validation runs on blur and on submit\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:55:33.49653-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:51:23.759073-05:00","closed_at":"2026-01-20T16:51:23.759073-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-iel7","title":"MED-4: Standardize entity existence checks before operations","description":"## Problem\nSome handlers check entity existence before operations while others rely on foreign key constraints. This leads to inconsistent error responses (clear 404s vs cryptic database constraint errors).\n\n## Examples of Current Behavior\n- `update_ticket`: Checks ticket exists -\u003e clear 404\n- `toggle_rush`: Checks ticket exists -\u003e clear 404\n- `add_note`: Checks ticket exists -\u003e clear 404\n- `upload_photo`: Checks ticket exists -\u003e clear 404\n- `storage_location_id` in update: Foreign key only -\u003e database error\n\n## Files to Modify\n- `apps/api/src/handlers/tickets.rs` - Add existence checks\n- `apps/api/src/handlers/employees.rs` - Validate references\n- `apps/api/src/repositories/*.rs` - Add existence check methods\n- `apps/api/src/error.rs` - Improve FK constraint error handling\n\n## Implementation Steps\n\n### Step 1: Create Existence Check Helpers\nIn each repository, add existence check methods:\n\n```rust\n// In StorageLocationRepository\npub async fn exists(pool: \u0026PgPool, location_id: Uuid) -\u003e Result\u003cbool, AppError\u003e {\n    let result = sqlx::query_scalar::\u003c_, bool\u003e(\n        \"SELECT EXISTS(SELECT 1 FROM storage_locations WHERE location_id = $1 AND is_active = true)\"\n    )\n    .bind(location_id)\n    .fetch_one(pool)\n    .await?;\n    \n    Ok(result)\n}\n\n// In EmployeeRepository\npub async fn exists_and_active(pool: \u0026PgPool, employee_id: Uuid) -\u003e Result\u003cbool, AppError\u003e {\n    let result = sqlx::query_scalar::\u003c_, bool\u003e(\n        \"SELECT EXISTS(SELECT 1 FROM employees WHERE employee_id = $1 AND is_active = true)\"\n    )\n    .bind(employee_id)\n    .fetch_one(pool)\n    .await?;\n    \n    Ok(result)\n}\n\n// In CustomerRepository\npub async fn exists(pool: \u0026PgPool, customer_id: Uuid) -\u003e Result\u003cbool, AppError\u003e {\n    let result = sqlx::query_scalar::\u003c_, bool\u003e(\n        \"SELECT EXISTS(SELECT 1 FROM customers WHERE customer_id = $1)\"\n    )\n    .bind(customer_id)\n    .fetch_one(pool)\n    .await?;\n    \n    Ok(result)\n}\n```\n\n### Step 2: Create Validation Helper\nCreate `apps/api/src/validation/references.rs`:\n\n```rust\nuse crate::error::AppError;\nuse crate::repositories::*;\nuse sqlx::PgPool;\nuse uuid::Uuid;\n\npub async fn validate_storage_location(pool: \u0026PgPool, location_id: Uuid) -\u003e Result\u003c(), AppError\u003e {\n    if !StorageLocationRepository::exists(pool, location_id).await? {\n        return Err(AppError::not_found(\"Storage location not found or inactive\"));\n    }\n    Ok(())\n}\n\npub async fn validate_employee(pool: \u0026PgPool, employee_id: Uuid) -\u003e Result\u003c(), AppError\u003e {\n    if !EmployeeRepository::exists_and_active(pool, employee_id).await? {\n        return Err(AppError::not_found(\"Employee not found or inactive\"));\n    }\n    Ok(())\n}\n\npub async fn validate_customer(pool: \u0026PgPool, customer_id: Uuid) -\u003e Result\u003c(), AppError\u003e {\n    if !CustomerRepository::exists(pool, customer_id).await? {\n        return Err(AppError::not_found(\"Customer not found\"));\n    }\n    Ok(())\n}\n```\n\n### Step 3: Apply to Ticket Creation\nIn `create_ticket`:\n\n```rust\n// Validate storage location exists\nvalidate_storage_location(\u0026state.db, body.storage_location_id).await?;\n\n// If customer_id provided, validate it exists\nif let Some(customer_id) = body.customer_id {\n    validate_customer(\u0026state.db, customer_id).await?;\n}\n\n// Then proceed with creation...\n```\n\n### Step 4: Apply to Ticket Update\nIn `update_ticket`:\n\n```rust\n// If storage_location_id is being changed, validate new one\nif let Some(location_id) = \u0026body.storage_location_id {\n    validate_storage_location(\u0026state.db, *location_id).await?;\n}\n\n// If worked_by is being changed, validate employee\nif let Some(Some(employee_id)) = \u0026body.worked_by_employee_id {\n    validate_employee(\u0026state.db, *employee_id).await?;\n}\n```\n\n### Step 5: Improve Database Error Handling\nIn `error.rs`, catch FK constraint errors and convert to 404:\n\n```rust\nimpl From\u003csqlx::Error\u003e for AppError {\n    fn from(err: sqlx::Error) -\u003e Self {\n        match \u0026err {\n            sqlx::Error::Database(db_err) =\u003e {\n                // PostgreSQL foreign key violation code\n                if db_err.code() == Some(Cow::Borrowed(\"23503\")) {\n                    // Parse constraint name to provide better error\n                    if let Some(constraint) = db_err.constraint() {\n                        return match constraint {\n                            \"tickets_storage_location_id_fkey\" =\u003e \n                                AppError::not_found(\"Storage location not found\"),\n                            \"tickets_customer_id_fkey\" =\u003e \n                                AppError::not_found(\"Customer not found\"),\n                            \"tickets_taken_in_by_fkey\" | \n                            \"tickets_worked_by_fkey\" | \n                            \"tickets_closed_by_fkey\" =\u003e \n                                AppError::not_found(\"Employee not found\"),\n                            _ =\u003e AppError::validation(\"Referenced entity not found\"),\n                        };\n                    }\n                }\n                AppError::database_error(err)\n            }\n            _ =\u003e AppError::database_error(err),\n        }\n    }\n}\n```\n\n### Step 6: Document Expected Behavior\nAdd comments to handlers:\n\n```rust\n/// Creates a new ticket.\n/// \n/// # Errors\n/// - 404 NOT_FOUND: storage_location_id does not exist\n/// - 404 NOT_FOUND: customer_id does not exist (if provided)\n/// - 400 VALIDATION: customer data invalid (if inline creation)\npub async fn create_ticket(...) {\n```\n\n## Success Criteria\n- [ ] All referenced entity IDs are validated before use\n- [ ] Clear 404 errors for missing references (not DB constraint errors)\n- [ ] Error messages specify which entity was not found\n- [ ] Inactive entities (storage locations, employees) are treated as not found\n- [ ] Validation happens before any database modification\n- [ ] FK constraint errors are caught and converted to clear errors\n- [ ] Existing functionality unchanged for valid requests\n\n## Testing Requirements\n\n### Unit Tests\n- `exists` returns true for existing entity\n- `exists` returns false for non-existing entity\n- `exists_and_active` returns false for inactive entity\n\n### Integration Tests\nCreate `apps/api/tests/reference_validation.rs`:\n1. Create ticket with non-existent storage_location_id -\u003e 404\n2. Create ticket with non-existent customer_id -\u003e 404\n3. Update ticket with non-existent storage_location_id -\u003e 404\n4. Update ticket with inactive employee worked_by -\u003e 404\n5. Create ticket with valid references -\u003e 201\n6. Update ticket with valid references -\u003e 200\n7. Create ticket with inactive storage location -\u003e 404\n\n### Error Message Verification\n- Verify error message clearly states which entity was not found\n- Confirm no database error details leak to client\n\n## Security Validation\n- Verify timing is consistent (no timing oracle for existence)\n- Test that invalid UUIDs return validation error, not 404\n- Confirm authorization check happens before existence check (don't leak what exists)","status":"closed","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:37:02.10758-05:00","created_by":"Blake Blount","updated_at":"2026-01-21T00:36:37.418092-05:00","closed_at":"2026-01-21T00:36:37.418092-05:00","close_reason":"Closed"}
{"id":"facet-iyl","title":"Create Card component","description":"Build card container component.\n\nSteps:\n1. Create Card.svelte component\n2. Props: padding, shadow, clickable\n3. Slot for content\n4. Hover state if clickable\n5. Theme styling (surface color, shadows)\n\nFiles to create:\n- apps/web/src/lib/components/Card.svelte\n\nSuccess criteria: Card renders with configurable styles","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:46.179214-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:10:40.740356-05:00","closed_at":"2026-01-20T11:10:40.740356-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-iyl","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:21:12.106402-05:00","created_by":"Blake Blount"}]}
{"id":"facet-j2os","title":"MED-3: Add input sanitization and length validation for text fields","description":"## Problem\nText fields are stored as-is without sanitization. This creates risks for stored XSS (if rendered without escaping) and log injection if fields are logged directly.\n\n## Affected Fields\n- `item_description`, `condition_notes`, `requested_work` (tickets)\n- `customer.name`, `customer.phone`, `customer.email` (customers)\n- `employee.name` (employees)\n- Note `content` (ticket notes)\n- `storage_location.name` (locations)\n- `store_settings` fields\n\n## Files to Modify\n- Create `apps/api/src/validation/mod.rs` - Centralized validation\n- `apps/api/src/handlers/tickets.rs` - Apply validation\n- `apps/api/src/handlers/customers.rs` - Apply validation  \n- `apps/api/src/handlers/employees.rs` - Apply validation\n- `apps/api/src/models/*.rs` - Add length constants\n- `apps/api/src/error.rs` - Add validation error variants\n\n## Implementation Steps\n\n### Step 1: Define Field Constraints\nCreate `validation/constraints.rs`:\n\n```rust\n// Maximum lengths for text fields\npub const MAX_NAME_LENGTH: usize = 255;\npub const MAX_PHONE_LENGTH: usize = 50;\npub const MAX_EMAIL_LENGTH: usize = 255;\npub const MAX_ITEM_TYPE_LENGTH: usize = 100;\npub const MAX_DESCRIPTION_LENGTH: usize = 2000;\npub const MAX_NOTE_LENGTH: usize = 5000;\npub const MAX_ADDRESS_LENGTH: usize = 500;\n\n// For validation error messages\npub fn field_too_long(field: \u0026str, max: usize) -\u003e String {\n    format!(\"{} exceeds maximum length of {} characters\", field, max)\n}\n```\n\n### Step 2: Create Sanitization Functions\nCreate `validation/sanitize.rs`:\n\n```rust\n/// Trim whitespace and normalize newlines\npub fn sanitize_text(input: \u0026str) -\u003e String {\n    input\n        .trim()\n        .replace(\"\\r\\n\", \"\\n\")  // Normalize line endings\n        .replace(\"\\r\", \"\\n\")\n}\n\n/// Sanitize and validate length\npub fn validate_text(input: \u0026str, field_name: \u0026str, max_length: usize) -\u003e Result\u003cString, AppError\u003e {\n    let sanitized = sanitize_text(input);\n    \n    if sanitized.len() \u003e max_length {\n        return Err(AppError::validation(field_too_long(field_name, max_length)));\n    }\n    \n    Ok(sanitized)\n}\n\n/// Validate required field\npub fn validate_required(input: \u0026str, field_name: \u0026str, max_length: usize) -\u003e Result\u003cString, AppError\u003e {\n    let sanitized = validate_text(input, field_name, max_length)?;\n    \n    if sanitized.is_empty() {\n        return Err(AppError::validation(format!(\"{} is required\", field_name)));\n    }\n    \n    Ok(sanitized)\n}\n\n/// Sanitize for safe logging (escape control characters)\npub fn sanitize_for_log(input: \u0026str) -\u003e String {\n    input\n        .chars()\n        .map(|c| {\n            if c.is_control() \u0026\u0026 c != '\\n' \u0026\u0026 c != '\\t' {\n                '?'  // Replace control chars\n            } else {\n                c\n            }\n        })\n        .collect()\n}\n```\n\n### Step 3: Validate Phone Numbers\n```rust\npub fn validate_phone(input: \u0026str) -\u003e Result\u003cString, AppError\u003e {\n    let sanitized = sanitize_text(input);\n    \n    if sanitized.len() \u003e MAX_PHONE_LENGTH {\n        return Err(AppError::validation(field_too_long(\"phone\", MAX_PHONE_LENGTH)));\n    }\n    \n    // Allow only digits, spaces, dashes, parentheses, plus sign\n    if !sanitized.chars().all(|c| c.is_ascii_digit() || \" -+()\".contains(c)) {\n        return Err(AppError::validation(\"Phone contains invalid characters\"));\n    }\n    \n    Ok(sanitized)\n}\n```\n\n### Step 4: Validate Email Format\n```rust\npub fn validate_email(input: \u0026str) -\u003e Result\u003cString, AppError\u003e {\n    let sanitized = sanitize_text(input).to_lowercase();\n    \n    if sanitized.len() \u003e MAX_EMAIL_LENGTH {\n        return Err(AppError::validation(field_too_long(\"email\", MAX_EMAIL_LENGTH)));\n    }\n    \n    // Basic email format check\n    if !sanitized.is_empty() \u0026\u0026 !sanitized.contains('@') {\n        return Err(AppError::validation(\"Invalid email format\"));\n    }\n    \n    Ok(sanitized)\n}\n```\n\n### Step 5: Apply to Ticket Creation\nIn `create_ticket` handler:\n\n```rust\n// Validate and sanitize all text fields\nlet item_description = validate_required(\n    \u0026body.item_description, \n    \"item_description\", \n    MAX_DESCRIPTION_LENGTH\n)?;\n\nlet condition_notes = validate_required(\n    \u0026body.condition_notes,\n    \"condition_notes\",\n    MAX_DESCRIPTION_LENGTH\n)?;\n\nlet requested_work = validate_required(\n    \u0026body.requested_work,\n    \"requested_work\", \n    MAX_DESCRIPTION_LENGTH\n)?;\n\nlet item_type = body.item_type\n    .as_ref()\n    .map(|t| validate_text(t, \"item_type\", MAX_ITEM_TYPE_LENGTH))\n    .transpose()?;\n```\n\n### Step 6: Apply to All Handlers\nApply similar validation to:\n- `update_ticket` - all updatable text fields\n- `add_note` - note content\n- `create_employee` - name\n- `update_employee` - name\n- `create_location` - name\n- `update_location` - name\n- `update_settings` - all text fields\n- Customer creation (inline in ticket creation)\n\n### Step 7: Update Logging\nWhen logging user input:\n```rust\ntracing::info!(\n    \"Ticket created: {}\", \n    sanitize_for_log(\u0026ticket.item_description)\n);\n```\n\n## Success Criteria\n- [ ] All text fields are trimmed of leading/trailing whitespace\n- [ ] All text fields have maximum length validation\n- [ ] Required fields reject empty strings\n- [ ] Phone numbers only contain valid characters\n- [ ] Email addresses have basic format validation\n- [ ] Control characters are stripped/escaped\n- [ ] Validation errors return clear messages with field names\n- [ ] User input in logs is sanitized\n\n## Testing Requirements\n\n### Unit Tests for Validation Functions\n- `sanitize_text` trims whitespace\n- `sanitize_text` normalizes newlines\n- `validate_text` rejects over-length\n- `validate_required` rejects empty after trim\n- `validate_phone` rejects invalid characters\n- `validate_email` rejects missing @\n- `sanitize_for_log` escapes control characters\n\n### Integration Tests\nCreate `apps/api/tests/input_validation.rs`:\n1. Create ticket with 3000-char description -\u003e 400 (too long)\n2. Create ticket with description of only spaces -\u003e 400 (required)\n3. Create ticket with valid description -\u003e 201\n4. Create customer with phone \"abc\" -\u003e 400 (invalid)\n5. Create customer with phone \"555-1234\" -\u003e 201\n6. Create note with empty content -\u003e 400\n7. Update settings with 1000-char store name -\u003e 400\n\n### Edge Cases\n- Unicode text (should be allowed)\n- Very long unicode characters (length in bytes vs chars)\n- Null bytes embedded in strings\n- HTML/script tags (should be stored, escaped on display)\n\n## Security Validation\n- Verify XSS payloads are stored but not executed (frontend responsibility)\n- Confirm log injection is prevented\n- Test with fuzzing tools for edge cases\n- Verify validation cannot be bypassed via encoding tricks","status":"closed","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:37:01.861078-05:00","created_by":"Blake Blount","updated_at":"2026-01-21T00:30:22.683543-05:00","closed_at":"2026-01-21T00:30:22.683543-05:00","close_reason":"Closed"}
{"id":"facet-j6h","title":"Create TicketDetailModal structure","description":"Build modal layout for full ticket details.\n\nSteps:\n1. Create TicketDetailModal.svelte component\n2. Props: ticketId, open, onClose\n3. Fetch ticket detail from GET /tickets/:id\n4. Large modal with scrollable content\n5. Ticket code in header\n6. Close button\n7. Section layout for customer, item, photos, pricing, status, notes, actions\n\nFiles to create:\n- apps/web/src/lib/components/TicketDetailModal.svelte\n\nSuccess criteria: Modal opens, fetches and displays ticket data","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:40.908262-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:26:46.422607-05:00","closed_at":"2026-01-20T09:26:46.422607-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-j6h","depends_on_id":"facet-eyr","type":"blocks","created_at":"2026-01-19T22:21:10.717974-05:00","created_by":"Blake Blount"},{"issue_id":"facet-j6h","depends_on_id":"facet-ubq","type":"blocks","created_at":"2026-01-19T22:21:10.84679-05:00","created_by":"Blake Blount"}]}
{"id":"facet-k4b","title":"Implement tickets repository - basic CRUD","description":"Create data access layer for tickets table (basic operations).\n\n## Steps\n1. Create Ticket model struct with all fields\n2. Create TicketSummary struct for list views\n3. Implement create_ticket() with friendly_code generation\n4. Implement find_by_id() with full details\n5. Implement update_ticket()\n6. Implement list_tickets() with filters (status, is_rush, customer_id, date range)\n\n## Files to create\n- apps/api/src/models/ticket.rs\n- apps/api/src/repositories/ticket.rs\n\n## Success criteria\nCan create and retrieve tickets, filters work","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.71293-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:17:17.061009-05:00","closed_at":"2026-01-20T06:17:17.061009-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-k4b","depends_on_id":"facet-md6","type":"blocks","created_at":"2026-01-19T22:20:19.072325-05:00","created_by":"Blake Blount"}]}
{"id":"facet-k6a","title":"Add search filters (status, date range)","description":"Add filters to search results.\n\nSteps:\n1. Status filter dropdown (all, specific statuses including archived)\n2. Date range filter (from/to date pickers)\n3. Filters update URL params\n4. Filters apply to API call\n5. Clear filters option\n\nFiles to modify:\n- apps/web/src/routes/search/+page.svelte\n\nSuccess criteria: Filters work, persist in URL","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.387025-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:18:10.307848-05:00","closed_at":"2026-01-20T11:18:10.307848-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-k6a","depends_on_id":"facet-ce0","type":"blocks","created_at":"2026-01-19T22:21:20.239647-05:00","created_by":"Blake Blount"}]}
{"id":"facet-kn1","title":"UI Test: Modal closes on backdrop click","description":"## Test: Modal Backdrop Dismiss\n\n### Preconditions\n- Dev server running\n- Any modal is open\n\n### Steps\n1. Open the intake form modal\n2. Click on the dark backdrop (outside the modal content)\n3. Open a ticket detail modal\n4. Click on the backdrop\n5. Note any exceptions or variations\n\n### Success Criteria\n- [ ] Clicking backdrop closes intake form modal\n- [ ] Clicking backdrop closes ticket detail modal\n- [ ] Clicking inside modal content does NOT close it\n- [ ] Backdrop click behavior consistent across modals\n- [ ] Loading states may prevent backdrop close\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:56:00.377677-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:34:16.427015-05:00","closed_at":"2026-01-20T18:34:16.427015-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-lm4","title":"Implement rush badge and overdue indicator styling","description":"Style rush and overdue visual indicators.\n\nSteps:\n1. Rush badge: gold/teal badge on card\n2. Overdue: red border or background tint\n3. Ensure visibility with both themes\n4. Overdue calculated from promise_date \u003c today\n5. Add visual priority: rush cards show distinctly\n\nFiles to modify:\n- apps/web/src/lib/components/TicketCard.svelte\n- apps/web/src/lib/components/Badge.svelte\n\nSuccess criteria: Rush and overdue visually distinct","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.699412-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:44:40.449814-05:00","closed_at":"2026-01-20T11:44:40.449814-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-lm4","depends_on_id":"facet-8mk","type":"blocks","created_at":"2026-01-19T22:21:12.923232-05:00","created_by":"Blake Blount"},{"issue_id":"facet-lm4","depends_on_id":"facet-y53","type":"blocks","created_at":"2026-01-19T22:21:13.021422-05:00","created_by":"Blake Blount"}]}
{"id":"facet-lpb","title":"UI Test: Theme toggle - Arcane","description":"## Test: Arcane Theme Selection\n\n### Preconditions\n- Dev server running\n- On admin page\n\n### Steps\n1. Navigate to /admin\n2. Locate the Appearance/Theme section\n3. Find the \"Arcane\" theme button\n4. Click Arcane button\n5. Observe the UI changes\n\n### Success Criteria\n- [ ] Arcane theme button is clickable\n- [ ] Clicking applies Arcane theme immediately\n- [ ] Button shows active/selected state\n- [ ] Previous theme button loses active state\n- [ ] Theme persists after page refresh\n- [ ] Color scheme matches Arcane theme definition\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:58.459665-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:52:36.648843-05:00","closed_at":"2026-01-20T18:52:36.648843-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-lu4x","title":"CRIT-3: Add magic byte validation for photo uploads","description":"## Problem\nThe photo upload endpoint validates the `Content-Type` from the multipart header, which is client-controlled. Attackers can upload any file type (malware, scripts, HTML) by spoofing the Content-Type header.\n\n## Location\n`apps/api/src/handlers/tickets.rs:upload_photo` (lines 1486-1497)\n\n## Files to Modify\n- `apps/api/src/handlers/tickets.rs` - Add magic byte validation\n- Create `apps/api/src/utils/file_validation.rs` - Reusable validation logic\n\n## Implementation Steps\n\n### Step 1: Create File Validation Module\nCreate `apps/api/src/utils/file_validation.rs`:\n\n```rust\n/// Magic bytes for supported image formats\nconst JPEG_MAGIC: \u0026[u8] = \u0026[0xFF, 0xD8, 0xFF];\nconst PNG_MAGIC: \u0026[u8] = \u0026[0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A];\nconst WEBP_MAGIC_RIFF: \u0026[u8] = \u0026[0x52, 0x49, 0x46, 0x46]; // \"RIFF\"\nconst WEBP_MAGIC_WEBP: \u0026[u8] = \u0026[0x57, 0x45, 0x42, 0x50]; // \"WEBP\" at offset 8\n\npub enum ImageFormat {\n    Jpeg,\n    Png,\n    WebP,\n}\n\npub fn detect_image_format(data: \u0026[u8]) -\u003e Option\u003cImageFormat\u003e {\n    if data.len() \u003c 12 {\n        return None;\n    }\n    \n    if data.starts_with(JPEG_MAGIC) {\n        Some(ImageFormat::Jpeg)\n    } else if data.starts_with(PNG_MAGIC) {\n        Some(ImageFormat::Png)\n    } else if data.starts_with(WEBP_MAGIC_RIFF) \u0026\u0026 \u0026data[8..12] == WEBP_MAGIC_WEBP {\n        Some(ImageFormat::WebP)\n    } else {\n        None\n    }\n}\n\npub fn validate_image_matches_content_type(data: \u0026[u8], content_type: \u0026str) -\u003e bool {\n    match detect_image_format(data) {\n        Some(ImageFormat::Jpeg) =\u003e content_type == \"image/jpeg\",\n        Some(ImageFormat::Png) =\u003e content_type == \"image/png\",\n        Some(ImageFormat::WebP) =\u003e content_type == \"image/webp\",\n        None =\u003e false,\n    }\n}\n```\n\n### Step 2: Update Upload Handler\nIn `upload_photo`, after reading file data:\n\n```rust\n// Validate magic bytes match Content-Type\nif !validate_image_matches_content_type(\u0026data, \u0026content_type) {\n    return Err(AppError::validation(\n        \"File content does not match declared Content-Type. Only JPEG, PNG, and WebP images are allowed.\"\n    ));\n}\n```\n\n### Step 3: Add Module to Lib\n- Add `pub mod utils;` to `lib.rs`\n- Add `pub mod file_validation;` to `utils/mod.rs`\n\n### Step 4: Consider Re-encoding (Optional Security Enhancement)\nFor maximum security, consider re-encoding images server-side:\n- Use `image` crate to decode and re-encode\n- This strips any embedded malicious content, EXIF exploits, polyglot files\n- Trade-off: CPU overhead, potential quality loss\n\n## Success Criteria\n- [ ] Magic byte validation rejects files with spoofed Content-Type\n- [ ] Valid JPEG files with correct Content-Type are accepted\n- [ ] Valid PNG files with correct Content-Type are accepted\n- [ ] Valid WebP files with correct Content-Type are accepted\n- [ ] HTML files with image/jpeg Content-Type are rejected\n- [ ] Truncated/corrupted files are rejected\n- [ ] Clear error message returned for validation failures\n\n## Testing Requirements\n\n### Unit Tests for `file_validation.rs`\n- `detect_image_format` correctly identifies JPEG\n- `detect_image_format` correctly identifies PNG\n- `detect_image_format` correctly identifies WebP\n- `detect_image_format` returns None for unknown formats\n- `detect_image_format` handles files smaller than 12 bytes\n- `validate_image_matches_content_type` matches correctly\n- `validate_image_matches_content_type` rejects mismatches\n\n### Integration Tests\nCreate test cases in `apps/api/tests/photo_upload.rs`:\n1. Upload valid JPEG with correct Content-Type -\u003e 201\n2. Upload valid PNG with correct Content-Type -\u003e 201\n3. Upload valid WebP with correct Content-Type -\u003e 201\n4. Upload HTML file with image/jpeg Content-Type -\u003e 400\n5. Upload executable with image/png Content-Type -\u003e 400\n6. Upload JPEG with image/png Content-Type -\u003e 400 (mismatch)\n7. Upload empty file -\u003e 400\n8. Upload file with only magic bytes (truncated) -\u003e still accepted (basic validation)\n\n### Test Files Needed\nCreate test fixtures in `apps/api/tests/fixtures/`:\n- `valid.jpg` - small valid JPEG\n- `valid.png` - small valid PNG\n- `valid.webp` - small valid WebP\n- `fake.jpg` - HTML file with .jpg extension\n- `malicious.png` - executable with PNG magic bytes prepended\n\n## Security Validation\n- Test that polyglot files (valid image + embedded script) are either rejected or safely re-encoded\n- Verify error messages don't reveal server internals\n- Test with fuzzing tools for edge cases","status":"closed","priority":0,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:30:36.68379-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T23:03:59.901551-05:00","closed_at":"2026-01-20T23:03:59.901551-05:00","close_reason":"Closed"}
{"id":"facet-m1n","title":"Integrate TicketDetailModal with workboard (ticket cards open modal)","description":"## Problem\nClicking ticket cards on the workboard navigates to /tickets/[id] placeholder page instead of opening the TicketDetailModal. This blocks core workflow functionality.\n\n## Context from UI Testing\n- Test facet-19y: \"BLOCKED - Ticket detail modal not integrated with workboard\"\n- Test facet-2f5: Photo lightbox test also BLOCKED due to same issue\n- The TicketDetailModal component exists and works correctly via the Search page\n- The /tickets/[id] page shows only \"Ticket detail page coming soon.\" placeholder\n\n## Root Cause\n- Workboard page uses `navigateToTicket(ticketId)` function which redirects to `/tickets/[id]` page\n- TicketDetailModal component is not imported or used in workboard page\n- Component exists at: apps/web/src/lib/components/TicketDetailModal.svelte\n\n## Steps to Fix\n1. Open apps/web/src/routes/(app)/+page.svelte (workboard)\n2. Import TicketDetailModal component\n3. Add state for selected ticket ID and modal open state\n4. Replace `navigateToTicket()` call with function that opens the modal\n5. Add TicketDetailModal to the component template\n6. Test opening/closing modal from ticket cards\n7. Verify modal displays all ticket data correctly\n\n## Success Criteria\n- [ ] Clicking any ticket card on workboard opens TicketDetailModal\n- [ ] Modal displays with overlay backdrop\n- [ ] Modal contains all ticket sections (customer, item, photos, pricing, status, notes, activity)\n- [ ] Close button (X) and backdrop click close the modal\n- [ ] ESC key closes the modal\n- [ ] Workboard state is preserved when modal closes","status":"closed","priority":0,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:39:07.587683-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T20:45:53.27715-05:00","closed_at":"2026-01-20T20:45:53.27715-05:00","close_reason":"Closed"}
{"id":"facet-m79","title":"UI Test: Drag ticket between lanes","description":"## Test: Drag and Drop Status Change\n\n### Preconditions\n- Dev server running\n- At least one ticket exists in a non-final status\n- Know a valid employee PIN\n\n### Steps\n1. Navigate to workboard (/)\n2. Locate a ticket card in Intake lane\n3. Click and hold the ticket card\n4. Drag it to the \"In Progress\" lane\n5. Release (drop) the ticket\n6. Observe what happens\n\n### Success Criteria\n- [ ] Ticket card is draggable (can pick it up)\n- [ ] While dragging, card becomes semi-transparent (0.5 opacity)\n- [ ] Target lane shows visual feedback (dashed border, highlight)\n- [ ] Dropping triggers PIN verification modal\n- [ ] After PIN verify, ticket moves to new lane\n- [ ] Lane counts update accordingly\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:55:32.679078-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:29:24.355527-05:00","closed_at":"2026-01-20T16:29:24.355527-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-mbf","title":"Fix storage locations API response parsing on admin page","description":"## Problem\nStorage locations section shows \"No storage locations configured yet.\" even when 5 locations exist in database. API response format mismatch.\n\n## Context from UI Testing\n- Test facet-32y: \"FAIL (API Response Parsing Bug)\"\n- API returns: {data: {locations: [...], count: N}}\n- Frontend expects: {data: [...]}\n- User sees empty list despite 5 active locations existing\n\n## Root Cause\n- apps/web/src/routes/admin/+page.server.ts line 38\n- Code: locations = json.data; (sets locations to object {locations: [...], count: N})\n- Template checks data.locations.length \u003e 0 which fails on object\n\n## Steps to Fix\n1. Open apps/web/src/routes/admin/+page.server.ts\n2. Line 38: Change `locations = json.data;` to `locations = json.data.locations || [];`\n3. Test admin page shows all 5 storage locations\n4. Verify inactive badge would display if any were inactive\n\n## Success Criteria\n- [ ] All 5 storage locations display on admin page\n- [ ] Each location shows name\n- [ ] Inactive locations would show \"Inactive\" badge\n- [ ] List is properly formatted","status":"closed","priority":1,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:39:36.955304-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T20:53:38.626855-05:00","closed_at":"2026-01-20T20:53:38.626855-05:00","close_reason":"Closed"}
{"id":"facet-md6","title":"Set up sqlx database connection pool","description":"Configure sqlx PostgreSQL connection pool.\n\n## Steps\n1. Add sqlx to Cargo.toml with postgres and runtime-tokio features\n2. Create database connection pool in config\n3. Add pool to Axum app state\n4. Create db module for pool access\n5. Test connection on startup\n\n## Files to create/modify\n- apps/api/src/db.rs\n- apps/api/src/config.rs\n\n## Success criteria\nApp connects to Postgres on startup, pool available in handlers","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.501439-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:11:50.487893-05:00","closed_at":"2026-01-20T06:11:50.487893-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-md6","depends_on_id":"facet-h67","type":"blocks","created_at":"2026-01-19T22:20:18.62096-05:00","created_by":"Blake Blount"},{"issue_id":"facet-md6","depends_on_id":"facet-pnk","type":"blocks","created_at":"2026-01-19T22:20:18.684718-05:00","created_by":"Blake Blount"}]}
{"id":"facet-mxo","title":"UI Test: Header navigation links work","description":"## Test: Header Navigation\n\n### Preconditions\n- Dev server running\n\n### Steps\n1. Navigate to any page\n2. Observe the header/navigation bar\n3. Click each navigation link\n4. Verify correct page loads\n\n### Success Criteria\n- [ ] Header is present on all pages\n- [ ] Logo/Home link navigates to workboard (/)\n- [ ] Search link navigates to /search\n- [ ] Settings/Admin link navigates to /admin\n- [ ] Current page is visually indicated in nav\n- [ ] Navigation works from any page\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:55:59.689386-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:08:18.351109-05:00","closed_at":"2026-01-20T18:08:18.351109-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-n0w","title":"Implement POST /tickets endpoint","description":"Create endpoint to create new tickets.\n\nSteps:\n1. Add handler for ticket creation\n2. Validate X-Employee-ID header\n3. Handle inline customer creation or existing customer link\n4. Generate friendly_code using stored function\n5. Create ticket record\n6. Create initial status history entry\n7. Return ticket with print URLs\n\nAPI: POST /api/v1/tickets\nHeaders: X-Employee-ID\n\nSuccess criteria: Creates ticket, generates friendly_code, returns print URLs","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.497199-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:22:51.638895-05:00","closed_at":"2026-01-20T06:22:51.638895-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-n0w","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:18.617597-05:00","created_by":"Blake Blount"},{"issue_id":"facet-n0w","depends_on_id":"facet-k4b","type":"blocks","created_at":"2026-01-19T22:20:19.090228-05:00","created_by":"Blake Blount"}]}
{"id":"facet-nex","title":"Create Input component","description":"Build styled text input with label and error state.\n\nSteps:\n1. Create Input.svelte component\n2. Props: label, placeholder, value, error, disabled, required\n3. Bind value with two-way binding\n4. Error message display\n5. Theme-consistent styling\n\nFiles to create:\n- apps/web/src/lib/components/Input.svelte\n\nSuccess criteria: Input works with validation feedback","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:45.840185-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:42:49.981322-05:00","closed_at":"2026-01-20T09:42:49.981322-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-nex","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:21:11.692686-05:00","created_by":"Blake Blount"}]}
{"id":"facet-nyfe","title":"MED-2: Replace cascading deletes with soft-delete for tickets","description":"## Problem\nThe database schema uses `ON DELETE CASCADE` for ticket-related tables. Deleting a ticket permanently destroys all associated audit records (photos, notes, status_history, field_history).\n\n## Location\n`apps/api/migrations/001_initial_schema.sql`:\n```sql\nticket_photos ... ON DELETE CASCADE\nticket_notes ... ON DELETE CASCADE\nticket_status_history ... ON DELETE CASCADE\nticket_field_history ... ON DELETE CASCADE\n```\n\n## Files to Modify\n- `apps/api/migrations/` - New migration to alter constraints and add soft-delete\n- `apps/api/src/models/ticket.rs` - Add deleted_at field\n- `apps/api/src/repositories/ticket.rs` - Update queries to filter deleted\n- `apps/api/src/handlers/tickets.rs` - Add soft-delete endpoint (admin only)\n\n## Implementation Steps\n\n### Step 1: Create Migration for Soft-Delete\nCreate `005_soft_delete_tickets.sql`:\n\n```sql\n-- Add soft-delete column to tickets\nALTER TABLE tickets ADD COLUMN deleted_at TIMESTAMPTZ;\nALTER TABLE tickets ADD COLUMN deleted_by UUID REFERENCES employees(employee_id);\n\n-- Create index for deleted tickets\nCREATE INDEX idx_tickets_deleted ON tickets (deleted_at) WHERE deleted_at IS NOT NULL;\n\n-- Remove CASCADE from history tables, keep for photos/notes (they're not audit)\n-- Note: We keep CASCADE on photos/notes since they're attachments, not audit\n\n-- For audit tables, change to RESTRICT to prevent accidental deletion\nALTER TABLE ticket_status_history \nDROP CONSTRAINT ticket_status_history_ticket_id_fkey,\nADD CONSTRAINT ticket_status_history_ticket_id_fkey \n    FOREIGN KEY (ticket_id) REFERENCES tickets(ticket_id) ON DELETE RESTRICT;\n\nALTER TABLE ticket_field_history \nDROP CONSTRAINT ticket_field_history_ticket_id_fkey,\nADD CONSTRAINT ticket_field_history_ticket_id_fkey \n    FOREIGN KEY (ticket_id) REFERENCES tickets(ticket_id) ON DELETE RESTRICT;\n```\n\n### Step 2: Update Ticket Model\nIn `models/ticket.rs`:\n\n```rust\npub struct Ticket {\n    // ... existing fields ...\n    pub deleted_at: Option\u003cDateTime\u003cUtc\u003e\u003e,\n    pub deleted_by: Option\u003cUuid\u003e,\n}\n\nimpl Ticket {\n    pub fn is_deleted(\u0026self) -\u003e bool {\n        self.deleted_at.is_some()\n    }\n}\n```\n\n### Step 3: Update Repository Queries\nAll ticket queries should filter out deleted tickets by default:\n\n```rust\n// In TicketRepository\npub async fn find_by_id(pool: \u0026PgPool, ticket_id: Uuid) -\u003e Result\u003cOption\u003cTicket\u003e, AppError\u003e {\n    sqlx::query_as::\u003c_, Ticket\u003e(\n        \"SELECT * FROM tickets WHERE ticket_id = $1 AND deleted_at IS NULL\"\n    )\n    .bind(ticket_id)\n    .fetch_optional(pool)\n    .await\n    .map_err(Into::into)\n}\n\n// Add method to find including deleted (for admin)\npub async fn find_by_id_including_deleted(pool: \u0026PgPool, ticket_id: Uuid) -\u003e Result\u003cOption\u003cTicket\u003e, AppError\u003e {\n    sqlx::query_as::\u003c_, Ticket\u003e(\n        \"SELECT * FROM tickets WHERE ticket_id = $1\"\n    )\n    .bind(ticket_id)\n    .fetch_optional(pool)\n    .await\n    .map_err(Into::into)\n}\n```\n\n### Step 4: Add Soft-Delete Endpoint\nCreate `DELETE /api/v1/tickets/:ticket_id` (admin only):\n\n```rust\npub async fn delete_ticket(\n    State(state): State\u003cAppState\u003e,\n    headers: HeaderMap,\n    Path(ticket_id): Path\u003cUuid\u003e,\n) -\u003e Result\u003cimpl IntoResponse, AppError\u003e {\n    // Verify admin\n    verify_admin_session(\u0026state, \u0026headers).await?;\n    \n    // Find ticket (must exist and not be deleted)\n    let ticket = TicketRepository::find_by_id(\u0026state.db, ticket_id)\n        .await?\n        .ok_or_else(|| AppError::not_found(\"Ticket not found\"))?;\n    \n    // Get admin employee from session\n    let admin = get_admin_from_session(\u0026state, \u0026headers).await?;\n    \n    // Soft-delete\n    TicketRepository::soft_delete(\u0026state.db, ticket_id, admin.employee_id).await?;\n    \n    Ok(Json(ApiResponse::success(())))\n}\n```\n\n### Step 5: Add Restore Endpoint (Optional)\nCreate `POST /api/v1/tickets/:ticket_id/restore` (admin only):\n\n```rust\npub async fn restore_ticket(...) {\n    // Similar to delete but sets deleted_at = NULL\n}\n```\n\n### Step 6: Update List/Search Queries\nEnsure all listing queries filter deleted tickets:\n\n```rust\n// In list_tickets\n.filter(\"deleted_at IS NULL\")\n\n// Add admin-only parameter to include deleted\npub struct ListTicketsQuery {\n    // ... existing ...\n    pub include_deleted: Option\u003cbool\u003e, // Admin only\n}\n```\n\n## Success Criteria\n- [ ] Tickets can be soft-deleted (deleted_at timestamp set)\n- [ ] Soft-deleted tickets are excluded from normal queries\n- [ ] Audit history (status, field) is preserved after soft-delete\n- [ ] Hard delete is prevented by foreign key RESTRICT\n- [ ] Only admin can delete tickets\n- [ ] Deleted tickets can be restored (optional)\n- [ ] API returns clear indicator for deleted status\n\n## Testing Requirements\n\n### Unit Tests\n- `is_deleted` returns correct value\n- Queries filter deleted by default\n\n### Integration Tests\nCreate `apps/api/tests/ticket_deletion.rs`:\n1. DELETE /tickets/:id as admin -\u003e 200, ticket soft-deleted\n2. GET /tickets/:id after delete -\u003e 404 (not visible)\n3. GET /tickets (list) doesn't include deleted\n4. DELETE /tickets/:id as staff -\u003e 403\n5. Status history preserved after soft-delete\n6. Field history preserved after soft-delete\n7. Admin can list including deleted (with flag)\n8. Restore endpoint works (if implemented)\n\n### Database Verification\n1. Delete ticket via API\n2. Query database directly - record exists with deleted_at set\n3. Query history tables - all records preserved\n4. Attempt hard delete via SQL - fails with FK constraint\n\n## Security Validation\n- Verify soft-deleted tickets don't appear in search\n- Confirm audit trail cannot be destroyed\n- Test that photos/notes are still accessible for deleted tickets (for audit)\n- Verify delete operation is logged in field_history","status":"closed","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:37:01.931812-05:00","created_by":"Blake Blount","updated_at":"2026-01-21T00:21:01.657264-05:00","closed_at":"2026-01-21T00:21:01.657264-05:00","close_reason":"Closed"}
{"id":"facet-oaac","title":"Edit ticket button in modal does not respond","description":"## Bug Description\nWhen viewing a ticket detail modal from the workboard, clicking the 'Edit' button produces no response. The UI does not change and the ticket fields remain non-editable.\n\n## Steps to Reproduce\n1. Navigate to the Workboard\n2. Click on any ticket card to open the ticket detail modal\n3. Click the 'Edit' button in the modal\n4. Observe: Nothing happens - no UI response\n\n## Investigation Steps\n1. Check browser console for JavaScript errors when clicking the edit button\n2. Verify the edit button has a click handler attached\n3. Trace the click event to see if it's being captured/prevented\n4. Check if the edit state is being set but the UI isn't re-rendering\n5. Review the modal component to understand the edit mode toggle logic\n\n## Success Criteria\n- [ ] Clicking the 'Edit' button in the ticket detail modal enables edit mode\n- [ ] All editable fields become interactive (inputs, dropdowns, etc.)\n- [ ] User can modify ticket data and save changes\n- [ ] The UI provides clear visual feedback that edit mode is active","status":"open","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-21T08:30:23.67706-05:00","created_by":"Blake Blount","updated_at":"2026-01-21T08:30:32.130063-05:00"}
{"id":"facet-oph","title":"Service worker cache shows stale ticket count on workboard","description":"## Problem\nAfter creating a ticket, workboard briefly shows old count instead of updated count. Requires hard refresh or cache clear to see correct data immediately.\n\n## Context from UI Testing\n- Test facet-e4u: \"MEDIUM - Service worker cache can show stale data on initial load\"\n- After creating JR-0003, workboard showed 2 instead of 3 tickets\n- Hard refresh or cache clear resolved this\n- May confuse users expecting real-time updates\n\n## Steps to Fix\n1. Review service worker cache strategy\n2. Consider cache-first vs network-first for ticket data\n3. Options:\n   a. Invalidate cache after ticket creation\n   b. Use network-first for workboard data\n   c. Add cache-busting query param\n   d. Use WebSocket/SSE for real-time updates\n\n## Success Criteria\n- [ ] New ticket appears immediately on workboard after creation\n- [ ] Lane counts update in real-time\n- [ ] No stale data shown after mutations","status":"closed","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:40:31.709689-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T21:23:56.172308-05:00","closed_at":"2026-01-20T21:23:56.172308-05:00","close_reason":"Fixed by adding NetworkFirst caching rule for SvelteKit __data.json endpoints. After ticket creation, workboard now shows updated data immediately."}
{"id":"facet-p7r","title":"Create seed data migration","description":"Create migration for default data (admin, storage locations).\n\n## Steps\n1. Create migration file: 002_seed_data.sql\n2. Insert default admin employee (name: Admin, PIN: changeme hashed with argon2)\n3. Insert initial store_settings row (setup_complete: false)\n4. Insert default storage locations (Safe Drawer 1, Safe Drawer 2, Workbench A, Workbench B, Display Case)\n5. Run migration\n\n## Files to create\n- apps/api/migrations/002_seed_data.sql\n\n## Success criteria\nMigration runs, default data exists in database","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.278424-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:37:58.754912-05:00","closed_at":"2026-01-20T08:37:58.754912-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-p7r","depends_on_id":"facet-pnk","type":"blocks","created_at":"2026-01-19T22:20:18.673143-05:00","created_by":"Blake Blount"}]}
{"id":"facet-p9kk","title":"MED-1: Bind employee ID to authenticated session","description":"## Problem\nAny valid employee UUID can be used in the `X-Employee-ID` header. There's no verification that the current request is authorized to act as that employee. Employee A can impersonate Employee B by sending B's UUID in the header.\n\n## Location\n`apps/api/src/handlers/tickets.rs:extract_employee_id`\n\n## Files to Modify\n- `apps/api/migrations/` - Add employee_sessions table\n- `apps/api/src/handlers/employees.rs` - Return session token on verify\n- `apps/api/src/handlers/tickets.rs` - Get employee from session, not header\n- Create `apps/api/src/session/employee_session.rs` - Employee session management\n- `apps/api/src/middleware/` - Session extraction middleware\n\n## Implementation Steps\n\n### Step 1: Create Employee Sessions Table\nCreate migration `004_add_employee_sessions.sql`:\n\n```sql\nCREATE TABLE employee_sessions (\n    session_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    employee_id UUID NOT NULL REFERENCES employees(employee_id) ON DELETE CASCADE,\n    session_token VARCHAR(64) NOT NULL UNIQUE,\n    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n    expires_at TIMESTAMPTZ NOT NULL,\n    last_activity_at TIMESTAMPTZ NOT NULL DEFAULT NOW()\n);\n\nCREATE INDEX idx_employee_sessions_token ON employee_sessions (session_token);\nCREATE INDEX idx_employee_sessions_employee ON employee_sessions (employee_id);\nCREATE INDEX idx_employee_sessions_expires ON employee_sessions (expires_at);\n```\n\n### Step 2: Update Employee Verify Response\nModify `POST /api/v1/employees/verify`:\n\n```rust\n#[derive(Serialize)]\npub struct VerifyPinResponse {\n    pub employee_id: Uuid,\n    pub name: String,\n    pub role: EmployeeRole,\n    pub session_token: String,  // New field\n    pub expires_at: DateTime\u003cUtc\u003e,  // New field\n}\n\npub async fn verify_employee_pin(...) {\n    // ... existing verification ...\n    \n    // Create session\n    let session = EmployeeSession::new(employee.employee_id, 8 * 60); // 8 hours\n    EmployeeSessionRepository::create(\u0026state.db, \u0026session).await?;\n    \n    let response = VerifyPinResponse {\n        employee_id: employee.employee_id,\n        name: employee.name,\n        role: employee.role,\n        session_token: session.session_token,\n        expires_at: session.expires_at,\n    };\n    Ok(Json(ApiResponse::success(response)))\n}\n```\n\n### Step 3: Replace extract_employee_id\nChange from header-based to session-based:\n\n```rust\nasync fn extract_employee_from_session(\n    state: \u0026AppState,\n    headers: \u0026HeaderMap,\n) -\u003e Result\u003cEmployee, AppError\u003e {\n    let token = headers\n        .get(\"X-Employee-Session\")\n        .and_then(|v| v.to_str().ok())\n        .ok_or_else(|| AppError::unauthorized(\"Missing X-Employee-Session header\"))?;\n    \n    let session = EmployeeSessionRepository::find_by_token(\u0026state.db, token)\n        .await?\n        .ok_or_else(|| AppError::unauthorized(\"Invalid or expired session\"))?;\n    \n    if session.is_expired() {\n        EmployeeSessionRepository::delete(\u0026state.db, session.session_id).await?;\n        return Err(AppError::unauthorized(\"Session expired\"));\n    }\n    \n    // Update last activity\n    EmployeeSessionRepository::touch(\u0026state.db, session.session_id).await?;\n    \n    // Fetch full employee record\n    EmployeeRepository::find_active_by_id(\u0026state.db, session.employee_id)\n        .await?\n        .ok_or_else(|| AppError::unauthorized(\"Employee not found or inactive\"))\n}\n```\n\n### Step 4: Update All Ticket Handlers\nReplace all uses of `extract_employee_id(\u0026headers)?` with `extract_employee_from_session(\u0026state, \u0026headers).await?`.\n\n### Step 5: Add Employee Logout\nCreate `POST /api/v1/employees/logout`:\n\n```rust\npub async fn employee_logout(\n    State(state): State\u003cAppState\u003e,\n    headers: HeaderMap,\n) -\u003e Result\u003cimpl IntoResponse, AppError\u003e {\n    if let Some(token) = headers.get(\"X-Employee-Session\").and_then(|v| v.to_str().ok()) {\n        EmployeeSessionRepository::delete_by_token(\u0026state.db, token).await?;\n    }\n    Ok(Json(ApiResponse::success(())))\n}\n```\n\n### Step 6: Handle Session Expiration in Frontend\nUpdate frontend to:\n- Store session token after PIN verification\n- Send X-Employee-Session header instead of X-Employee-ID\n- Redirect to login on 401 responses\n- Consider refresh token mechanism for long shifts\n\n## Success Criteria\n- [ ] Employee verify returns session token\n- [ ] X-Employee-ID header no longer accepted (deprecated)\n- [ ] X-Employee-Session header required for authenticated endpoints\n- [ ] Session tied to specific employee (no impersonation)\n- [ ] Sessions expire after 8 hours (configurable)\n- [ ] Logout invalidates session\n- [ ] Deactivated employee sessions are invalidated\n\n## Testing Requirements\n\n### Unit Tests\n- Session token generation is random\n- Session expiration detection\n- Employee lookup from session\n\n### Integration Tests\nCreate `apps/api/tests/employee_session.rs`:\n1. POST /employees/verify -\u003e returns session token\n2. POST /tickets with session -\u003e uses correct employee\n3. POST /tickets with wrong employee's session -\u003e still uses session's employee (not spoofable)\n4. POST /tickets with expired session -\u003e 401\n5. POST /employees/logout -\u003e session invalidated\n6. Deactivate employee -\u003e existing sessions fail\n\n### Migration Testing\n- Ensure X-Employee-ID header works during transition period (optional)\n- Test with updated frontend using new session flow\n\n## Security Validation\n- Verify employee cannot be impersonated via header manipulation\n- Confirm session is bound to single employee\n- Test that session from employee A cannot access as employee B\n- Verify session tokens are not predictable\n- Check that deactivating employee invalidates all their sessions","status":"closed","priority":2,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:37:01.559581-05:00","created_by":"Blake Blount","updated_at":"2026-01-21T00:12:49.768333-05:00","closed_at":"2026-01-21T00:12:49.768333-05:00","close_reason":"Implemented session-based employee authentication with cryptographic tokens. Sessions created on PIN verification, validated with sliding expiration."}
{"id":"facet-pit","title":"Create IntakeFormModal structure","description":"Build new ticket intake form modal.\n\nSteps:\n1. Create IntakeFormModal.svelte component\n2. Props: open, onClose, onSuccess\n3. Large scrolling form modal\n4. Form sections: Customer, Item, Details, Photos\n5. Form state management\n6. Validation for required fields\n\nFiles to create:\n- apps/web/src/lib/components/IntakeFormModal.svelte\n\nSuccess criteria: Form modal opens, has all sections","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:42.496232-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:52:03.419123-05:00","closed_at":"2026-01-20T11:52:03.419123-05:00","close_reason":"Created IntakeFormModal.svelte with all four form sections (Customer, Item, Details, Photos), form state management, validation for required fields, and storage location fetching. Ready for API integration.","dependencies":[{"issue_id":"facet-pit","depends_on_id":"facet-eyr","type":"blocks","created_at":"2026-01-19T22:21:08.444894-05:00","created_by":"Blake Blount"},{"issue_id":"facet-pit","depends_on_id":"facet-nex","type":"blocks","created_at":"2026-01-19T22:21:08.483865-05:00","created_by":"Blake Blount"},{"issue_id":"facet-pit","depends_on_id":"facet-ri0","type":"blocks","created_at":"2026-01-19T22:21:08.524163-05:00","created_by":"Blake Blount"},{"issue_id":"facet-pit","depends_on_id":"facet-cb4","type":"blocks","created_at":"2026-01-19T22:21:08.563062-05:00","created_by":"Blake Blount"},{"issue_id":"facet-pit","depends_on_id":"facet-4p6","type":"blocks","created_at":"2026-01-19T22:21:08.605285-05:00","created_by":"Blake Blount"},{"issue_id":"facet-pit","depends_on_id":"facet-ubq","type":"blocks","created_at":"2026-01-19T22:21:08.643479-05:00","created_by":"Blake Blount"}]}
{"id":"facet-pnk","title":"Create initial database schema migration","description":"Create sqlx migration with all MVP tables per docs/SCHEMA.md.\n\n## Steps\n1. Set up sqlx CLI in apps/api\n2. Create migrations directory\n3. Create migration file: 001_initial_schema.sql\n4. Include all tables: customers, employees, storage_locations, tickets, ticket_photos, ticket_notes, ticket_status_history, ticket_field_history, store_settings\n5. Include all indexes from SCHEMA.md\n6. Include generate_friendly_code() function\n7. Run migration against local database\n\n## Files to create\n- apps/api/migrations/001_initial_schema.sql\n\n## Success criteria\n`sqlx migrate run` completes successfully, all tables exist","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:23.99944-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:08:29.63671-05:00","closed_at":"2026-01-20T06:08:29.63671-05:00","close_reason":"Migration created and tested successfully. All 9 tables, 2 enums, indexes, and generate_friendly_code() function created.","dependencies":[{"issue_id":"facet-pnk","depends_on_id":"facet-6sv","type":"blocks","created_at":"2026-01-19T22:20:18.498735-05:00","created_by":"Blake Blount"}]}
{"id":"facet-pqq","title":"Display notes in reverse chronological order (newest first)","description":"## Problem\nNotes are displayed in chronological order (oldest first). Users may prefer seeing most recent notes first.\n\n## Context from UI Testing\n- Test facet-8e7: \"LOW - Notes displayed in chronological order instead of reverse\"\n- Current: oldest notes at top\n- Expected per test criteria: newest notes first\n- This is a UX preference issue\n\n## Steps to Fix\n1. Open apps/web/src/lib/components/TicketDetailModal.svelte\n2. Find notes rendering section\n3. Reverse the notes array before rendering\n4. Or sort by created_at descending\n\n## Success Criteria\n- [ ] Most recent notes appear at top of list\n- [ ] Older notes appear below\n- [ ] Timestamps still display correctly","status":"closed","priority":3,"issue_type":"feature","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:41:01.843464-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T22:01:09.539223-05:00","closed_at":"2026-01-20T22:01:09.539223-05:00","close_reason":"Closed"}
{"id":"facet-pr9","title":"Implement customer search autocomplete in intake form","description":"Add customer search with autocomplete.\n\nSteps:\n1. Search input for customer name\n2. Debounced API call to GET /customers?search=...\n3. Dropdown showing matching customers\n4. Select existing customer: auto-fill phone/email\n5. No match: create new customer inline\n6. Customer ID tracked for form submission\n\nFiles to modify:\n- apps/web/src/lib/components/IntakeFormModal.svelte\n\nSuccess criteria: Customer autocomplete works, can select or create new","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:42.607237-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:56:55.087358-05:00","closed_at":"2026-01-20T11:56:55.087358-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-pr9","depends_on_id":"facet-pit","type":"blocks","created_at":"2026-01-19T22:21:08.74494-05:00","created_by":"Blake Blount"}]}
{"id":"facet-prd","title":"UI Test: Workboard loads with all 4 status lanes","description":"## Test: Workboard Initial Load\n\n### Preconditions\n- Dev server running (apps/web)\n- API server running (apps/api)\n- Database has seed data with tickets in various statuses\n\n### Steps\n1. Navigate to http://localhost:5173/ (or configured port)\n2. Wait for page to fully load\n3. Observe the workboard layout\n\n### Success Criteria\n- [ ] Page loads without errors (no console errors)\n- [ ] 4 status lanes are visible: \"Intake\", \"In Progress\", \"Waiting on Parts\", \"Ready for Pickup\"\n- [ ] Each lane has a header with the status name\n- [ ] Each lane header shows a count badge with number of tickets\n- [ ] Lanes are arranged horizontally\n- [ ] \"+New\" button is visible in the Intake lane\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:52:39.107204-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T14:16:52.574995-05:00","closed_at":"2026-01-20T14:16:52.574995-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-prik","title":"HIGH-2: Enforce employee role-based authorization","description":"## Problem\nThe database schema has `employee_role` enum (`staff`, `admin`), but role checks are inconsistent. Admin operations check `X-Admin-PIN` header, but ticket operations have no role checks. Staff and admin have equivalent ticket access, making the role field provide a false sense of security.\n\n## Location\n- `apps/api/src/handlers/employees.rs`: Uses X-Admin-PIN\n- `apps/api/src/handlers/tickets.rs`: No role checks\n\n## Files to Modify\n- `apps/api/src/handlers/tickets.rs` - Add role-based checks\n- `apps/api/src/handlers/customers.rs` - Consider read restrictions\n- Create `apps/api/src/middleware/rbac.rs` - Centralized role-based access control\n- `apps/api/src/models/employee.rs` - Add permission helper methods\n\n## Implementation Steps\n\n### Step 1: Define Permission Matrix\n\n| Action | Staff | Admin |\n|--------|-------|-------|\n| Create ticket | Yes | Yes |\n| View any ticket | Yes | Yes |\n| Modify own ticket | Yes | Yes |\n| Modify any ticket | No | Yes |\n| Add notes to any ticket | Yes | Yes |\n| Upload photos to any ticket | Yes | Yes |\n| Delete photos | No | Yes |\n| Close any ticket | No | Yes |\n| Change ticket status | Own only | Any |\n| View customers | Yes | Yes |\n| Manage employees | No | Yes |\n| Manage settings | No | Yes |\n| Manage locations | No | Yes |\n\n### Step 2: Create Permission Enum\nIn `models/employee.rs`:\n\n```rust\n#[derive(Debug, Clone, Copy, PartialEq)]\npub enum Permission {\n    CreateTicket,\n    ViewTicket,\n    ModifyOwnTicket,\n    ModifyAnyTicket,\n    AddNotes,\n    UploadPhotos,\n    DeletePhotos,\n    CloseAnyTicket,\n    ManageEmployees,\n    ManageSettings,\n    ManageLocations,\n}\n\nimpl EmployeeRole {\n    pub fn has_permission(\u0026self, permission: Permission) -\u003e bool {\n        match self {\n            EmployeeRole::Admin =\u003e true, // Admin has all permissions\n            EmployeeRole::Staff =\u003e matches!(permission,\n                Permission::CreateTicket |\n                Permission::ViewTicket |\n                Permission::ModifyOwnTicket |\n                Permission::AddNotes |\n                Permission::UploadPhotos\n            ),\n        }\n    }\n}\n```\n\n### Step 3: Create Authorization Middleware\nIn `middleware/rbac.rs`:\n\n```rust\npub fn require_permission(employee: \u0026Employee, permission: Permission) -\u003e Result\u003c(), AppError\u003e {\n    if employee.role.has_permission(permission) {\n        Ok(())\n    } else {\n        Err(AppError::forbidden(format!(\n            \"Insufficient permissions for this action\"\n        )))\n    }\n}\n\npub fn require_ticket_access(\n    employee: \u0026Employee,\n    ticket: \u0026Ticket,\n    permission: Permission,\n) -\u003e Result\u003c(), AppError\u003e {\n    // Admin always has access\n    if employee.role == EmployeeRole::Admin {\n        return Ok(());\n    }\n    \n    // Staff needs ownership for modify operations\n    if matches!(permission, Permission::ModifyOwnTicket) {\n        if ticket.taken_in_by == employee.employee_id \n            || ticket.worked_by == Some(employee.employee_id) {\n            return Ok(());\n        }\n    }\n    \n    // Other permissions follow role matrix\n    if employee.role.has_permission(permission) {\n        return Ok(());\n    }\n    \n    Err(AppError::forbidden(\"Insufficient permissions\"))\n}\n```\n\n### Step 4: Apply to Ticket Handlers\nUpdate each ticket handler to check permissions:\n\n```rust\npub async fn update_ticket(...) {\n    let employee = get_employee_from_header(...)?;\n    let ticket = get_ticket(...)?;\n    \n    require_ticket_access(\u0026employee, \u0026ticket, Permission::ModifyOwnTicket)?;\n    \n    // ... rest of handler\n}\n```\n\n### Step 5: Update Error Responses\nUse consistent 403 Forbidden responses:\n- Don't leak whether ticket exists to unauthorized users\n- Generic message: \"You don't have permission to perform this action\"\n\n## Success Criteria\n- [ ] Permission matrix is implemented as documented\n- [ ] Staff cannot modify tickets they don't own\n- [ ] Staff cannot delete photos\n- [ ] Staff cannot access admin endpoints (employees, settings, locations)\n- [ ] Admin can perform all operations\n- [ ] Consistent 403 responses for unauthorized actions\n- [ ] Role is checked from employee record, not trusted from client\n\n## Testing Requirements\n\n### Unit Tests\n- `has_permission` returns correct values for each role\n- `require_ticket_access` allows owner\n- `require_ticket_access` allows assigned worker\n- `require_ticket_access` denies unrelated staff\n- `require_ticket_access` allows admin for any ticket\n\n### Integration Tests\nCreate `apps/api/tests/role_authorization.rs`:\n1. Staff creates ticket -\u003e allowed\n2. Staff modifies own ticket -\u003e allowed\n3. Staff modifies other's ticket -\u003e 403\n4. Admin modifies any ticket -\u003e allowed\n5. Staff deletes photo -\u003e 403\n6. Admin deletes photo -\u003e allowed\n7. Staff accesses /employees -\u003e 403 (or X-Admin-PIN required)\n8. Staff accesses /settings PUT -\u003e 403\n\n### Edge Cases\n- Staff assigned to ticket (worked_by) can modify\n- Staff removed from assignment loses access\n- Deactivated admin loses all permissions\n\n## Security Validation\n- Verify role comes from database, not client header\n- Test that role changes take effect immediately\n- Confirm admin PIN bypass still works where intended\n- Test with modified client sending fake role claims","status":"closed","priority":1,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:33:48.129598-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T23:49:41.992938-05:00","closed_at":"2026-01-20T23:49:41.992938-05:00","close_reason":"Closed"}
{"id":"facet-psb","title":"CRIT-2: Implement row-level authorization for tickets","description":"## Problem\nThe `X-Employee-ID` header is validated to ensure the employee exists and is active, but there is no check that this employee has permission to modify the specific ticket. Any authenticated employee can modify any ticket by providing a valid employee ID.\n\n## Affected Endpoints\n- `PUT /api/v1/tickets/:ticket_id`\n- `POST /api/v1/tickets/:ticket_id/status`\n- `POST /api/v1/tickets/:ticket_id/close`\n- `POST /api/v1/tickets/:ticket_id/rush`\n- `POST /api/v1/tickets/:ticket_id/notes`\n- `POST /api/v1/tickets/:ticket_id/photos`\n\n## Files to Modify\n- `apps/api/src/handlers/tickets.rs` - Add authorization checks\n- `apps/api/src/models/employee.rs` - May need helper methods for role checking\n- `apps/api/src/repositories/employee.rs` - Add authorization query methods\n- Create `apps/api/src/middleware/authorization.rs` for reusable auth logic\n\n## Implementation Steps\n\n### Step 1: Define Ownership Model\nA ticket is \"owned\" by an employee if:\n- `taken_in_by` matches employee_id (created the ticket), OR\n- `worked_by` matches employee_id (assigned to work on it), OR\n- Employee has `admin` role (can modify any ticket)\n\n### Step 2: Create Authorization Helper\nCreate `is_authorized_for_ticket(employee: \u0026Employee, ticket: \u0026Ticket) -\u003e bool`:\n```rust\nfn is_authorized_for_ticket(employee: \u0026Employee, ticket: \u0026Ticket) -\u003e bool {\n    employee.role == EmployeeRole::Admin\n        || ticket.taken_in_by == employee.employee_id\n        || ticket.worked_by == Some(employee.employee_id)\n}\n```\n\n### Step 3: Apply to Each Handler\nFor each affected endpoint:\n1. Fetch the ticket first\n2. Fetch the employee (already done)\n3. Call authorization check\n4. Return 403 Forbidden if not authorized\n\n### Step 4: Create Consistent Error Response\nAdd `AppError::forbidden_ticket()` for clear messaging:\n- Code: `FORBIDDEN`\n- Message: \"You do not have permission to modify this ticket\"\n\n### Step 5: Allow Assignment Changes\nSpecial case for assigning `worked_by`:\n- Staff can only assign themselves\n- Admin can assign anyone\n- Validate this in `update_ticket` handler\n\n## Success Criteria\n- [ ] Staff can only modify tickets they took in or are assigned to\n- [ ] Admin can modify any ticket\n- [ ] Unauthorized modifications return 403 Forbidden\n- [ ] Error messages don't leak information about ticket existence\n- [ ] All affected endpoints have authorization checks\n- [ ] Existing functionality works for authorized users\n\n## Testing Requirements\n\n### Unit Tests\n- `is_authorized_for_ticket` returns true for owner\n- `is_authorized_for_ticket` returns true for assigned worker\n- `is_authorized_for_ticket` returns true for admin\n- `is_authorized_for_ticket` returns false for unrelated staff\n\n### Integration Tests\nCreate `apps/api/tests/ticket_authorization.rs`:\n1. Create ticket as Employee A\n2. Attempt to modify as Employee B (staff) -\u003e 403\n3. Modify as Employee A -\u003e 200\n4. Assign to Employee B via admin\n5. Modify as Employee B -\u003e 200\n6. Modify as Admin -\u003e 200 (any ticket)\n\n### Edge Cases\n- Test adding notes to tickets user doesn't own (should fail for staff)\n- Test uploading photos to tickets user doesn't own (should fail)\n- Test closing tickets user doesn't own (should fail)\n- Test that GET endpoints still work (read is allowed)\n\n## Security Validation\n- Verify ticket UUIDs cannot be enumerated via auth errors (use same error for not-found vs forbidden)\n- Test with modified client sending arbitrary employee IDs\n- Confirm admin override works only for admin role employees","status":"closed","priority":0,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:30:34.243356-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T22:46:57.979459-05:00","closed_at":"2026-01-20T22:46:57.979459-05:00","close_reason":"Closed"}
{"id":"facet-q4o","title":"Create Workboard page layout","description":"Build main workboard page with lane structure.\n\nSteps:\n1. Create or update routes/+page.svelte for workboard\n2. Fetch queue data from GET /queue API\n3. Layout 4 horizontal lanes (Intake, In Progress, Waiting on Parts, Ready for Pickup)\n4. Show lane counts in headers\n5. \"+ New\" button in Intake lane\n6. Responsive: horizontal scroll on smaller screens\n\nFiles to modify:\n- apps/web/src/routes/+page.svelte\n- apps/web/src/routes/+page.ts (load function)\n\nSuccess criteria: Workboard displays with 4 lanes, fetches data","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.15847-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:25:15.200947-05:00","closed_at":"2026-01-20T11:25:15.200947-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-q4o","depends_on_id":"facet-01b","type":"blocks","created_at":"2026-01-19T22:21:11.703879-05:00","created_by":"Blake Blount"},{"issue_id":"facet-q4o","depends_on_id":"facet-ubq","type":"blocks","created_at":"2026-01-19T22:21:11.848975-05:00","created_by":"Blake Blount"},{"issue_id":"facet-q4o","depends_on_id":"facet-iyl","type":"blocks","created_at":"2026-01-19T22:21:11.994191-05:00","created_by":"Blake Blount"},{"issue_id":"facet-q4o","depends_on_id":"facet-ci7","type":"blocks","created_at":"2026-01-19T22:21:12.462182-05:00","created_by":"Blake Blount"}]}
{"id":"facet-q7s","title":"Implement POST /admin/change-pin endpoint","description":"Change admin PIN (requires current PIN).\n\nSteps:\n1. Add handler for PIN change\n2. Require X-Admin-PIN header (current PIN)\n3. Hash new PIN\n4. Update store_settings.admin_pin_hash\n\nAPI: POST /api/v1/admin/change-pin\nBody: { \"new_pin\": \"...\" }\n\nSuccess criteria: Changes admin PIN","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.702721-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:07:00.988976-05:00","closed_at":"2026-01-20T09:07:00.988976-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-q7s","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:19.502994-05:00","created_by":"Blake Blount"},{"issue_id":"facet-q7s","depends_on_id":"facet-4m6","type":"blocks","created_at":"2026-01-19T22:20:19.634155-05:00","created_by":"Blake Blount"}]}
{"id":"facet-qct","title":"Configure Tailwind CSS with theme variables","description":"Set up Tailwind with CSS custom properties for theming.\n\nSteps:\n1. Install and configure Tailwind CSS\n2. Create tailwind.config.js with theme extension\n3. Set up CSS custom properties for colors in app.css\n4. Define semantic color tokens (--color-background, --color-surface, --color-primary, etc.)\n5. Configure Tailwind to use CSS variables\n6. Add typography plugin for text styles\n\nFiles to create/modify:\n- apps/web/tailwind.config.js\n- apps/web/postcss.config.js\n- apps/web/src/app.css\n\nSuccess criteria: Tailwind works, theme variables accessible","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:44.047282-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T07:23:45.894598-05:00","closed_at":"2026-01-20T07:23:45.894598-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-qct","depends_on_id":"facet-6p6","type":"blocks","created_at":"2026-01-19T22:20:27.616534-05:00","created_by":"Blake Blount"}]}
{"id":"facet-qeq","title":"Add active state styling to header navigation links","description":"## Problem\nNavigation links (Workboard, Search) have no visual styling to indicate which page is currently active. Both links look identical regardless of current page.\n\n## Context from UI Testing\n- Test facet-mxo: \"FAIL - No visual distinction between active/inactive nav links\"\n- Navigation functionality works correctly\n- Only hover state exists (:hover { background-color: rgba(255, 255, 255, 0.1) })\n- No active state defined\n\n## Steps to Fix\n1. Open apps/web/src/lib/components/Header.svelte\n2. Import page store: import { page } from '\\$app/stores';\n3. Add conditional class based on current route:\n   class:active={\\$page.url.pathname === '/'}\n   class:active={\\$page.url.pathname.startsWith('/search')}\n4. Add CSS for .active state (underline, background, or color change)\n\n## Success Criteria\n- [ ] Current page link has distinct visual styling\n- [ ] Workboard link active when on / or /tickets/*\n- [ ] Search link active when on /search*\n- [ ] Settings icon active when on /admin\n- [ ] Active state clearly visible","status":"closed","priority":2,"issue_type":"feature","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:40:31.572561-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T21:38:32.917041-05:00","closed_at":"2026-01-20T21:38:32.917041-05:00","close_reason":"Closed"}
{"id":"facet-r4o","title":"Fix photo lightbox z-index to render above native dialog","description":"## Problem\nPhoto lightbox renders behind the native dialog modal, making it unusable. Users cannot click the close button or interact with the lightbox.\n\n## Context from UI Testing\n- Test facet-x5z: \"HIGH - Z-index/stacking issue with native dialog element\"\n- Lightbox z-index:1000 is ignored because native dialog uses browser \"top layer\"\n- Workaround: Press ESC to close parent modal first, then interact with lightbox\n- ESC key behavior is also inconsistent - closes parent modal instead of lightbox\n\n## Root Cause\n- Native \u003cdialog\u003e with showModal() creates a \"top layer\" context\n- Top layer always renders above regular z-indexed elements regardless of z-index value\n- Lightbox is rendered inside TicketDetailModal as sibling to modal content\n- Location: apps/web/src/lib/components/TicketDetailModal.svelte lines 870-936\n\n## Steps to Fix\nOption A (Recommended): Use portal pattern\n1. Render lightbox outside the modal component using Svelte portal action\n2. Mount lightbox to document.body when opened\n\nOption B: Use native dialog for lightbox\n1. Change lightbox to use \u003cdialog\u003e element with showModal()\n2. This puts lightbox in top layer, above the parent modal\n\nOption C: Close parent modal when opening lightbox\n1. Temporarily close parent modal when lightbox opens\n2. Reopen after lightbox closes (not ideal UX)\n\n## Success Criteria\n- [ ] Lightbox opens above the parent modal\n- [ ] Close button (X) is clickable\n- [ ] Backdrop click closes lightbox\n- [ ] ESC key closes lightbox first (not parent modal)\n- [ ] Navigation arrows work when multiple photos","status":"closed","priority":1,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T20:39:34.497328-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T21:01:38.495933-05:00","closed_at":"2026-01-20T21:01:38.495933-05:00","close_reason":"Fixed by using fully opaque background on lightbox dialog to ensure it covers parent modal. Moved backdrop click handler to lightbox-inner element."}
{"id":"facet-ri0","title":"Create Textarea component","description":"Build styled textarea for long text input.\n\nSteps:\n1. Create Textarea.svelte component\n2. Props: label, placeholder, value, rows, error, disabled\n3. Auto-resize option\n4. Theme styling\n\nFiles to create:\n- apps/web/src/lib/components/Textarea.svelte\n\nSuccess criteria: Textarea works, optionally auto-resizes","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:45.95679-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:47:40.779381-05:00","closed_at":"2026-01-20T11:47:40.779381-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-ri0","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:21:11.838892-05:00","created_by":"Blake Blount"}]}
{"id":"facet-sne","title":"Implement customers repository","description":"Create data access layer for customers table.\n\n## Steps\n1. Create Customer model struct matching schema\n2. Implement create_customer()\n3. Implement find_by_id()\n4. Implement search_customers() with name/phone/email search\n5. Implement get_customer_with_tickets()\n\n## Files to create\n- apps/api/src/models/customer.rs\n- apps/api/src/repositories/customer.rs\n\n## Success criteria\nAll CRUD operations work, search returns matching customers","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.017435-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:30:55.651723-05:00","closed_at":"2026-01-20T08:30:55.651723-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-sne","depends_on_id":"facet-md6","type":"blocks","created_at":"2026-01-19T22:20:18.521262-05:00","created_by":"Blake Blount"}]}
{"id":"facet-tgw","title":"Implement drag-and-drop between lanes","description":"Enable dragging tickets between status lanes.\n\nSteps:\n1. Add HTML5 drag-and-drop to TicketCard\n2. Add drop zone handling to StatusLane\n3. Visual feedback: card lifts with shadow on drag\n4. Drop zone highlights when dragging over\n5. On drop: open EmployeeIdModal\n6. After PIN verified: call POST /tickets/:id/status\n7. Optimistically update UI, revert on error\n\nFiles to modify:\n- apps/web/src/lib/components/TicketCard.svelte\n- apps/web/src/lib/components/StatusLane.svelte\n- apps/web/src/routes/+page.svelte\n\nSuccess criteria: Can drag cards between lanes, status updates","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.572163-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:39:54.748466-05:00","closed_at":"2026-01-20T11:39:54.748466-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-tgw","depends_on_id":"facet-8mk","type":"blocks","created_at":"2026-01-19T22:21:12.576761-05:00","created_by":"Blake Blount"},{"issue_id":"facet-tgw","depends_on_id":"facet-ci7","type":"blocks","created_at":"2026-01-19T22:21:12.693874-05:00","created_by":"Blake Blount"},{"issue_id":"facet-tgw","depends_on_id":"facet-alo","type":"blocks","created_at":"2026-01-19T22:21:12.807975-05:00","created_by":"Blake Blount"}]}
{"id":"facet-tp8","title":"Implement POST /employees/verify endpoint","description":"Verify employee PIN for attribution.\n\n## Steps\n1. Add handler for PIN verification\n2. Accept PIN in request body\n3. Hash and compare against stored pin_hash\n4. Return employee_id, name, role on success\n5. Return INVALID_PIN error on failure\n\n## API\nPOST /api/v1/employees/verify\nBody: { \"pin\": \"1234\" }\n\n## Success Criteria\nReturns employee on valid PIN, error on invalid","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.516417-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:24:39.936399-05:00","closed_at":"2026-01-20T08:24:39.936399-05:00","close_reason":"Implemented POST /employees/verify endpoint with PIN verification","dependencies":[{"issue_id":"facet-tp8","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:23.225018-05:00","created_by":"Blake Blount"},{"issue_id":"facet-tp8","depends_on_id":"facet-cul","type":"blocks","created_at":"2026-01-19T22:20:23.33736-05:00","created_by":"Blake Blount"}]}
{"id":"facet-u2z","title":"Implement print button functionality","description":"Enable printing receipts and labels from UI.\n\nSteps:\n1. Print Receipt button opens GET /tickets/:id/receipt.pdf in new tab\n2. Print Tag button opens GET /tickets/:id/label.pdf in new tab\n3. Browser print dialog triggered or user prints manually\n4. Handle PDF loading errors\n\nFiles to modify:\n- apps/web/src/lib/components/TicketDetailModal.svelte\n\nSuccess criteria: PDF opens in new tab for printing","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:38.679697-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:08:03.149959-05:00","closed_at":"2026-01-20T10:08:03.149959-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-u2z","depends_on_id":"facet-5w6","type":"blocks","created_at":"2026-01-19T22:21:11.266103-05:00","created_by":"Blake Blount"},{"issue_id":"facet-u2z","depends_on_id":"facet-ule","type":"blocks","created_at":"2026-01-19T22:21:11.383544-05:00","created_by":"Blake Blount"},{"issue_id":"facet-u2z","depends_on_id":"facet-7yc","type":"blocks","created_at":"2026-01-19T22:21:11.499871-05:00","created_by":"Blake Blount"}]}
{"id":"facet-ubq","title":"Create API client service","description":"Centralized API client for frontend.\n\nSteps:\n1. Create api.ts with fetch wrapper\n2. Base URL configuration\n3. X-Employee-ID header injection\n4. X-Admin-PIN header for admin calls\n5. Error handling and response parsing\n6. TypeScript types for all API responses\n7. Individual endpoint functions\n\nFiles to create:\n- apps/web/src/lib/services/api.ts\n- apps/web/src/lib/types/api.ts\n\nSuccess criteria: All API calls use centralized client","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:39.031736-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T07:10:48.034448-05:00","closed_at":"2026-01-20T07:10:48.034448-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-ubq","depends_on_id":"facet-6p6","type":"blocks","created_at":"2026-01-19T22:21:11.149149-05:00","created_by":"Blake Blount"}]}
{"id":"facet-ule","title":"Implement GET /tickets/:id/receipt.pdf endpoint","description":"Generate and serve receipt PDF for ticket.\n\nSteps:\n1. Add handler for receipt PDF\n2. Use PDF generation library (printpdf or similar)\n3. Include: friendly_code, customer name, item summary, requested work, quote, promise date, store info\n4. Optional: QR code linking to ticket\n5. Return PDF binary with correct content-type\n\nAPI: GET /api/v1/tickets/:ticket_id/receipt.pdf\n\nSuccess criteria: Returns valid PDF with ticket info","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.01281-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:28:40.424896-05:00","closed_at":"2026-01-20T06:28:40.424896-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-ule","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:18.526271-05:00","created_by":"Blake Blount"},{"issue_id":"facet-ule","depends_on_id":"facet-k4b","type":"blocks","created_at":"2026-01-19T22:20:22.719541-05:00","created_by":"Blake Blount"}]}
{"id":"facet-umb","title":"UI Test: Drag-drop PIN verification required","description":"## Test: PIN Required for Status Change\n\n### Preconditions\n- Dev server running\n- Ticket exists\n\n### Steps\n1. Navigate to workboard\n2. Drag a ticket to a different lane\n3. DO NOT enter PIN - click Cancel instead\n4. Observe what happens\n\n### Success Criteria\n- [ ] Dropping ticket ALWAYS triggers PIN modal\n- [ ] Cannot complete move without entering PIN\n- [ ] Canceling PIN modal cancels the move\n- [ ] Ticket returns to original lane after cancel\n- [ ] Lane counts remain unchanged after cancel\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:55:33.012944-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:37:27.505679-05:00","closed_at":"2026-01-20T16:37:27.505679-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-uwd","title":"UI Test: Intake form displays all required fields","description":"## Test: Intake Form Field Display\n\n### Preconditions\n- Dev server running\n- Intake form modal is open (click +New)\n\n### Steps\n1. Open the intake form modal\n2. Examine all visible form fields\n3. Check field labels and input types\n4. Note which fields are marked as required\n\n### Success Criteria\n- [ ] Customer Name field is present (text input with autocomplete)\n- [ ] Phone field is present (tel input)\n- [ ] Email field is present (email input)\n- [ ] Item Type field is present (text input)\n- [ ] Item Description field is present (text input, required)\n- [ ] Condition Notes field is present (textarea, required)\n- [ ] Requested Work field is present (textarea, required)\n- [ ] Rush checkbox is present with toggle styling\n- [ ] Promise Date field is present (date picker)\n- [ ] Storage Location dropdown is present (required)\n- [ ] Quote Amount field is present (number input)\n- [ ] Photo upload area is present (required)\n- [ ] Submit button is visible\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:12.60623-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T15:36:21.711772-05:00","closed_at":"2026-01-20T15:36:21.711772-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-uwm","title":"Implement GET /customers endpoint","description":"Search customers for autocomplete.\n\n## Steps\n1. Add handler for customer search\n2. Parse search query param\n3. Search by name, phone, or email (case-insensitive)\n4. Include ticket_count for each customer\n5. Return matching customers\n\n## API\nGET /api/v1/customers?search=jane\n\n## Success Criteria\nReturns matching customers for autocomplete","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.031421-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:11:21.873837-05:00","closed_at":"2026-01-20T09:11:21.873837-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-uwm","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:22.732668-05:00","created_by":"Blake Blount"},{"issue_id":"facet-uwm","depends_on_id":"facet-sne","type":"blocks","created_at":"2026-01-19T22:20:22.852821-05:00","created_by":"Blake Blount"}]}
{"id":"facet-uzw","title":"UI Test: Rush checkbox toggles visual state","description":"## Test: Rush Toggle Checkbox\n\n### Preconditions\n- Dev server running\n- Intake form modal is open\n\n### Steps\n1. Open intake form modal\n2. Locate the Rush checkbox/toggle\n3. Note its initial state (should be unchecked)\n4. Click to toggle it ON\n5. Observe visual changes\n6. Click to toggle it OFF\n7. Observe visual changes\n\n### Success Criteria\n- [ ] Rush toggle is clearly visible with label\n- [ ] Initial state is unchecked/off\n- [ ] Clicking toggles the state\n- [ ] ON state has distinct visual styling (highlighted, different color)\n- [ ] OFF state returns to normal styling\n- [ ] Toggle includes description text explaining rush priority\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:13.010285-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T18:47:50.664415-05:00","closed_at":"2026-01-20T18:47:50.664415-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-v8r","title":"Create storage locations management tab","description":"Build storage locations management.\n\nSteps:\n1. List locations from GET /locations\n2. Show name, active status\n3. \"Add Location\" button\n4. Edit location name\n5. Deactivate/Activate toggle\n6. Call location APIs\n\nFiles to modify:\n- apps/web/src/lib/components/AdminSettingsModal.svelte\n\nSuccess criteria: Can manage storage locations","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.872993-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:02:47.782243-05:00","closed_at":"2026-01-20T11:02:47.782243-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-v8r","depends_on_id":"facet-9ud","type":"blocks","created_at":"2026-01-19T22:21:25.540984-05:00","created_by":"Blake Blount"},{"issue_id":"facet-v8r","depends_on_id":"facet-nex","type":"blocks","created_at":"2026-01-19T22:21:35.774039-05:00","created_by":"Blake Blount"},{"issue_id":"facet-v8r","depends_on_id":"facet-4p6","type":"blocks","created_at":"2026-01-19T22:21:35.820062-05:00","created_by":"Blake Blount"}]}
{"id":"facet-vear","title":"HIGH-3: Implement session-based admin authentication","description":"## Problem\nAdmin PIN is transmitted in HTTP headers on every admin request. This is risky because headers are logged by proxies/load balancers, visible in browser network tools, and there's no session management (PIN sent repeatedly).\n\n## Location\nAll admin endpoints using `X-Admin-PIN` header:\n- `apps/api/src/handlers/employees.rs`\n- `apps/api/src/handlers/admin.rs`\n- `apps/api/src/handlers/settings.rs`\n- `apps/api/src/handlers/locations.rs`\n\n## Files to Modify\n- `apps/api/src/handlers/admin.rs` - Return session token on verify\n- Create `apps/api/src/session.rs` - Session management\n- `apps/api/src/handlers/employees.rs` - Accept session token\n- `apps/api/src/handlers/settings.rs` - Accept session token\n- `apps/api/src/handlers/locations.rs` - Accept session token\n- `apps/api/migrations/` - Add sessions table\n- `apps/api/src/routes/mod.rs` - Add session middleware\n\n## Implementation Steps\n\n### Step 1: Create Session Storage\nOption A: Database-backed sessions (recommended for persistence)\n\nCreate migration `003_add_admin_sessions.sql`:\n```sql\nCREATE TABLE admin_sessions (\n    session_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    session_token VARCHAR(64) NOT NULL UNIQUE,\n    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n    expires_at TIMESTAMPTZ NOT NULL,\n    last_activity_at TIMESTAMPTZ NOT NULL DEFAULT NOW()\n);\n\nCREATE INDEX idx_admin_sessions_token ON admin_sessions (session_token);\nCREATE INDEX idx_admin_sessions_expires ON admin_sessions (expires_at);\n```\n\nOption B: In-memory sessions (simpler, lost on restart)\nUse `dashmap` or similar for concurrent access.\n\n### Step 2: Create Session Module\nCreate `apps/api/src/session.rs`:\n\n```rust\nuse uuid::Uuid;\nuse rand::{thread_rng, Rng};\nuse base64::{Engine, engine::general_purpose::URL_SAFE_NO_PAD};\n\npub struct AdminSession {\n    pub session_id: Uuid,\n    pub session_token: String,\n    pub created_at: DateTime\u003cUtc\u003e,\n    pub expires_at: DateTime\u003cUtc\u003e,\n    pub last_activity_at: DateTime\u003cUtc\u003e,\n}\n\nimpl AdminSession {\n    pub fn new(duration_minutes: i64) -\u003e Self {\n        let mut token_bytes = [0u8; 32];\n        thread_rng().fill(\u0026mut token_bytes);\n        let session_token = URL_SAFE_NO_PAD.encode(token_bytes);\n        \n        let now = Utc::now();\n        Self {\n            session_id: Uuid::new_v4(),\n            session_token,\n            created_at: now,\n            expires_at: now + chrono::Duration::minutes(duration_minutes),\n            last_activity_at: now,\n        }\n    }\n    \n    pub fn is_expired(\u0026self) -\u003e bool {\n        Utc::now() \u003e self.expires_at\n    }\n}\n```\n\n### Step 3: Update Admin Verify Endpoint\nModify `/api/v1/admin/verify` to return session token:\n\n```rust\npub async fn verify_admin(...) -\u003e Result\u003cimpl IntoResponse, AppError\u003e {\n    // ... existing PIN verification ...\n    \n    if is_valid {\n        // Create new session\n        let session = AdminSession::new(30); // 30 minutes\n        \n        // Store in database\n        SessionRepository::create(\u0026state.db, \u0026session).await?;\n        \n        let response = AdminVerifyResponse {\n            valid: true,\n            session_token: session.session_token,\n            expires_at: session.expires_at,\n        };\n        return Ok(Json(ApiResponse::success(response)));\n    }\n    // ...\n}\n```\n\n### Step 4: Create Session Verification Helper\nReplace `verify_admin_pin_header` with `verify_admin_session`:\n\n```rust\nasync fn verify_admin_session(state: \u0026AppState, headers: \u0026HeaderMap) -\u003e Result\u003c(), AppError\u003e {\n    let token = headers\n        .get(\"X-Admin-Session\")\n        .and_then(|v| v.to_str().ok())\n        .ok_or_else(|| AppError::unauthorized(\"Missing X-Admin-Session header\"))?;\n    \n    let session = SessionRepository::find_by_token(\u0026state.db, token)\n        .await?\n        .ok_or_else(|| AppError::unauthorized(\"Invalid or expired session\"))?;\n    \n    if session.is_expired() {\n        SessionRepository::delete(\u0026state.db, session.session_id).await?;\n        return Err(AppError::unauthorized(\"Session expired\"));\n    }\n    \n    // Update last activity (sliding expiration)\n    SessionRepository::touch(\u0026state.db, session.session_id).await?;\n    \n    Ok(())\n}\n```\n\n### Step 5: Update All Admin Endpoints\nChange all admin endpoints from:\n```rust\nverify_admin_pin_header(\u0026state, \u0026headers).await?;\n```\nTo:\n```rust\nverify_admin_session(\u0026state, \u0026headers).await?;\n```\n\n### Step 6: Add Session Cleanup\nCreate background task or periodic cleanup:\n```rust\n// Delete expired sessions\nSessionRepository::delete_expired(\u0026state.db).await?;\n```\n\n### Step 7: Add Logout Endpoint\nCreate `POST /api/v1/admin/logout`:\n```rust\npub async fn admin_logout(\n    State(state): State\u003cAppState\u003e,\n    headers: HeaderMap,\n) -\u003e Result\u003cimpl IntoResponse, AppError\u003e {\n    if let Some(token) = headers.get(\"X-Admin-Session\").and_then(|v| v.to_str().ok()) {\n        SessionRepository::delete_by_token(\u0026state.db, token).await?;\n    }\n    Ok(Json(ApiResponse::success(())))\n}\n```\n\n## Success Criteria\n- [ ] Admin verify returns session token\n- [ ] Session tokens are cryptographically random (32+ bytes)\n- [ ] Sessions expire after 30 minutes of inactivity\n- [ ] Expired sessions are rejected with 401\n- [ ] PIN is only sent once (during verify)\n- [ ] All admin endpoints accept X-Admin-Session\n- [ ] Logout invalidates session\n- [ ] Session cleanup removes expired entries\n\n## Testing Requirements\n\n### Unit Tests\n- Session token generation is random\n- Session expiration detection works\n- Sliding expiration updates correctly\n\n### Integration Tests\nCreate `apps/api/tests/admin_session.rs`:\n1. POST /admin/verify with valid PIN -\u003e returns session token\n2. GET /employees with session token -\u003e allowed\n3. GET /employees with expired session -\u003e 401\n4. GET /employees with invalid session -\u003e 401\n5. POST /admin/logout -\u003e session invalidated\n6. Subsequent request with logged-out session -\u003e 401\n7. Session activity extends expiration (sliding window)\n\n### Security Tests\n- Session token is not logged (check log output)\n- Multiple sessions can exist simultaneously\n- Session cannot be forged or predicted\n- Rate limiting still applies to /admin/verify\n\n## Security Validation\n- Verify session tokens are not in URL or query params\n- Confirm session tokens have sufficient entropy (256 bits)\n- Test session fixation is not possible\n- Verify old PIN-based header is rejected (deprecation)\n- Test concurrent requests with same session work correctly","status":"closed","priority":1,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:33:48.338775-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T23:36:57.275473-05:00","closed_at":"2026-01-20T23:36:57.275473-05:00","close_reason":"Implemented session-based admin authentication with 30-minute sliding expiration, logout endpoint, and session cleanup on startup. Frontend updated to use session tokens instead of per-request PIN."}
{"id":"facet-w84","title":"UI Test: Close ticket - invalid amount validation","description":"## Test: Close Ticket Amount Validation\n\n### Preconditions\n- Dev server running\n- Ticket exists in \"Ready for Pickup\" status\n- Close ticket modal is open\n\n### Steps\n1. Open detail for a \"Ready for Pickup\" ticket\n2. Click \"Close Ticket\"\n3. Leave amount field empty, click Next\n4. Enter invalid value (e.g., \"abc\"), click Next\n5. Enter negative number, click Next\n6. Enter valid amount, click Next\n\n### Success Criteria\n- [ ] Empty amount shows validation error\n- [ ] Non-numeric value shows validation error\n- [ ] Negative number shows validation error (if not allowed)\n- [ ] Cannot proceed to Step 2 without valid amount\n- [ ] Valid amount (e.g., \"150.00\") allows proceeding\n- [ ] Error messages are clear and specific\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:55:33.656484-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:58:25.794761-05:00","closed_at":"2026-01-20T16:58:25.794761-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-wec","title":"Implement GET /customers/:id endpoint","description":"Get customer with ticket history.\n\n## Steps\n1. Add handler for customer detail\n2. Fetch customer by ID\n3. Include ticket history (summary list)\n4. Return customer with tickets\n\n## API\nGET /api/v1/customers/:customer_id\n\n## Success Criteria\nReturns customer with past tickets","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.285669-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T09:46:15.925218-05:00","closed_at":"2026-01-20T09:46:15.925218-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-wec","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:22.992489-05:00","created_by":"Blake Blount"},{"issue_id":"facet-wec","depends_on_id":"facet-sne","type":"blocks","created_at":"2026-01-19T22:20:23.110256-05:00","created_by":"Blake Blount"}]}
{"id":"facet-wg1","title":"Fix column header and ticket counter spacing in workboard","description":"## Problem\n\nThe space between column header for \"Waiting on Parts\" and the ticket counter badges runs too close together, making them appear cramped. This is definitely visible in the Arcane theme but likely affects other themes as well.\n\n## Instructions\n\n1. Review the workboard column headers in both Arcane and default themes\n2. Either:\n   - Widen all columns slightly, OR\n   - Increase the spacing/gap between the header text and the ticket counter badge\n3. Ensure the fix applies consistently across all themes\n\n## Success Criteria\n\n- [ ] Column headers and ticket counters have visible breathing room between them\n- [ ] Spacing looks balanced in Arcane theme\n- [ ] Spacing looks balanced in default/other themes\n- [ ] No text truncation or overflow issues introduced\n- [ ] Columns remain functional and responsive","status":"closed","priority":3,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T21:22:23.707412-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T21:42:54.181393-05:00","closed_at":"2026-01-20T21:42:54.181393-05:00","close_reason":"Closed"}
{"id":"facet-x5z","title":"UI Test: Photo lightbox opens on thumbnail click","description":"## Test: Photo Lightbox\n\n### Preconditions\n- Dev server running\n- Ticket exists with at least one photo\n- Ticket detail modal is open\n\n### Steps\n1. Open detail modal for ticket with photos\n2. Locate the photos section\n3. Click on a photo thumbnail\n4. Observe the lightbox behavior\n\n### Success Criteria\n- [ ] Clicking thumbnail opens full-size lightbox\n- [ ] Lightbox covers the screen with dark overlay\n- [ ] Full-size image is displayed centered\n- [ ] Close button (X) is visible\n- [ ] Photo metadata shown (date, employee name)\n- [ ] Photo counter shown if multiple photos (e.g., \"1 of 5\")\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:53:55.518192-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T15:57:50.162171-05:00","closed_at":"2026-01-20T15:57:50.162171-05:00","close_reason":"Test completed. All success criteria pass. Found HIGH severity z-index bug with native dialog - created facet-2gu for fix.","labels":["ui-test"]}
{"id":"facet-xpc","title":"CRIT-5: Fix CORS configuration to respect allowed origins","description":"## Problem\nThe `build_cors_layer` function in `main.rs` always returns `cors.allow_origin(Any)` regardless of configuration. Any website can make authenticated requests to the API if the user's browser has valid credentials.\n\n## Location\n`apps/api/src/main.rs:build_cors_layer` (lines 63-77)\n\n## Current Code\n```rust\nfn build_cors_layer(config: \u0026Config) -\u003e CorsLayer {\n    let cors = CorsLayer::new()\n        .allow_methods(Any)\n        .allow_headers(Any)\n        .max_age(Duration::from_secs(3600));\n\n    if config.cors_origins.len() == 1 \u0026\u0026 config.cors_origins[0] == \"*\" {\n        cors.allow_origin(Any)\n    } else {\n        // For specific origins, we still use Any for simplicity in MVP\n        cors.allow_origin(Any)  // \u003c-- BUG: Always allows any origin\n    }\n}\n```\n\n## Files to Modify\n- `apps/api/src/main.rs` - Fix CORS layer builder\n- `apps/api/src/lib.rs` or `config.rs` - Ensure CORS config is properly parsed\n\n## Implementation Steps\n\n### Step 1: Parse Origins from Configuration\nEnsure `Config.cors_origins` is properly parsed from environment:\n```rust\n// In config loading\nlet cors_origins: Vec\u003cString\u003e = std::env::var(\"CORS_ORIGINS\")\n    .unwrap_or_else(|_| \"*\".to_string())\n    .split(',')\n    .map(|s| s.trim().to_string())\n    .collect();\n```\n\n### Step 2: Fix build_cors_layer Function\n```rust\nfn build_cors_layer(config: \u0026Config) -\u003e CorsLayer {\n    let cors = CorsLayer::new()\n        .allow_methods(Any)\n        .allow_headers(Any)\n        .max_age(Duration::from_secs(3600));\n\n    if config.cors_origins.len() == 1 \u0026\u0026 config.cors_origins[0] == \"*\" {\n        // Explicitly allow any origin (development mode)\n        tracing::warn!(\"CORS configured to allow all origins - not recommended for production\");\n        cors.allow_origin(Any)\n    } else {\n        // Parse and validate specific origins\n        let origins: Vec\u003cHeaderValue\u003e = config\n            .cors_origins\n            .iter()\n            .filter_map(|origin| {\n                origin.parse::\u003cHeaderValue\u003e().ok().or_else(|| {\n                    tracing::error!(\"Invalid CORS origin: {}\", origin);\n                    None\n                })\n            })\n            .collect();\n\n        if origins.is_empty() {\n            tracing::error!(\"No valid CORS origins configured, falling back to deny all\");\n            cors.allow_origin(tower_http::cors::AllowOrigin::list(vec![]))\n        } else {\n            cors.allow_origin(tower_http::cors::AllowOrigin::list(origins))\n        }\n    }\n}\n```\n\n### Step 3: Add Required Import\n```rust\nuse axum::http::HeaderValue;\n```\n\n### Step 4: Update Environment Configuration\nDocument in `.env.example`:\n```\n# CORS origins (comma-separated, or * for all)\n# Production: CORS_ORIGINS=https://app.example.com,https://admin.example.com\n# Development: CORS_ORIGINS=*\nCORS_ORIGINS=http://localhost:5173,http://localhost:3000\n```\n\n### Step 5: Add Startup Validation\nLog configured origins at startup:\n```rust\ntracing::info!(\"CORS allowed origins: {:?}\", config.cors_origins);\n```\n\n## Success Criteria\n- [ ] CORS respects configured origins list\n- [ ] Requests from unlisted origins are rejected with CORS error\n- [ ] Wildcard \"*\" still works for development\n- [ ] Invalid origin strings are logged and skipped\n- [ ] Empty/invalid config results in deny-all (safe default)\n- [ ] Startup logs show configured origins\n\n## Testing Requirements\n\n### Unit Tests\n- Parse single origin correctly\n- Parse multiple comma-separated origins\n- Handle whitespace in origin list\n- Handle invalid origin (not a valid URL)\n- Handle empty string origin\n\n### Integration Tests\nCreate `apps/api/tests/cors.rs`:\n1. Request with allowed Origin header -\u003e CORS headers present\n2. Request with disallowed Origin header -\u003e No CORS headers (browser blocks)\n3. Preflight OPTIONS request works for allowed origin\n4. Preflight OPTIONS fails for disallowed origin\n5. With CORS_ORIGINS=*, all origins allowed\n\n### Manual Testing\n1. Set CORS_ORIGINS=http://localhost:5173\n2. Make request from frontend on localhost:5173 -\u003e works\n3. Make request from evil.com (via curl with Origin header) -\u003e no CORS headers\n4. Verify browser console shows CORS error for blocked origin\n\n## Security Validation\n- Verify credentials (cookies, auth headers) are only sent to allowed origins\n- Test that null origin is handled (should be denied)\n- Confirm case-sensitivity handling (https://EXAMPLE.com vs https://example.com)\n- Test origin with different ports (http://localhost:5173 vs http://localhost:5174)","status":"closed","priority":0,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:30:35.379008-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T23:17:10.890018-05:00","closed_at":"2026-01-20T23:17:10.890018-05:00","close_reason":"Closed"}
{"id":"facet-xsb","title":"Implement DELETE /tickets/:id/photos/:photo_id endpoint","description":"Admin-only photo deletion.\n\nSteps:\n1. Add handler for photo delete\n2. Require X-Admin-PIN header\n3. Verify admin PIN\n4. Delete from S3\n5. Delete database record\n\nAPI: DELETE /api/v1/tickets/:ticket_id/photos/:photo_id\nHeaders: X-Admin-PIN\n\nSuccess criteria: Deletes photo (admin only)","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.711337-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T08:21:58.513315-05:00","closed_at":"2026-01-20T08:21:58.513315-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-xsb","depends_on_id":"facet-b24","type":"blocks","created_at":"2026-01-19T22:20:18.942224-05:00","created_by":"Blake Blount"}]}
{"id":"facet-y53","title":"Create Badge component","description":"Build badge for status/rush indicators.\n\nSteps:\n1. Create Badge.svelte component\n2. Props: variant (rush, status, overdue), text\n3. Small pill-shaped indicator\n4. Color variants per theme\n\nFiles to create:\n- apps/web/src/lib/components/Badge.svelte\n\nSuccess criteria: Badge displays correctly with variants","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:46.285726-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T11:30:04.006411-05:00","closed_at":"2026-01-20T11:30:04.006411-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-y53","depends_on_id":"facet-qct","type":"blocks","created_at":"2026-01-19T22:21:12.218457-05:00","created_by":"Blake Blount"}]}
{"id":"facet-yx2","title":"UI Test: Closed ticket is read-only","description":"## Test: Closed Ticket Read-Only State\n\n### Preconditions\n- Dev server running\n- Ticket exists in \"Closed\" status\n\n### Steps\n1. Search for a closed ticket\n2. Open its detail modal\n3. Try to interact with various elements\n\n### Success Criteria\n- [ ] Add Note textarea/button is disabled or hidden\n- [ ] Add Photo button is disabled or hidden\n- [ ] Rush toggle is disabled or hidden\n- [ ] Edit button is disabled or hidden\n- [ ] Close Ticket button is not shown\n- [ ] Print buttons still work (Receipt, Tag)\n- [ ] All data is visible but not editable\n- [ ] Status clearly shows \"Closed\"\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:55:33.817547-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T17:45:14.221265-05:00","closed_at":"2026-01-20T17:45:14.221265-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-yxd1","title":"HIGH-1: Add request body size limits to API endpoints","description":"## Problem\nNo limits on request body size for JSON endpoints. This enables memory exhaustion via large payloads and DoS attacks with oversized requests. The photo endpoint has a 10MB limit, but JSON endpoints have none.\n\n## Location\n`apps/api/src/main.rs` - missing `RequestBodyLimit` middleware\n\n## Files to Modify\n- `apps/api/src/main.rs` - Add request body limit middleware\n- `apps/api/Cargo.toml` - Ensure tower-http version supports limits\n\n## Implementation Steps\n\n### Step 1: Add Request Body Limit Layer\nIn `main.rs`, add the middleware to the app:\n\n```rust\nuse tower_http::limit::RequestBodyLimitLayer;\n\n// Build router with middleware\nlet app = api_router(state)\n    .layer(TraceLayer::new_for_http())\n    .layer(cors)\n    .layer(RequestBodyLimitLayer::new(1024 * 1024)); // 1MB default\n```\n\n### Step 2: Configure Different Limits for Different Routes\nFor routes that need larger bodies (photo upload), apply limits selectively:\n\n```rust\n// In routes/mod.rs\nlet tickets_routes = Router::new()\n    .route(\n        \"/:ticket_id/photos\",\n        post(handlers::upload_photo)\n            .layer(RequestBodyLimitLayer::new(10 * 1024 * 1024)), // 10MB for photos\n    )\n    // ... other routes get default 1MB limit\n```\n\nOr use a conditional approach based on Content-Type.\n\n### Step 3: Handle Limit Exceeded Errors\nThe middleware returns 413 Payload Too Large when limit exceeded. Ensure this is handled gracefully:\n\n```rust\n// In error.rs, add handler for PayloadTooLarge\nimpl IntoResponse for AppError {\n    fn into_response(self) -\u003e Response {\n        // ... existing error handling\n    }\n}\n\n// Consider wrapping the default 413 with a JSON response\n```\n\n### Step 4: Document Limits\nAdd to API documentation:\n- Default body size limit: 1MB\n- Photo upload limit: 10MB\n- Settings update limit: 64KB (minimal JSON)\n\n### Step 5: Add Configuration Option\nMake limits configurable via environment:\n```\nMAX_BODY_SIZE=1048576      # 1MB default\nMAX_PHOTO_SIZE=10485760    # 10MB for photos\n```\n\n## Success Criteria\n- [ ] JSON endpoints reject bodies larger than 1MB\n- [ ] Photo upload endpoint allows up to 10MB\n- [ ] 413 Payload Too Large returned for oversized requests\n- [ ] Error response is JSON formatted with clear message\n- [ ] Limits are configurable via environment variables\n- [ ] Existing tests pass\n- [ ] Memory usage stays bounded under load\n\n## Testing Requirements\n\n### Unit Tests\n- Verify limit configuration parsing from environment\n\n### Integration Tests\nCreate `apps/api/tests/body_limits.rs`:\n1. POST /api/v1/tickets with 500KB body -\u003e 201 (under limit)\n2. POST /api/v1/tickets with 2MB body -\u003e 413 (over limit)\n3. POST /api/v1/tickets/:id/photos with 5MB file -\u003e 201 (under 10MB)\n4. POST /api/v1/tickets/:id/photos with 15MB file -\u003e 413 (over 10MB)\n5. PUT /api/v1/settings with 100KB body -\u003e 200 (reasonable)\n6. PUT /api/v1/settings with 2MB body -\u003e 413\n\n### Load Testing\nUse `hey` or similar tool:\n```bash\n# Generate 2MB payload\ndd if=/dev/urandom of=large.json bs=1024 count=2048\n\n# Verify rejection\nhey -n 100 -c 10 -m POST -D large.json http://localhost:8080/api/v1/tickets\n# Should see 100% 413 responses\n```\n\n### Memory Monitoring\n1. Start API with memory monitoring (e.g., `heaptrack`)\n2. Send many large payloads concurrently\n3. Verify memory stays bounded (shouldn't buffer entire payload)\n\n## Security Validation\n- Verify limit is enforced before body is read into memory\n- Test with chunked transfer encoding\n- Confirm limit applies to both Content-Length and actual body size\n- Test with compressed content (gzip) - limits should apply to decompressed size","status":"closed","priority":1,"issue_type":"bug","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T22:33:47.475781-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T23:57:24.791469-05:00","closed_at":"2026-01-20T23:57:24.791469-05:00","close_reason":"Closed"}
{"id":"facet-yzr","title":"Implement intake form submission and print flow","description":"Handle form submission with printing.\n\nSteps:\n1. \"Create \u0026 Print\" button\n2. Form validation (all required fields, min 1 photo)\n3. Prompt for employee ID\n4. Call POST /tickets with form data\n5. Upload photos to POST /tickets/:id/photos\n6. On success: open receipt PDF in new tab\n7. Show success message with ticket code\n8. Close modal, refresh workboard\n\nFiles to modify:\n- apps/web/src/lib/components/IntakeFormModal.svelte\n\nSuccess criteria: Creates ticket, prints receipt, updates workboard","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:42.835095-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T12:03:53.441297-05:00","closed_at":"2026-01-20T12:03:53.441297-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-yzr","depends_on_id":"facet-pr9","type":"blocks","created_at":"2026-01-19T22:21:08.988108-05:00","created_by":"Blake Blount"},{"issue_id":"facet-yzr","depends_on_id":"facet-491","type":"blocks","created_at":"2026-01-19T22:21:09.025735-05:00","created_by":"Blake Blount"},{"issue_id":"facet-yzr","depends_on_id":"facet-alo","type":"blocks","created_at":"2026-01-19T22:21:09.064061-05:00","created_by":"Blake Blount"}]}
{"id":"facet-z6d","title":"UI Test: Search result opens detail modal","description":"## Test: Open Detail from Search Result\n\n### Preconditions\n- Dev server running\n- Search returns at least one result\n\n### Steps\n1. Navigate to /search\n2. Perform a search that returns results\n3. Click on a result card\n4. Observe what opens\n\n### Success Criteria\n- [ ] Search results are clickable (cursor indicates)\n- [ ] Clicking opens ticket detail modal\n- [ ] Modal shows full ticket details\n- [ ] Can close modal and return to search results\n- [ ] Search results are preserved after closing modal\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:58.015078-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:11:22.84535-05:00","closed_at":"2026-01-20T16:11:22.84535-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-z7n","title":"Create store info settings tab","description":"Build store information settings form.\n\nSteps:\n1. Form fields: store_name, store_phone, store_address, ticket_prefix\n2. Load current values from GET /settings\n3. Save button calls PUT /settings\n4. Show success/error feedback\n\nFiles to modify:\n- apps/web/src/lib/components/AdminSettingsModal.svelte\n\nSuccess criteria: Can view and update store settings","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:18:41.646247-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:46:41.252743-05:00","closed_at":"2026-01-20T10:46:41.252743-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-z7n","depends_on_id":"facet-9ud","type":"blocks","created_at":"2026-01-19T22:21:25.431959-05:00","created_by":"Blake Blount"},{"issue_id":"facet-z7n","depends_on_id":"facet-nex","type":"blocks","created_at":"2026-01-19T22:21:27.931834-05:00","created_by":"Blake Blount"}]}
{"id":"facet-z8s","title":"Implement GET /employees endpoint (admin)","description":"Admin endpoint to list employees.\n\n## Steps\n1. Add handler for employee list\n2. Require X-Admin-PIN header\n3. Verify admin PIN\n4. Parse include_inactive query param\n5. Return employee list (without pin_hash)\n\n## API\nGET /api/v1/employees\nHeaders: X-Admin-PIN\n\n## Success Criteria\nReturns employees for admin","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.711336-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T10:04:54.982946-05:00","closed_at":"2026-01-20T10:04:54.982946-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-z8s","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:23.45177-05:00","created_by":"Blake Blount"},{"issue_id":"facet-z8s","depends_on_id":"facet-cul","type":"blocks","created_at":"2026-01-19T22:20:23.56994-05:00","created_by":"Blake Blount"}]}
{"id":"facet-z9l","title":"UI Test: Filter by date range","description":"## Test: Date Range Filter\n\n### Preconditions\n- Dev server running\n- Tickets exist with various creation dates\n\n### Steps\n1. Navigate to /search\n2. Set a From Date using the date picker\n3. Set a To Date using the date picker\n4. Click Search\n5. Observe results\n\n### Success Criteria\n- [ ] From Date picker opens and allows date selection\n- [ ] To Date picker opens and allows date selection\n- [ ] Results are filtered to the specified date range\n- [ ] Only tickets created within the range are shown\n- [ ] To Date must be \u003e= From Date (validation)\n- [ ] Can combine date filter with other filters\n\n### Recording Results\nAppend results to UI-TESTS.md using the template format.","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-20T13:54:57.707952-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T16:08:08.480956-05:00","closed_at":"2026-01-20T16:08:08.480956-05:00","close_reason":"Closed","labels":["ui-test"]}
{"id":"facet-zh9","title":"Implement GET /tickets endpoint","description":"Create endpoint to list tickets with filters.\n\nSteps:\n1. Create handler in src/handlers/tickets.rs\n2. Parse query params: status, is_rush, search, customer_id, from_date, to_date, include_archived, limit, offset\n3. Call tickets repository list_tickets()\n4. Return paginated response with ticket summaries\n5. Add route to router\n\nAPI: GET /api/v1/tickets\n\nSuccess criteria: Returns filtered ticket list with pagination","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.005572-05:00","created_by":"Blake Blount","updated_at":"2026-01-20T06:41:28.160995-05:00","closed_at":"2026-01-20T06:41:28.160995-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-zh9","depends_on_id":"facet-1dj","type":"blocks","created_at":"2026-01-19T22:20:18.525489-05:00","created_by":"Blake Blount"},{"issue_id":"facet-zh9","depends_on_id":"facet-k4b","type":"blocks","created_at":"2026-01-19T22:20:18.997394-05:00","created_by":"Blake Blount"}]}
{"id":"facet-zsx","title":"Set up S3 client for photo storage","description":"Configure S3-compatible client for DigitalOcean Spaces.\n\n## Steps\n1. Add aws-sdk-s3 or rusoto to Cargo.toml\n2. Create S3 client configuration (endpoint, bucket, credentials from env)\n3. Create storage module with upload/download/delete functions\n4. Create signed URL generation function\n5. Add storage client to app state\n\n## Files to create\n- apps/api/src/storage.rs\n\n## Success criteria\nCan upload file to S3, generate signed URL","status":"closed","priority":2,"issue_type":"task","owner":"blakeblount37@gmail.com","created_at":"2026-01-19T22:16:24.699468-05:00","created_by":"Blake Blount","updated_at":"2026-01-19T22:48:34.869897-05:00","closed_at":"2026-01-19T22:48:34.869897-05:00","close_reason":"Closed","dependencies":[{"issue_id":"facet-zsx","depends_on_id":"facet-h67","type":"blocks","created_at":"2026-01-19T22:20:21.787811-05:00","created_by":"Blake Blount"}]}
